<!--Copyright 2022 Owen Greenhalgh, and the rest of the bad burrito team. All Rights Reserved.-->
<!DOCTYPE html>
<html>
    <head>

    </head>
    <body>
        <script src="data.js"></script>
        <script>
            var fullScreen = false;
            var loaded = false;
            var levelMaps = [tutorialMap1, levelMap1, levelMap2, demoMap1, bossMap1];
            var levelEntitys = [tutorialEntity1, levelEntity1, levelEntity2, entity1, bossEntity1];
            var level = 0;
            var tutorial;
            
            function updateCurrentLevel() {
                if (level == 0) {
                    tutorial = true;
                } else {
                    tutorial = false;
                }
                map1 = levelMaps[level];
                entity1 = levelEntitys[level];
            }
            updateCurrentLevel();
            
        </script>
        <canvas id="cnvs" width="800" height="608" style="display:block;"></canvas>
        <p id="outputMap"></p>
        <p id="outputEntity"></p>
        <script src="phaser.js"></script>
        <script>
            
            //game scenes
            var gameScene = new Phaser.Scene("game");
            gameScene.preload = preload;
            gameScene.create = create;
            gameScene.update = update;

            var titleScene = new Phaser.Scene("title");
            /*
            titleScene.preload = titlePreload;
            titleScene.create = titleCreate;
            titleScene.update = titleUpdate;*/
            //functions are specified further down.
            var width, height;
            if (fullScreen) {
                width = window.innerWidth;
                height = window.innerHeight;
                document.getElementById('cnvs').requestFullscreen();
            } else {
                width = 800;
                height = 600;
            }
            var config = {
                type: Phaser.WEBGL,
                width: width,
                height: height,//for the odd grid size
                backgroundColor: '#ADD8E6',
                pixelArt: true,
                canvas: document.getElementById('cnvs'),
                physics: {
                    default: 'arcade',
                    tileBias: 32,
                    arcade: {
                        gravity: { y: 0 },//to let us set this individualy
                        debug: true
                    }
                },
                map: {
                    add: 'makeStuff',
                    load: 'loader'
                }
                
            };

            var game = new Phaser.Game(config);
            
            function preload ()
            {
                console.log(loaded);
                if (true) {
                    percentage = this.add.text(400, 300, '0%', { fontSize: '32px', fill: 'white' }).setOrigin(0.5);
                    this.load.on('progress', function(value) {
                        if (Math.round(value*100)<100) {
                            if (percentage.setText) {
                                percentage.setText(Math.round(value*100) + '%');
                            }
                            
                        } else {
                            percentage.setText('Finishing...');
                            loaded = true;
                        }
                        
                        
                    });
                    this.load.on('complete', function () {
                        percentage.destroy();
                        loaded = true;
                    });
                }
                loaded = true;
                
                //font
                var element = document.createElement('style');

                document.head.appendChild(element);

                var sheet = element.sheet;

                var styles = '@font-face { font-family: "mono"; src: url("assets/VCR_OSD_MONO_1.001.ttf") format("opentype"); }\n';

                sheet.insertRule(styles, 0);

                this.load.script('webfont', 'https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js');
                //music files
                this.load.audio('mainMusic', ['assets/UpTown.mp3']);
                this.load.audio('burritoJump', ['assets/burritojump.wav']);
                this.load.audio('walking', ['assets/walking.mp3']);
                //text box
                this.load.image('text', 'assets/textBox.png');
                //clouds/background
                this.load.image('cloud1', 'assets/cloud-c.png');
                this.load.image('cloud2', 'assets/cloud-b.png');
                //tutorial
                this.load.image('potat1', 'assets/potato1.png');
                this.load.image('potat2', 'assets/potato2.png');
                //drill boss images below
                this.load.image('rock', 'assets/rock.png');
                this.load.image('drop1', 'assets/gumdrop1.png');
                this.load.image('drop2', 'assets/gumdrop2.png');
                this.load.image('drop3', 'assets/gumdrop3.png');
                this.load.image('drop4', 'assets/gumdrop4.png');
                this.load.image('drop5', 'assets/gumdrop5.png');
                this.load.image('drop6', 'assets/gumdrop6.png');

                this.load.image('aimArrow', 'assets/aimArrow.png');

                this.load.image('drill1', 'assets/boss1__1.png');
                this.load.image('drill2', 'assets/boss1__2.png');
                this.load.image('drill3', 'assets/boss1__3.png');
                this.load.image('drill4', 'assets/boss1__4.png');
                this.load.image('drill5', 'assets/boss1__5.png');
                this.load.image('drill6', 'assets/boss1__6.png');
                this.load.image('drill7', 'assets/boss1__7.png');
                this.load.image('drill8', 'assets/boss1__8.png');
                this.load.image('drill9', 'assets/boss1__9.png');

                this.load.image('down1', 'assets/down1.png');
                this.load.image('down2', 'assets/down2.png');
                this.load.image('down3', 'assets/down3.png');
                this.load.image('down4', 'assets/down4.png');
                this.load.image('down5', 'assets/down5.png');
                this.load.image('down6', 'assets/down6.png');
                this.load.image('down7', 'assets/down7.png');
                this.load.image('down8', 'assets/down8.png');
                this.load.image('down9', 'assets/down9.png');
                this.load.image('down10', 'assets/down10.png');
                this.load.image('down11', 'assets/down11.png');
                this.load.image('down12', 'assets/down12.png');
                this.load.image('down13', 'assets/down13.png');
                this.load.image('down14', 'assets/down14.png');

                this.load.image('up1', 'assets/up1.png');
                this.load.image('up2', 'assets/up2.png');
                this.load.image('up3', 'assets/up3.png');
                this.load.image('up4', 'assets/up4.png');
                this.load.image('up5', 'assets/up5.png');

                this.load.image('shred1', 'assets/shred1.png');
                this.load.image('shred2', 'assets/shred2.png');
                this.load.image('shred3', 'assets/shred3.png');
                this.load.image('shred4', 'assets/shred4.png');
                this.load.image('shred5', 'assets/shred5.png');
                this.load.image('shred6', 'assets/shred6.png');
                //burrito images below
                
                this.load.image('burrito1', 'assets/burrito__1.png');
                this.load.image('burrito2', 'assets/burrito__2.png');
                this.load.image('burrito3', 'assets/burrito__3.png');
                this.load.image('burrito4', 'assets/burrito__4.png');
                this.load.image('burrito5', 'assets/burrito__5.png');
                this.load.image('burrito6', 'assets/burrito__6.png');
                this.load.image('burrito7', 'assets/burrito__7.png');
                this.load.image('burrito8', 'assets/burrito__8.png');

                this.load.spritesheet('burritoParticles', 'assets/burritoParticles.svg', { frameWidth: 9, frameHeight: 9 });

                this.load.image('barrier', 'assets/barrier.png');

                //burrito specific killers
                this.load.image('iceBottle', 'assets/Ice sauce.png');
                this.load.image('iceBall', 'assets/Iceball.png');
                this.load.image('lime', 'assets/lime.png');
                //terrain images
                this.load.image('grass', 'assets/Dirt.png');
                this.load.image('dirt', 'assets/underground.png');
                this.load.image('tree1', 'assets/tree 1.png');

                this.load.image('landscape', 'assets/newLand.png');
                this.load.image('platform', 'assets/platform.png');

                this.load.image('flag', 'assets/flag.svg');

                this.load.image('cream', 'assets/Cream.png');
                //this.load.image

                //sky images
                this.load.image('sky1', 'assets/sky.png');

                //lava images
                
                this.load.image('lava1', 'assets/lavaTiles__1.png');
                this.load.image('lava2', 'assets/lavaTiles__2.png');
                this.load.image('lava3', 'assets/lavaTiles__3.png');
                this.load.image('lava4', 'assets/lavaTiles__4.png');
                this.load.image('lava5', 'assets/lavaTiles__5.png');
                this.load.image('lava6', 'assets/lavaTiles__6.png');
                this.load.image('lava7', 'assets/lavaTiles__7.png');
                this.load.image('lava8', 'assets/lavaTiles__8.png');

                //player images
                this.load.image('left1', 'assets/L1.png');
                this.load.image('left2', 'assets/L2.png');
                this.load.image('right1', 'assets/R1.png');
                this.load.image('right2', 'assets/R2.png');
                this.load.image('still', 'assets/Stanstill.png');

                //coin images
                this.load.image('coin1', 'assets/coin__1.png');
                this.load.image('coin2', 'assets/coin__2.png');
                this.load.image('coin3', 'assets/coin__3.png');
                this.load.image('coin4', 'assets/coin__4.png');

                //images for stlagmites (spelling is irrelevent haha).
                this.load.image('mite1', 'assets/stlagmite1.png');
                this.load.image('mite2', 'assets/stlagmite2.png');
                this.load.image('mite3', 'assets/stlagmite3.png');
                this.load.image('mite4', 'assets/stlagmite4.png');
                this.load.image('mite5', 'assets/stlagmite5.png');


            }
            //global game functions and variables.
            function random (one, two) {
                return(Math.round(Math.random()*(two-one))+one);
            }
            //deaths
            var dead = false;
            function death(Taco, spike) {
                /*
                if (dead == false) {
                    dead = true;
                    console.log('hi');
                    taco.active = false;
                    setTimeout(function(){
                        taco.active = true;
                        taco.x = 100;//for tutorial
                        taco.y = 300;
                        taco.body.velocity.x = 0;
                        taco.body.velocity.y = 0;
                        returnSprites();
                        resumeSprites();
                        camera.startFollow(taco, false, 0.1, 0.1);
                        drillers.children.iterate(function(child) {
                            child.started = false;
                        });
                        dead = false;
                    }, 450);
                }*/
                
                burritos.children.iterate(function(child) {
                    child.dying = false;
                });
                
                taco.body.x = 100;//for tutorial
                taco.body.y = 300;
                taco.body.velocity.x = 0;
                taco.body.velocity.y = 0;
                returnSprites();
                resumeSprites();
                camera.startFollow(taco, false, 0.1, 0.1);
                drillers.children.iterate(function(child) {
                    child.started = false;
                });
            }
            //creating entities
            function newEntity(type, x, y, offsetX) {
                
                if (type == 4) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 4;
                    var coin = coins.create(x+16, y+16, 'coin1');//.setScale(2);//.refreshBody();// this causes a bug i think?
                    coin.anims.play('coin');
                    coin.setOrigin(0.5, 0.5);
                    coin.setScale(2);
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 5) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 5;
                    var burrito = burritos.create(x+16, y+32, 'burrito1').setGravity(0, 1500);//32 because it is two "blocks" tall.
                    burrito.anims.play('burritoAnimation');
                    burrito.setScale(2)//.refreshBody(); apparently this causes bugs???
                    //burrito.body.bounce.y = 1; we don't want it to stop when it is in tight spaces.
                    burrito.body.bounce.x = 1;
                    burrito.body.velocity.x = 0;//normally 200 but doesn't need to move yet.
                    burrito.body.allowGravity = false;
                    //look above :)
                    burrito.initX = x;
                    burrito.initY = y;
                    burrito.initXV = 200;
                    burrito.initYV = 0;
                    //tree killing
                    burrito.triggered = false;
                    burrito.frozen = false;
                    
                }
                if (type == 6) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 6;
                    var driller = drillers.create(x+8, y+32+16, 'drill1').setGravity(0, 1000);//32 because it is two "blocks" tall.
                    driller.anims.play('drillingAnimation');
                    driller.setScale(3)//.refreshBody(); apparently this causes bugs???
                    //driller.body.bounce.y = 1;
                    driller.body.bounce.x = 1;
                    driller.body.allowGravity = false;
                    //look above :)
                    driller.initX = x;
                    driller.initY = y;
                    driller.initXV = 200;
                    driller.initYV = 0;
                    driller.started = false;
                    driller.que = 0;
                    driller.lives = 0;
                    driller.invincible = false;
                    
                }
                if (type == 7) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 7;
                    var tree = trees.create(x+74, y+76, 'tree1');
                    tree.setScale(0.75)//.refreshBody(); apparently this causes bugs???
                    
                    tree.body.allowGravity = false;
                    //look above :)
                    tree.initX = x;
                    tree.initY = y;
                    tree.initXV = 0;
                    tree.initYV = 0;
                    tree.triggered = "none";
                    tree.angleSpeed = 0;
                    tree.setOrigin(0.5, 1);
                    tree.depth = -1;
                }
                if (type == 8) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 8;//because this isn't going to be perfectly centered, we don't add anything to the y
                    var mite = mites.create(x+16, y+0, 'mite1')
                    mite.setScale(3)//.refreshBody(); apparently this causes bugs???
                    mite.anims.play('growingMite');
                    mite.originY = 0;
                    //mite.body.allowGravity = false;
                    //look above :)
                    mite.initX = x;
                    mite.initY = y;
                    mite.initXV = 0;
                    mite.initYV = 0;
                }
                if (type == 9) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 9;
                    image = 'drop' + String(random(1, 6));
                    var rock = rocks.create(x+16, y+0, image).setGravity(0, 500);//throwing should be a bit more moonlike.
                    rock.setScale(2);
                    rock.body.bounce.x = 0.3;
                    rock.body.bounce.y = 0.3;
                    rock.allowGravity = false;
                    rock.initX = x;
                    rock.initY = y;
                    rock.initXV = 0;
                    rock.initYV = 0;
                    rock.held = false;

                }
                if (type == 10) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 10;
                    var coin = burritoBarriers.create(x+16, y+16, 'barrier').setScale(1.1).refreshBody(); //this causes a bug i think?
                    coin.originX = 0.5;
                    coin.originY = 0.5;
                    coin.body.gravity.y = 0;
                    //too lazy to rename the coin.
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                }
                if (type == 11) {
                    //bottles, but variables are called coins from the first one. Same with type 10.
                    entity1[Math.round(y/32)][Math.round(x/32)] = 11;
                    var coin = bottles.create(x+16, y+16, 'iceBottle').setScale(2);//.refreshBody(); this causes a bug i think?
                    coin.setOrigin(0.5, 0.5);
                    
                    coin.body.gravity.y = 500;
                    coin.body.bounce.y = 0.3;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                    coin.depth = 2;
                    coin.body.allowGravity = false;
                } 
                if (type == 12) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 12;
                    var coin = lava.create(x, y+14, 'lava1').setScale(2)//.refreshBody(); this causes a bug i think?
                    coin.setOrigin(0.5, 0.5);
                    coin.anims.play('lava');
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 13) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 13;
                    var coin = platforms.create(x+offsetX, y, 'platform').setScale(0.5).refreshBody(); //this causes a bug i think?
                    
                    coin.body.gravity.y = 0;
                    coin.body.setAllowGravity(false);
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 250;
                    coin.initYV = 0;
                    coin.distance = 300;//how far it goes.
                    coin.setFrictionX(1);
                    coin.dir = 1;
                    coin.body.setImmovable = true;
                    coin.setOrigin(0.5, 0.5);
                    
                } 
                if (type == 14) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 4;
                    var coin = limes.create(x, y, 'lime').setScale(3)//.refreshBody(); this causes a bug i think?
                    coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 500;
                    coin.body.bounce.x = 1;
                    coin.body.bounce.y = 0.3;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                    coin.body.allowGravity = false;
                    coin.body.mass = 1;
                } 
                if (type == 15) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 4;
                    var coin = flags.create(x+16, y+8, 'flag').setScale(0.15)//.refreshBody(); this causes a bug i think?
                    coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 16) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 16;
                    var coin = platformsLeft.create(x+offsetX, y, 'platform').setScale(0.5).refreshBody(); //this causes a bug i think?
                    //coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    coin.body.setAllowGravity(false);
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = -250;
                    coin.initYV = 0;
                    coin.distance = 300;//how far it goes.
                    coin.setFrictionX(1);
                    coin.dir = 1;
                    coin.body.setImmovable = true;
                    coin.setOrigin(0.5, 0.5);
                    
                } 
                if (type == 17) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 17;
                    var coin = platformsUp.create(x+offsetX, y, 'platform').setScale(0.5).refreshBody(); //this causes a bug i think?
                    //coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    coin.body.setAllowGravity(false);
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = -250;
                    coin.distance = 300;//how far it goes.
                    coin.dir = -1;
                    coin.body.setImmovable = true;
                    coin.setOrigin(0.5, 0.5);
                } 
                if (type == 18) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 18;
                    var coin = platformsDown.create(x+offsetX, y, 'platform').setScale(0.5).refreshBody();// this causes a bug i think?
                    //coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    coin.body.setAllowGravity(false);
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 250;
                    coin.distance = 300;//how far it goes.
                    coin.setFrictionX(1);
                    coin.dir = 1;
                    coin.body.setImmovable = true;
                    coin.setOrigin(0.5, 0.5);
                    
                } 
                if (type == 19) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 19;
                    var coin = creams.create(x+16, y+16, 'cream');//.setScale(2);//.refreshBody();// this causes a bug i think?
                    coin.setScale(0.5000001);
                    coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
            }
            function returnSprites() {
                camera.stopFollow();
                camera.startFollow(taco, false, 0.1, 0.1);
                coins.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('coin');
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                
                });
                burritos.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('burritoAnimation');
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.triggered = false;
                    child.frozen = false;
                    Phaser.tacoHarmony.active = true;
                    child.setTint(0xffffff);//clear tint.
                            
                });
                drillers.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('drillingAnimation');
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.setOrigin(0.5, 0.5);
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.invincible = false;
                });
                rocks.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.held = false;
                            
                });
                bottles.children.iterate(function(child) {
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.x = child.initX;
                    child.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.held = false;
                    child.angle = 0;
                });
                lava.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('lava');
                
                });
                platforms.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                
                });
                platformsLeft.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                
                });
                platformsUp.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                
                });
                platformsDown.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                
                });
                limes.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                            
                });
            }
            function resumeSprites() {
                
                coins.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('coin');
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                    

                
                });
                burritos.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                            
                });
                drillers.children.iterate(function(child) {/*
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;*/
                    child.body.gravity.y = 1000;
                    child.que = 0;
                });
                mites.children.iterate(function(child) {
                    if (child.body.velocity.y == 0) {
                        child.setOrigin(0.5, 0);
                        child.refreshBody();
                        child.body.allowGravity = true;
                        //child.body.x = child.initX;
                        //child.body.y = child.initY;
                        child.body.velocity.x = child.initXV;
                        child.body.velocity.y = child.initYV;
                        child.anims.stop();
                        child.anims.play('growingMite');
                    }
                    child.body.x = child.initX+16-(child.body.width/2);
                });
                rocks.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                    //we need to re enable gravity as well because of the way we hold the rock
                    child.body.gravity.y = 500;
                            
                });
                trees.children.iterate(function(child) {
                    child.angle = 0;
                    child.triggered = "none";
                    child.angleSpeed = 0;
                });
                bottles.children.iterate(function(child){
                    child.body.allowGravity = true;
                    child.body.gravity.y = 500;
                });
                platforms.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                });
                platformsLeft.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                });
                platformsUp.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                });
                platformsDown.children.iterate(function(child) {
                    child.body.velocity.x = /*child.initXV*/0;
                    child.body.velocity.y = child.initYV;
                });
                limes.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                            
                });
            }

            function updateColliders() {
                //player update collider
                taco.body.offset.x =  0;
                taco.body.offset.y = 0;
                taco.body.width = taco.width*taco._scaleX;
                taco.body.height = taco.height*taco._scaleY;
                //coins update collider
                coins.children.iterate(function(child) {
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;
                });
                //mites update collider
                mites.children.iterate(function(child) {
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;
                });
                //burrito update collider 
                /*
                burritos.children.iterate(function(child) {
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;
                });*/
                //drill boss 
                
                drillers.children.iterate(function(child) {
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;
                });
            }
            //this variable is used later for the level editing
            var typeEdit = 0;
            var creative = false;
            var mainMusic;
            function create ()
            {
                //text and menu type stuff.
                //levelDisplay = this.add.text(400, 300, 'Level ' + level, {fontFamily: 'Arial', fontSize: '32px', fill: 'white' });//.setOrigin(0.5);
                //vars for tutorial
                
                // "tutorial" var is in the code above
                tutorialSequence = 0;
                //stop sound from last level.
                this.game.sound.stopAll();
                //we don't want this to be shown yet
                this.physics.world.drawDebug = false;
                this.cameras.main.roundPixels = true;
                camera = this.cameras.main;
                camera.zoom = 1.3;
                this.camera = camera; //better access.
                if (fullScreen) {
                    camera.zoom = 1.5;
                }
                //music
                mainMusic = this.sound.add('mainMusic');
                burritoJump = this.sound.add('burritoJump');
                this.walkingSound = this.sound.add('walking');
                console.log(this.walkingSound);
                this.walkingSound.loop = true;
                
                mainMusic.loop = true;
                mainMusic.play();
                console.log(mainMusic);
                this.graphics = this.add.graphics();
                //the variables of the game.
                tacoVelocityX = 0;
                select = 0;

                
                //main game tilemap below
                
                mmap1 = [
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [ 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]]
                
                map = this.make.tilemap({data: map1, tileWidth: 32, tileHeight: 32});
                map.addTilesetImage('landscape')//.setScale(0.5).refreshBody();
                layer1 = map.createLayer(0, 'landscape', 0, 0);
                
                //we need to also have a list for moving or animated level parts
                
                eentity1 = [
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
                [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1 ,-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]];
                
                function createEntities(entityList, gridWidth, gridHeight) {
                    creative = true;
                    for (var i=0; i<entityList.length; i += 1) {
                        for (var e=0; e<entityList[0].length; e += 1) {
                            var platformOffset = 0;
                            if (entityList[i][e] == 13 || entityList[i][e] == 16 || entityList[i][e] == 17 || entityList[i][e] == 18) {
                                platformOffset = 64;
                            }
                            newEntity(entityList[i][e], -16+(e*gridHeight)+gridHeight/2, -16+(i*gridWidth)+gridWidth/2, platformOffset);
                        }
                    }
                    creative = false;
                    resumeSprites();
                }
                //the background
                clouds = this.physics.add.group();
                for (var i = 0; i < 15; i += 1) {
                    cloud = clouds.create(random(1, layer1.width), random(1, 450), 'cloud' + String(random(1, 2))).setScale(random(30, 40)/10).refreshBody(); 
                    if (random(1, 2) == 1) {
                        cloud.body.velocity.x = random(25, 50);
                    } else {
                        cloud.body.velocity.x = random(-25, -50);
                    }
                    cloud.depth = -2;
                    if (random(1, 2) == 1) {
                        cloud.flipX = true;
                    }
                }

                //game.stage.backgroundColor = "#4488AA";
                
                
                //initial gathering the special tiles :)
                spikes = map.filterTiles(function (tile) {
                    return (tile.index == 1);
                });
                flag = map.filterTiles(function (tile) {
                    return (tile.index == 9);
                });
                
                //layer1.setFrictionX(5);
                

                //animations below
                //drilling around
                this.anims.create({key:'drillingAnimation',
                 frames: [{key: 'drill1'},
                 {key: 'drill2'},
                 {key: 'drill3'},
                 {key: 'drill4'},
                 {key: 'drill5'},
                 {key: 'drill6'},
                 {key: 'drill7'},
                 {key: 'drill8'},
                 {key: 'drill9'},],
                frameRate:10,
                repeat:-1});
                this.anims.create({key:'downAnimation',
                 frames: [{key: 'down1'},
                 {key: 'down2'/*, width:16, height:31*/},
                 {key: 'down3'},
                 {key: 'down4'},
                 {key: 'down5'},
                 {key: 'down6'},
                 {key: 'down7'},
                 {key: 'down8'},
                 {key: 'down9'},
                 {key: 'down10'},
                 {key: 'down11'},
                 {key: 'down12'},
                 {key: 'down13'},
                 {key: 'down14'},],
                frameRate:10,
                repeat:0});
                this.anims.create({key:'upAnimation',
                 frames: [{key: 'down13'},
                 {key: 'down12'/*, width:16, height:31*/},
                 {key: 'down11'},
                 {key: 'down10'},
                 {key: 'down9'},
                 {key: 'down8'},
                 {key: 'down7'},
                 {key: 'down6'},
                 {key: 'down5'},
                 {key: 'down4'},
                 {key: 'down3'},
                 {key: 'down2'},
                 {key: 'down1'},],
                frameRate:45,
                repeat:0});
                this.anims.create({key:'poppingAnimation',
                 frames: [{key: 'up1'},
                 {key: 'up2'/*, width:16, height:31*/},
                 {key: 'up3'},
                 {key: 'up4'},
                 {key: 'up5'},],
                frameRate:20,
                repeat:0});
                this.anims.create({key:'shredingAnimation',
                 frames: [{key: 'shred1'},
                 {key: 'shred2'/*, width:16, height:31*/},
                 {key: 'shred3'},
                 {key: 'shred4'},
                 {key: 'shred5'},
                 {key: 'shred6'},],
                frameRate:20,
                repeat:-1});
                this.anims.create({key:'unPoppingAnimation',
                 frames: [{key: 'up5'},
                 {key: 'up4'/*, width:16, height:31*/},
                 {key: 'up3'},
                 {key: 'up2'},
                 {key: 'up1'},
                 {key: 'down14'},],//down 14 is a transparent image :)
                frameRate:20,
                repeat:0});
                //burrito
                this.anims.create({key:'burritoAnimation',
                 frames: [{key: 'burrito1'},
                 {key: 'burrito2'/*, width:16, height:31*/},
                 {key: 'burrito3'},
                 {key: 'burrito4'},
                 {key: 'burrito5'},
                 {key: 'burrito6'},
                 {key: 'burrito7'},
                 {key: 'burrito8'},],
                frameRate:10,
                repeat:-1});
                //lava
                this.anims.create({key:'lavaAnimation',
                 frames: [{key: 'lava1'},
                 {key: 'lava2', width:16, height:31},
                 {key: 'lava3'},
                 {key: 'lava4'},
                 {key: 'lava5'},
                 {key: 'lava6'},
                 {key: 'lava7'},
                 {key: 'lava8'},],
                frameRate:10,
                repeat:-1});
                //moving right
                this.anims.create({key: 'right',
                 frames: [{key: 'right1'},
                {key: 'right2'},],
                frameRate:10,
                repeat:-1});
                //moving left
                this.anims.create({key: 'left',
                 frames: [{key: 'left1'},
                {key: 'left2'},],
                frameRate:10,
                repeat:-1});
                //holding still
                this.anims.create({key: 'holdStill',
                 frames: [{key: 'still'},],
                frameRate:10,
                repeat:-1});
                //coin
                this.anims.create({key: 'coin',
                 frames: [{key: 'coin1'},
                {key: 'coin3'},
                {key: 'coin2'},
                {key: 'coin4'},],
                frameRate:10,
                repeat:-1});
                //mites
                this.anims.create({key: 'growingMite',
                 frames: [{key: 'mite1'},
                {key: 'mite2'},
                {key: 'mite3'},
                {key: 'mite4'},
                {key: 'mite5'},],
                frameRate:0.3,
                repeat:0});
                //potato
                this.anims.create({key: 'potatAnim',
                 frames: [{key: 'potat1'},
                {key: 'potat2'},],
                frameRate:10,
                repeat:-1});
                //lava
                this.anims.create({key: 'lava',
                 frames: [{key: 'lava1'},
                {key: 'lava2'},
                {key: 'lava3'},
                {key: 'lava4'},
                {key: 'lava5'},
                {key: 'lava6'},
                {key: 'lava7'},
                {key: 'lava8'},],
                frameRate:10,
                repeat:-1});

                //end of animations :)
                //but start of particle emitters
                ingredients = this.add.particles('burritoParticles');
                //we make a few of these just in case more than one burrito needs one.
                ingredientEmitters = [];
                for (var i=0; i < 6; i += 1) {
                    ingredientEmitters.push(ingredients.createEmitter({
                        frame: [0, 1, 2, 3],
                        x: 500,
                        y: 500,
                        frequency: 50,
                        quantity: 0,
                        angle: { min: -180, max: 180 },
                        speed: 200,
                        gravityY: 100,
                        lifespan: { min: 1000, max: 2000 },
                    }));
                }
                ingredientEmitter = ingredients.createEmitter({
                    frame: [0, 1, 2, 3],
                    x: 500,
                    y: 500,
                    frequency: 50,
                    quantity: 0,
                    angle: { min: -180, max: 180 },
                    speed: 200,
                    gravityY: 100,
                    lifespan: { min: 1000, max: 2000 },
                });
                dirtEmitter = ingredients.createEmitter({
                    frame: [0],
                    x: 500,
                    y: 500,
                    frequency: 120,
                    quantity: 0,
                    angle: { min: -150, max: -30 },
                    speed: 100,
                    gravityY: 200,
                    lifespan: { min: 200, max: 400 },
                });
                dirtEmitter.setScale(0.5);
                //able to restart later
                this.restartGame = function() {
                    this.scene.restart();
                }
                //tutorial potato
                potat = this.physics.add.sprite(400, 400, 'potat1').setScale(2.3).refreshBody();
                potat.anims.play('potatAnim');
                potat.depth = 2;
                potat.summoned = false;//only used outside of tutorial.
                if (tutorial == true) {
                    potat.visible = true;
                } else {
                    potat.visible = false;
                }
                
                //player sprite
                if (tutorial == true) {
                    taco = this.physics.add.sprite(400, 300, 'still').setScale(1.75).refreshBody();
                } else {
                    taco = this.physics.add.sprite(100, 300, 'still').setScale(1.75).refreshBody();
                }
                taco.disabled = false;//control whether they can move;
                taco.cream = false;
                taco.body.gravity.y = 1150;
                taco.body.drag.x = 100;
                taco.depth = 2;
                taco.setFrictionX(1);
                //collisions with player
                layer1.setCollision([0, 2, 3, 8, 10]);
                this.physics.add.collider(taco, layer1);
                //entity groups etc
                //creating the groups
                coins = this.physics.add.group();
                drillers = this.physics.add.group();
                trees = this.physics.add.group();
                burritos = this.physics.add.group();
                mites = this.physics.add.group();
                rocks = this.physics.add.group();
                drillerFlags = this.physics.add.group();
                burritoBarriers = this.physics.add.staticGroup();
                bottles = this.physics.add.group();
                iceBalls = this.physics.add.group();
                lava = this.physics.add.group();
                platforms = this.physics.add.group({
                    immovable: true
                });
                platformsLeft = this.physics.add.group({
                    immovable: true
                });
                platformsUp = this.physics.add.group({
                    immovable: true
                });
                platformsDown = this.physics.add.group({
                    immovable: true
                });
                limes = this.physics.add.group();
                flags = this.physics.add.group();
                creams = this.physics.add.group();
                
                //not necesariily a group but goes along with rocks
                arrow = this.physics.add.sprite(taco.body.x, taco.body.y, 'aimArrow').setScale(4).refreshBody();
                arrow.setOrigin(0.5, 1);
                arrow.visible = false;
                arrow.depth = 3;
                arrow.direction = 1;
                //colliding/overlaping the groups
                this.physics.add.overlap(taco, coins, collectCoin, null, this);
                this.physics.add.overlap(taco, burritos, hitBurrito, null, this);
                this.physics.add.overlap(taco, drillers, hitDrill, null, this);
                this.physics.add.overlap(taco, rocks, touchingRock, null, this);
                this.physics.add.overlap(mites, rocks, rockHitMite, null, this);
                this.physics.add.overlap(mites, drillers, drillerHitMite, null, this);
                this.physics.add.overlap(taco, mites, tacoHitMites, null, this);
                this.physics.add.overlap(rocks, drillers, rockHitDriller, null, this);
                this.physics.add.overlap(taco, trees, tacoHitTree, null, this);
                this.physics.add.overlap(burritos, trees, burritoHitTree, null, this);
                this.physics.add.overlap(taco, bottles, tacoHitBottle, null, this);
                this.physics.add.overlap(burritos, iceBalls, burritoHitIceBall, null, this);
                this.physics.add.overlap(burritos, burritos, burritoHitBurrito, null, this);
                this.physics.add.overlap(taco, lava, tacoHitLava, null, this);
                this.physics.add.overlap(burritos, limes, burritoHitLime, null, this);
                this.physics.add.overlap(taco, limes, tacoHitLime, null, this);
                this.physics.add.overlap(taco, flags, tacoHitFlag, null, this);
                this.physics.add.overlap(taco, creams, tacoHitCream, null, this);

                this.physics.add.collider(rocks, rocks);
                this.physics.add.collider(burritos, layer1);
                this.physics.add.collider(drillers, layer1);
                this.physics.add.collider(rocks, layer1);
                this.physics.add.collider(burritos, burritoBarriers);
                this.physics.add.collider(bottles, layer1);
                this.physics.add.collider(burritos, burritos);
                this.physics.add.collider(taco, platforms);
                this.physics.add.collider(taco, platformsLeft);
                this.physics.add.collider(taco, platformsUp);
                this.physics.add.collider(taco, platformsDown);
                this.physics.add.collider(limes, layer1);
                this.physics.add.collider(taco, limes);
                this.physics.add.collider(limes, limes);
                this.physics.add.collider(limes, burritos);
                Phaser.tacoHarmony = this.physics.add.collider(taco, burritos);//have to access it elsewhere
                Phaser.tacoHarmony.active = false;

                //reaction functions
                function collectCoin(Taco, coin) {//taco capitalized so that we don't confuse it with regular "taco"
                    coin.disableBody(true, true);
                    
                }
                function hitBurrito(Taco, burrito) {
                    if (burrito.frozen == false) {
                        death();
                    }

                    
                }
                function burritoHitTree(burrito, tree) {
                    if (tree.triggered == true && burrito.triggered == false) {
                        burrito.triggered = true;
                        /*
                        var ingredientSelect = 0;//default is zero to prevent bugs when too many burritos
                        //loop through emitters
                        for (var i = 0; i < ingredientEmitters.length; i += 1) {
                            if (ingredientEmitters[i].quantity.propertyValue == 0) {
                                //when we find the right one give us it.
                                ingredientSelect = i;
                                break;
                                
                            }
                        }
                        ingredientEmitters[ingredientSelect].setPosition(burrito.x, burrito.y);
                        ingredientEmitters[ingredientSelect].setQuantity(10);
                        setTimeout(function() {burrito.body.blocked.down = false;burrito.disableBody(true, true);ingredientEmitters[ingredientSelect].setQuantity(0)}, 300);
                        */
                       ingredientParticleEmit(burrito.x, burrito.y, 10, 300, burrito);
                        //we set the burrito blocked to false, so that the sound that it makes doesn't persist.
                        //setTimeout(function(){console.log('hi');ingredientEmitter.setPosition(burrito.x, burrito.y);ingredientEmitter.explode();}, 200);
                        //setTimeout(function(){ingredientEmitter.setPosition(burrito.x, burrito.y);ingredientEmitter.explode()}, 400);
                        //setTimeout(function(){ingredientEmitter.setPosition(burrito.x, burrito.y);ingredientEmitter.explode()}, 500);
                        
                        
                    }
                }
                
                function rockHitMite(mite, rock) {
                    mite.body.gravity.y = 1000;
                    mite.anims.stop();
                }
                function drillerHitMite(mite, driller) {
                    if (driller.invincible == false) {
                        mite.body.x = mite.initX;
                        mite.body.y = mite.initY;
                        mite.body.gravity.y = 0;
                        mite.body.velocity.y = 0;
                        mite.anims.stop();
                        mite.anims.play("growingMite");
                        driller.lives -= 1;
                        if (driller.lives < 1) {
                            
                            setTimeout(function(){camera.shake(2000, 0.03)}, 400);
                            
                            driller.disableBody(true, true);
                            ingredientParticleEmit(driller.x, driller.y, 40, 1500, false);
                            
                        }
                    }
                }
                function hitDrill (taco, drill) {
                    death();
                };
                function tacoHitMites(taco, mite) {
                    death();
                }
                function rockHitDriller(rock, driller) {
                    if (driller.invincible == true && rock.body.velocity.y < 50) {
                        rock.body.velocity.y = -300;
                    }
                }
                this.dirX = 0;
                this.dirY = -500;
                this.dirChange = 1;
                function touchingRock(Taco, Rock) {
                    if (keySpace.isDown) {
                        var anyHeld = false;
                        rocks.children.iterate(function(child) {
                            if (child.held) {
                                anyHeld = true;
                            }
                        })
                        if (anyHeld == false) {
                            Rock.held = true;
                        } 
                        /*
                        rocks.children.iterate(function(child) {
                            if (child.held == true && !(child == Rock)) {
                                Rock.held = false;
                            } else {
                                Rock.held = true;
                            }
                        });*/
                    }

                }
                function tacoHitTree(Taco, Tree) {
                    if (Tree.triggered == "none" && keySpace.isDown) {
                        Tree.triggered = true;
                        Tree.body.offset.x =  0;
                        Tree.body.offset.y = 0;
                        Tree.body.width += 175;
                    }
                }
                function tacoHitBottle(Taco, Bottle) {
                    if (keySpace.isDown) {
                        
                        Bottle.held = true;
                        //Bottle.allowGravity = false;
                        Bottle.body.gravity.y = 0;
                        Bottle.body.velocity.y = 0;
                        if (camera.zoom > 1) {
                            camera.zoom -= 0.015;
                        }
                    }
                }
                function burritoHitIceBall(Burrito, Ball) {
                    Burrito.frozen = true;
                    Burrito.body.velocity.x = 0;
                    Burrito.setTint(0x0101CC);
                    //Phaser.tacoHarmony.active = true;
                    Burrito.anims.stop();
                    Ball.destroy();
                }
                function burritoHitBurrito(burrito1, burrito2) {
                    if (burrito1.frozen == true && Math.abs(burrito1.body.velocity.x) > 220 && burrito2.frozen == false) {
                        burrito2.disableBody(true, true);
                        ingredientParticleEmit(burrito2.x, burrito2.y, 10, 300, burrito2);
                    }
                }
                function tacoHitLava(Taco, Lava) {
                    death();
                } 
                function burritoHitLime(Burrito, Lime) {
                    if (Math.abs(Lime.body.velocity.x) > 150) {
                        ingredientParticleEmit(Burrito.x, Burrito.y, 10, 400, Burrito);
                        Burrito.disableBody(true, true);
                        Lime.body.velocity.x *= 2;
                        if (Math.abs(Lime.body.velocity.x) > 550) {
                            Lime.body.velocity.x = 550 * (Lime.body.velocity.x / Math.abs(Lime.body.velocity.x));
                        }

                    }
                }
                function tacoHitLime(Taco, Lime) {
                    if (Math.abs(Lime.body.velocity.x) > 300) {
                        if (Lime.x > Taco.x && Lime.body.velocity.x < 0) {
                            death();
                        } else if (Lime.x < Taco.x && Lime.body.velocity.x > 0) {
                            death();
                        }
                        
                    }
                }
                var transportThis = this;//allow us to restart the game in a callback.
                function tacoHitFlag(Taco, Flag) {
                    if (taco.disabled == false) {
                        transportThis = this;
                        taco.disabled = true;
                        //camera.fadeOut(1000);
                        //stopmusic = setInterval(function(){if (this.mainMusic.volume > 0){this.mainMusic.volume -= 0.02;}}, 20);
                        /*
                        camera.once('camerafadeoutcomplete', function (camera) {
                            clearInterval(stopmusic);
                            nextLevel();
                            transportThis.scene.restart();
                        });*/
                        setTimeout(function() {
                            //clearInterval(stopmusic);
                            nextLevel();
                            transportThis.scene.restart();
                        }, 4000);
                    }
                }
                function tacoHitCream(Taco, Cream) {
                    taco.cream = true;
                }
                //burritoparticles
                //this is where the ingredientParticle emit funciton was.
                //accessing this elsewhere
                this.ingredientParticleEmit = ingredientParticleEmit;
                //create the entities
                createEntities(entity1, 32, 32);
                //text on top
                //font
                
                add = this.add;
                WebFont.load({
                    custom: {
                        families: [ 'mono' ]
                    },
                    active: function ()
                    {
                        //add.text(32, 32, 'Bad Bad Burritos', { fontFamily: 'mono', fontSize: 60, color: '#ffffff' });
                    }
                });
                textBox = this.add.image(400, /*115*/170, 'text').setScale(0.2);
                textBox.scrollFactorX = 0;
                textBox.scrollFactorY = 0;
                if (tutorial == true) {
                    textBox.visible = true;
                } else {
                    textBox.visible = false;
                }
                
                //tutorial vars at the top of create function, for earlier use.
                
                //the main camera
                this.cameras.main.setBounds(0, 0, map.widthInPixels, map.heightInPixels);//infinite worlds
                this.cameras.main.startFollow(taco, false, 0.1, 0.1);
                //restart
                this.restart = function () {
                    this.scene.restart();
                }

            }
            function ingredientParticleEmit(x, y, quantity, time, burrito) {
                    var ingredientSelect = 0;//default is zero to prevent bugs when too many burritos
                        //loop through emitters
                        for (var i = 0; i < ingredientEmitters.length; i += 1) {
                            if (ingredientEmitters[i].quantity.propertyValue == 0) {
                                //when we find the right one give us it.
                                ingredientSelect = i;
                                break;
                                
                            }
                        }
                        ingredientEmitters[ingredientSelect].setPosition(x, y);
                        ingredientEmitters[ingredientSelect].setQuantity(quantity);
                        if (burrito) {//checks if it exists.
                            burrito.dying = true;
                            setTimeout(function() {
                                if (burrito.dying) {//we have this here so that if we die before it does, the burrito stays alive.
                                    burrito.body.blocked.down = false;
                                    burrito.disableBody(true, true);
                                }
                                ingredientEmitters[ingredientSelect].setQuantity(0);
                            }, time);
                        } else {
                            setTimeout(function() {ingredientEmitters[ingredientSelect].setQuantity(0)}, time);
                        }
                        
                }
            //goes with text function as global var
            var currentDialog;
            function text(text, delay, action) {
                var makeText = setInterval(drawCurrentText, 50);
                if (currentDialog) {
                    currentDialog.destroy();
                }
                add = this.add;
                WebFont.load({
                    custom: {
                        families: [ 'mono' ]
                    },
                    active: function ()
                    {
                        
                        currentDialog = add.text(263, 40 + 68, text.charAt(0), { fontFamily: 'mono', fontSize: 17, color: '#ffffff' });
                        currentDialog.scrollFactorX = 0;
                        currentDialog.scrollFactorY = 0;
                    }

                });
                function drawCurrentText() {
                    if (text.charAt(currentDialog._text.length) == ' ') {
                        if (currentDialog.setText) {
                            currentDialog.setText(currentDialog._text + text.charAt(currentDialog._text.length));
                        }
                        
                    }
                    if (currentDialog.setText) {
                            currentDialog.setText(currentDialog._text + text.charAt(currentDialog._text.length));
                        }
                    if (currentDialog._text == text) {
                        clearInterval(makeText);
                        action();
                    }
                }
            }
            function nextLevel() {
                
                level += 1;
                updateCurrentLevel();
                
            }
            //mr potat summoning
            function summonPotat() {
                taco.disabled = true;
                textBox.visible = true;
                if (textBox.scale < 4) {
                    textBox.scale += 0.2;
                } else {
                    potat.x = taco.x - 350;
                    potat.visible = true;
                    potat.summoned = true;
                }
            }
            function banishPotat() {
                taco.disabled = false;
                text('', 30, function(){});
                textBox.visible = false;
                textBox.scale = 0.2;
                potat.visible = false;
                potat.summoned = false;
                //this.ingredientParticleEmit(potat.x, potat.y, 20, 300, false);
            }
            //all level sequences ith mr potat besides the tutorial
            var textSequence = 0;
            var checkpoint = 0;
            function sequence() {
                if (level == 1) {
                    if (taco.x > 640 && checkpoint == 0) {
                        if (potat.summoned == false) {
                            summonPotat();
                        }
                        if (potat.summoned) {
                            if (textSequence == 0) {
                                textSequence += 1
                                text('well what do we\nhave here?', 30, function(){setTimeout(function(){textSequence += 1}, 1500)});
                            }
                            if (textSequence == 2) {
                                textSequence += 1
                                text('it looks like \nanother tree?', 30, function(){setTimeout(function(){textSequence += 1}, 1500)});
                            }
                            if (textSequence == 4) {
                                textSequence += 1
                                text('i bet it works\nthe same way.', 30, function(){setTimeout(function(){textSequence += 1}, 1500)});
                            }
                            if (textSequence == 6) {
                                textSequence += 1
                                text('well, good luck!', 30, function(){setTimeout(function(){textSequence += 1}, 1500)});
                            }
                            if (textSequence == 8) {
                                textSequence = 7;
                                ingredientParticleEmit(potat.x, potat.y, 30, 300, false);
                                banishPotat();
                                checkpoint += 1;
                            }
                        }
                    }
                }
            }
            function update ()
            {
                sequence();
                //update clouds and background
                if (random(1, 150) == 3) {
                    
                    if (random(1, 2) == 1) {
                        cloud = clouds.create(-200, random(1, 450), 'cloud' + String(random(1, 2))).setScale(random(30, 40)/10).refreshBody(); 
                        cloud.body.velocity.x = random(25, 50);
                    } else {
                        cloud = clouds.create(layer1.width + 200, random(1, 450), 'cloud' + String(random(1, 2))).setScale(random(30, 40)/10).refreshBody(); 
                        cloud.body.velocity.x = random(-25, -50);
                    }
                    cloud.depth = -2;
                    if (random(1, 2) == 1) {
                        cloud.flipX = true;
                    }
                }
                
                var mousePointer = this.input.activePointer.positionToCamera(this.cameras.main);

                
                var tileSelectX = map.worldToTileX(mousePointer.x);
                var tileSelectY = map.worldToTileY(mousePointer.y);

                //keys
                cursors = this.input.keyboard.createCursorKeys();
                keyB = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.B);
                keyM = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M);
                keyC = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C);
                keyE = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E);
                keyF = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F);
                keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
                keyW = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);
                keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
                keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

                //make sure the camera zoom is right
                if (camera.zoom <= 1.3 && keySpace.isDown == false) {
                    camera.zoom += 0.015;
                }
                //debugging cursor position
                if (keyC.isDown) {
                    alert(String(Math.round(mousePointer.x)) + ' ' + String(Math.round(mousePointer.y)));
                    this.scene.restart();
                }
                if (keyF.isDown) {
                    var exMap = '[';
                    for (var i=0; i<map1.length; i += 1) {
                        exMap = String(exMap) + '[' + String(map1[i]) + ']' + ', ';
                    }
                    //exMap.charAt(exMap.length-1) = ']';
                    console.log(exMap);
                    
                    document.getElementById('outputMap').innerHTML = exMap;
                    var exEntity = '[';
                    for (var i=0; i<entity1.length; i += 1) {
                        exEntity = String(exEntity) + '[' + String(entity1[i]) + ']' + ', ';
                    }
                    
                    //exEntity.charAt(exEntity.length-1) = ']';
                    console.log(exEntity);
                    
                    document.getElementById('outputEntity').innerHTML = exEntity;
                    /*
                    for (var i=0; i<entity1.length; i += 1) {
                        console.log(String(entity1[i]));
                    }*/
                }
                //before doing anything with creative, it is important that the positions of sprites are all working the right way animations wise
                updateColliders();
                
                //creative mode decisions
                
                if (keyM.isDown) {
                    if (creative == false) {
                        creative = true;
                        returnSprites();
                        taco.body.checkCollision.none = true;
                        taco.body.allowGravity = false;
                        taco.body.velocity.y = 0;
                        this.physics.world.drawDebug = true;
                        camera.startFollow(taco, false, 0.1, 0.1);
                        alert('creative mode on');
                    } else {
                        creative = false;
                        resumeSprites();
                        taco.body.checkCollision.none = false;
                        taco.body.allowGravity = true;
                        this.physics.world.drawDebug = false;
                        this.physics.world.debugGraphic.clear();
                        camera.startFollow(taco, false, 0.1, 0.1);
                        alert('creative mode off');
                    }
                }
                //tutorial code and potat code.
                access = this;
                if (potat) {
                    if (potat.x > taco.x+100) {
                        potat.body.velocity.x = -200;
                    }else if (potat.x < taco.x-100) {
                        potat.body.velocity.x = 200;
                    } else {
                        potat.body.velocity.x *= 0.94;
                    }
                }
                if (tutorial == true) {
                    if (textBox.scale < 4) {
                        textBox.scale += 0.2;
                    } else {
                        var intro = false
                        if (tutorialSequence == 0) {
                            tutorialSequence = 1;
                            taco.disabled = true;
                            intro = text('Hi there. My name\nis Mr. Potat.\n\nPress Space to Cont.', 150, function(){tutorialSequence = 2;});
                            
                        }
                        if (keySpace.isDown && tutorialSequence == 2) {
                            taco.disabled = false;
                            tutorialSequence = 3;
                            text('Try pressing the \narrow keys to \nmove/jump.', 150, function(){tutorialSequence = 4;})
                        }
                        if ((cursors.up.isDown || keyW.isDown) && tutorialSequence == 4) {
                            tutorialSequence = 5;
                            text('See that wall over\nthere?\nlets see if we can\njump over it.', 150, function(){tutorialSequence = 6;})
                        }
                        if (taco.x > 810 && tutorialSequence == 6) {
                            tutorialSequence = 7;
                            taco.disabled = true;
                            text('Great Job!\nNow try jumping \nover those spikes.', 150, function(){tutorialSequence = 8;taco.disabled = false;})
                        }
                        if (taco.x > 1370 && tutorialSequence == 8) {
                            tutorialSequence = 9;
                            text('If you look forward\nyou\'ll see a burrito.', 150, function(){tutorialSequence = 10;})
                        }
                        if (taco.x > 1770 && tutorialSequence == 10) {
                            tutorialSequence = 11;
                            taco.disabled = true;
                            text('We don\'t exactly\nlike burritos, so\nstay away.', 150, function(){setTimeout(function(){tutorialSequence = 12}, 1500)})
                        }
                        if (tutorialSequence == 12) {
                            tutorialSequence = 13;
                            text('However, there are\nways to get rid\nof them.', 150, function(){setTimeout(function(){tutorialSequence = 14}, 1500)})
                        }
                        if (tutorialSequence == 14) {
                            tutorialSequence = 15;
                            taco.disabled = false;
                            text('Go up to the\ntree and press space\nto trigger it.', 150, function(){tutorialSequence = 16;})
                        }
                        if (keySpace.isDown && tutorialSequence == 16) {
                            taco.disabled = true;
                            tutorialSequence = 17;
                            text('hmm... \nsatisfying...\nwell good luck!', 150, function(){setTimeout(function(){tutorialSequence = 18}, 1500)})
                            
                        }
                        if (tutorialSequence == 18) {
                            tutorialSequence = 19;
                            text('Press space to cont.', 150, function(){tutorialSequence = 20;})
                        }
                        if (keySpace.isDown && tutorialSequence == 20) {
                            tutorialSequence = 21;
                            text('', 10, function(){console.log('good luck')});
                            textBox.visible = false;
                            this.game.sound.stopAll();
                            tutorial = false;
                            nextLevel();
                            this.restartGame();
                        }
                    }
                    
                }
                //the map editing
                
                //typeEdit is defined at the beggining of the code :)
                if (keyB.isDown && creative == true) {
                    if (prompt('1.entity 2.block') == '1') {
                        typeEdit = 1;
                        select = prompt('type');
                        select = Number(select);
                    } else {
                        typeEdit = 2;
                        select = prompt('type');
                        select = Number(select);
                    }
                    
                }
                
;                if (this.input.manager.activePointer.isDown && typeEdit == 1 && hold == false && creative == true) {
                    newEntity(select, Math.round((mousePointer.x-16)/32)*32, Math.round((mousePointer.y-16)/32)*32, 0);

                }
                if (this.input.manager.activePointer.isDown) {
                    hold = true;
                    //this isn't in the above statement because it ends up alternating.
                } else {
                    hold = false;
                }
                if (keyE.isDown && typeEdit == 2) {
                    var tile = map.getTileAtWorldXY(mousePointer.x, mousePointer.y);
                    
                    if (tile !== null) {
                        map.removeTile(tile, -1, false);
                        map1[tile.y][tile.x] = -1;
                    }
                }
                
                if (keyE.isDown && typeEdit == 1) {
                    coins.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    burritos.children.iterate(function(child) {
                        
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    drillers.children.iterate(function(child) {
                        
                        
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    trees.children.iterate(function(child) {
                        
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[8+Math.round(child.body.y/32)][1+Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                            
                        }
                    });
                    mites.children.iterate(function(child) {
                        
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                            
                        }
                    });
                    burritoBarriers.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    rocks.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    bottles.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    lava.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    platforms.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    platformsLeft.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    platformsUp.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    platformsDown.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    limes.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                    flags.children.iterate(function(child) {
                        if (child && Math.round(child.body.x/32)*32 == Math.round((-16+mousePointer.x)/32)*32 && Math.round(child.body.y/32)*32 == Math.round((-16+mousePointer.y)/32)*32) {
                            entity1[Math.round(child.body.y/32)][Math.round(child.body.x/32)] = -1;
                            child.destroy();
                            
                        }
                    });
                }

                if (this.input.manager.activePointer.isDown && typeEdit == 2 && creative == true) {
                        map.putTileAt(select, tileSelectX, tileSelectY);
                        map1[tileSelectY][tileSelectX] = select;
                    //we need to make sure that block groups get updated when we change the map
                    spikes = map.filterTiles(function (tile) {
                        return (tile.index == 1);
                    });
                    flag = map.filterTiles(function (tile) {
                        return (tile.index == 9);
                    });
                }

                //before we move, run this
                bottles.children.iterate(function(child){
                    if (child.held) {
                        //child.x = taco.x;
                        //child.y = taco.y;
                        child.body.x = taco.body.x+taco._displayOriginX/2;
                        child.body.y = taco.body.y+8+taco._displayOriginY/2;
                        /*
                        if (taco.body.velocity.x > 0) {
                            child.angle = 90;
                        }
                        if (taco.body.velocity.x < 0) {
                            child.angle = -90;
                        }
                        */
                       child.angle += 3;
                        if (keySpace.isDown == false/*Phaser.Input.Keyboard.JustDown(keySpace)*/) {
                            iceBall = iceBalls.create(child.x, child.y, 'iceBall').setScale(0.8);
                            
                            iceBall.body.velocity.x = 500*Math.sin(child.angle * Math.PI/180);
                            iceBall.body.velocity.y = -500*Math.cos(child.angle * Math.PI/180);
                            iceBall.angle = child.angle-90;
                            child.held = false;
                            child.angle = 0;
                            child.body.velocity.x = 0;
                            child.body.velocity.y = -260;
                            child.body.allowGravity = true;
                            child.body.gravity.y = 500;
                            
                        }
                    }
                });
                if (taco.disabled) {
                    cursors.left.isDown = false;
                    cursors.right.isDown = false;
                    cursors.up.isDown = false;
                    cursors.down.isDown = false;
                    keyW.isDown = false;
                    keyA.isDown = false;
                    keyS.isDown = false;
                    keyD.isDown = false;
                }
                if (cursors.left.isDown || keyA.isDown)
                {
                    dirtEmitter.setPosition(taco.x, taco.y + 40);
                    tacoVelocityX -= 27;//47
                    if (creative == true) {
                        tacoVelocityX -= 90;
                    }
                    taco.anims.play('left', true);
                } else if (cursors.right.isDown || keyD.isDown)
                {
                    dirtEmitter.setPosition(taco.x, taco.y + 40);
                    tacoVelocityX += 27;
                    if (creative == true) {
                        tacoVelocityX += 90;
                    }
                    taco.anims.play('right', true);
                } else
                {
                    taco.anims.play('holdStill');
                }

                taco.body.velocity.x = tacoVelocityX;
                if (taco.cream) {
                    tacoVelocityX = tacoVelocityX * 0.95;//0.8
                } else {
                    tacoVelocityX = tacoVelocityX * 0.88;//0.8
                }
                taco.cream = false;
                

                if ((cursors.up.isDown || keyW.isDown) && taco.body.blocked.down)
                {
                    taco.body.velocity.y = -640;
                    
                }
                //walking sound effects
                if ((cursors.right.isDown || cursors.left.isDown || keyA.isDown || keyD.isDown) && taco.body.blocked.down) {
                    if (this.walkingSound.isPlaying == false) {
                        this.walkingSound.play();
                        
                        dirtEmitter.setQuantity(3);
                    }
                }
                if (!((cursors.right.isDown || cursors.left.isDown || keyA.isDown || keyD.isDown) && taco.body.blocked.down)) {
                    this.walkingSound.stop();
                    dirtEmitter.setQuantity(0);
                }

                //we need to be able to move up and down in creative too
                if (creative == true) {
                    if (cursors.up.isDown || keyW.isDown) {
                        taco.body.y -= 8;
                    }
                    if (cursors.down.isDown || keyS.isDown) {
                        taco.body.y += 8;
                    }
                }
                
                //make sure that we die when we fall into the void :)
                if (taco.body.y > 1000) {
                    death();
                }
                //here we do up to date collisions etc
                if (creative == false) {
                    this.physics.world.overlapTiles(taco, spikes, death, null, this);
                    this.physics.world.overlapTiles(taco, flag, function(){nextLevel();this.restartGame();}, null, this);
                }
                trees.children.iterate(function(child) {
                    if (child.triggered == true) {
                        child.angle += child.angleSpeed;
                        child.angleSpeed += 0.2;
                        if (child.angle > 60) {
                            child.triggered = false;
                            child.body.width -= 175;//counter for the first collider extension.
                        }
                    }
                });
                rocks.children.iterate(function(child) {
                    if (child.held == true) {
                        arrow.body.x = taco.body.x+(taco.body.width-arrow.body.width);
                        arrow.body.y = taco.body.y-arrow.body.height-18;
                        if (arrow.direction == 1) {
                            arrow.angle += 4;
                        } else {
                            arrow.angle -= 4;
                        }
                        if (arrow.angle > 70 || arrow.angle < -70) {
                            arrow.direction *= -1;
                        }
                        arrow.visible = true;
                        child.originX = 0.5;
                        child.originY = 0.5;
                        //child.body.gravity.y = 0;
                        child.body.velocity.x = 0;
                        child.body.velocity.y = 0;
                        child.body.x = taco.body.x+taco._displayOriginX;
                        child.body.y = taco.body.y-43+taco._displayOriginY/2;
                        //child.x = taco.x;
                        //child.y = taco.y;
                        
                        child.depth = 5;
                        if (keySpace.isDown == false) {
                            child.held = false;
                            child.body.velocity.x = 1000*Math.sin(arrow.angle * Math.PI/180);
                            child.body.velocity.y = -500*Math.cos(arrow.angle * Math.PI/180);
                            arrow.angle = 0;
                            arrow.visible = false;
                        }
                    }
                })
                //reset mites when below screen
                mites.children.iterate(function(child) {
                    if (child.body.y > 1000) {
                        /*
                        child.anims.stop();
                        child.anims.play('growingMite');
                        child.body.x = child.initX;
                        child.body.y = child.initY;
                        child.body.gravity.y = 0;
                        child.body.velocity.y = 0;*/
                        child.setOrigin(0.5, 0);
                        //child.refreshBody();
                        //child.body.allowGravity = true;
                        child.body.x = child.initX+16-(child.body.width/2);
                        child.body.y = child.initY;
                        child.body.velocity.y = 0;
                        child.body.gravity.y = 0;
                        child.anims.stop();
                        child.anims.play('growingMite');
                    }
                });
                platforms.children.iterate(function(child) {
                    if (creative == false) {
                        if (child.body.x > child.initX+child.distance) {
                            child.dir = -1;
                        }
                        if (child.body.x < child.initX) {
                            child.dir = 1;
                        }
                        child.body.velocity.x = child.dir*130;
                    }
                });
                platformsLeft.children.iterate(function(child) {
                    if (creative == false) {
                        if (child.body.x < child.initX-child.distance) {
                            child.dir = 1;
                        }
                        if (child.body.x > child.initX) {
                            child.dir = -1;
                        }
                        child.body.velocity.x = child.dir*130;
                    }
                });
                platformsDown.children.iterate(function(child) {
                    if (creative == false) {
                        if (child.body.y > child.initY+child.distance) {
                            child.dir = -1;
                        }
                        if (child.body.y < child.initY) {
                            child.dir = 1;
                        }
                        child.body.velocity.y = child.dir*130;
                    }
                });
                platformsUp.children.iterate(function(child) {
                    if (creative == false) {
                        if (child.body.y < child.initY-child.distance) {
                            child.dir = 1;
                        }
                        if (child.body.y > child.initY) {
                            child.dir = -1;
                        }
                        child.body.velocity.y = child.dir*130;
                    }
                });
                //sound effects for burritos and ice effect
                burritos.children.iterate(function(child) {
                    if (child.body.blocked.down && !child.frozen) {
                        child.body.velocity.y = -410;
                        if (camera.worldView.contains(child.body.x, child.body.y)) {
                            this.burritoJump.play();
                        }
                        
                    }
                    if (child.frozen) {
                        //child.body.velocity.x *= 0.99;
                        //child.body.velocity.x = 0;
                    }
                })
                //slow down the rocks
                rocks.children.iterate(function(child) {
                    child.body.velocity.x *= 0.97;
                    if (child.body.blocked.down == true) {
                        child.body.velocity.x = 0;
                    }
                });
                //we want to slow down and turn the limes
                limes.children.iterate(function(child) {
                    child.angle += 0.012 * child.body.velocity.x;
                    child.body.velocity.x *= 0.995;
                })
                
                //here we have the code for the drill boss
                
                drillers.children.iterate(function(child) {
                    
                    if (creative == false && child.active == true/* && camera.worldView.contains(child.body.x, child.body.y) && taco.x > 105*/) {
                        
                        if (child.started == false) {
                            child.started = true;
                        }
                        if (child.body.allowGravity == false) {
                            //child.body.x = child.initX;
                            //child.body.y = child.initY;
                            child.body.velocity.x = child.initXV;
                            child.body.velocity.y = child.initYV;
                            child.body.allowGravity = true;
                            child.que = -20;//give it time to get to the ground ya know
                        } else {
                            child.que += 1;
                        }
                        
                        if (child.que == 1) { 
                            child.body.velocity.y = -600;
                            child.body.velocity.x *= -1;
                            camera.shake(400, 0.005);

                        }
                        if (child.que == 75) {
                            child.body.velocity.y = -600;
                            child.body.velocity.x *= -1;
                            camera.shake(400, 0.005);
                            
                        }
                        if (child.que == 150) {
                            child.body.velocity.y = -300;
                            child.body.velocity.x *= -1;

                        }
                        if (child.que == 190) {
                            child.body.velocity.y = -300;
                            
                        }
                        if (child.que == 230) {
                            child.body.velocity.y = -300;
                            
                        }
                        if (child.que == 270) {
                            child.anims.stop();
                        }
                        if (child.que == 275) {
                            child.originY = 1;
                            child.pastXV = child.body.velocity.x;
                            child.pastGY = child.body.gravity.y;
                            child.body.gravity.y = 0;
                            child.body.velocity.x = 0;
                            child.body.y += (child.body.height/2);
                            child.anims.play('downAnimation');
                        }
                        if (child.que == 375 && child.lives < 5) {
                            child.anims.play('poppingAnimation');
                            child.invincible = true;
                        }
                        if (child.que == 400 && child.lives < 5) {
                            child.anims.play('shredingAnimation');
                            child.body.velocity.x = child.pastXV*1.5;
                            child.body.velocity.x *= -1;

                        }
                        if (child.que == 500 && child.lives < 5) {
                            child.body.velocity.x *= -1;
                        }
                        if (child.que == 600 && child.lives < 5) {
                            child.body.velocity.x = 0;
                            child.anims.play('unPoppingAnimation');
                        }
                        if (child.que == 685 && child.lives < 5) {
                            child.anims.play('upAnimation');
                            child.body.velocity.x = 0;
                            child.invincible = false;
                        }
                        if (child.que == 700 && child.lives < 5) {
                            child.originY = 0.5;
                            child.body.velocity.x = child.pastXV;
                            child.body.gravity.y = child.pastGY;
                            child.body.y -= (child.body.height/2);
                            child.anims.play('drillingAnimation');
                            child.que = 0;
                        }
                        if (child.que == 375 && child.lives > 4) {
                            child.anims.play('upAnimation');
                            child.body.velocity.x = 0;
                            child.invincible = false;
                        }
                        if (child.que == 390 && child.lives > 4) {
                            child.originY = 0.5;
                            child.body.velocity.x = child.pastXV;
                            child.body.gravity.y = child.pastGY;
                            child.body.y -= (child.body.height/2);
                            child.anims.play('drillingAnimation');
                            child.que = 0;
                        }
                        
                    }/* else {
                        child.body.x = child.initX;
                        child.body.y = child.initY;
                        child.body.velocity.x = child.initXV;
                        child.body.velocity.x = child.initXV;
                    }*/
                    
                });
                
                
                
            }  
            
            //the titlescreen functions 
            function startGame() {
                game.scene.stop('title');
                game.scene.start('game');
            }
            function restartGame() {
                //game.scene.restart('game');
                this.scene.restart();
            }
            var titleMusic;
            titleScene.preload = function () {
                this.load.image('tv', 'assets/tv.png');
                this.load.image('lines', 'assets/scanLines.png');
                this.load.image('background', 'assets/title.png');
                this.load.image('play', 'assets/playButton.png');
                this.load.image('cloud1', 'assets/cloud-c.png');
                this.load.image('cloud2', 'assets/cloud-b.png');
                this.load.image('button1', 'assets/Dirt.png');
                this.load.image('menu', 'assets/textBox.png');
                this.load.audio('titleMusic', ['assets/Good\ Gummy\ Bears.mp3']);
                for (var i = 0; i <= 5; i += 1) {
                    this.load.image('level' + String(i), 'assets/level' + String(i) + '.png');
                }
                
            }
            //vars?
            var menuOpen = false;
            var graphics = true;;
            var graphics2;
            titleScene.create = function () {
                graphics = this.add.graphics();

                graphics.fillStyle(0x2f2f2f, 1);
                graphics.fillRect(0, 0, 800, 600);
                graphics.depth = 4;

                tv = this.add.image(480, 300, 'tv');
                tv.depth = 6;
                tv.scale = 0.05;
                lines = this.add.image(400, 300, 'lines');
                lines.depth = 5;
                lines.scale = 0.6;
                lines.visible = false;
                lines.alpha = 0;
                this.physics.world.drawDebug = false;// we have to specify this because we alternate this later in the code
                titleMusic = this.sound.add('titleMusic');
                console.log(titleMusic);
                titleMusic.loop = true;
                //titleMusic.play();
                titleMusic.pause();
                //clouds
                clouds = this.physics.add.group();
                for (var i=0; i<15; i += 1) {
                    if (random(1, 2) == 1) {
                        cloudV = random(50, 100);
                    } else {
                        cloudV = -1*random(50, 100);
                    }
                    if (random(1, 2) == 1) {
                        cloudT = 'cloud1';
                    } else {
                        cloudT = 'cloud2';
                    }
                    
                    var cloud = clouds.create(random(10, 790), random(20, 590), cloudT).setScale(random(30, 45)/10).refreshBody();
                    cloud.body.velocity.x = cloudV;
                }
                //the non moving parts (except for button kindof)
                logo = this.add.image(400, 200, 'background').setScale(2.5);
                
                var playButton = this.add.image(400, 500, 'play').setScale(1.5);
                logo.depth = 1;
                playButton.depth = 1;
                playButton.setInteractive({ useHandCursor: true });
                playButton.on('pointerover', () => { playButton.setScale(2); });
                playButton.on('pointerout', () => { playButton.setScale(1.5); });
                playButton.on('pointerdown', () => {/*startGame(); titleMusic.stop()*/ menuOpen = true;});
                
                menu = this.physics.add.sprite(400, 300, 'menu').setScale(0.2).refreshBody();
                menu.depth = 2;
                menu.targetScale = 7;
                menu.visible = false;
                buttons = this.physics.add.group();
                // here we have some config type things for the button layout.
                buttons.opened = false;
                buttons.count = 6;
                buttons.spacing = 88;
            }
            var delay = 0;//non interval delay.
            titleScene.update = function () {
                //intro animation
                if (tv.scale < 1.2) {
                    tv.scale += 0.01;
                } else if (lines.alpha < 1 && tv.alpha > 0) {
                    lines.alpha += 0.02;
                    lines.visible = true;
                } else if (graphics) {
                    graphics2 = this.add.graphics();
                    this.graphics2 = graphics2;
                    graphics2.fillStyle(0xffffff, 1);
                    graphics2.fillRect(0, 0, 800, 600);
                    graphics2.depth = 4;
                    graphics.destroy();
                    graphics = false;

                } else if (delay < 250) {
                    delay += 1;
                    titleMusic.volume = 0;
                } else if (tv.alpha > 0 || this.graphics2.alpha > 0) {
                    tv.alpha -= 0.0035;
                    this.graphics2.alpha -= 0.01;
                    if (titleMusic.isPlaying == false) {
                        titleMusic.play();
                    }
                    titleMusic.resume();
                    if (titleMusic.volume < 1) {
                        titleMusic.volume += 0.006;
                    }
                } else if (lines.alpha > 0) {
                    lines.alpha -= 0.02;
                }
                if (random(1, 50) == 3) {
                    if (random(1, 2) == 1) {
                        cloudX = -150;
                        cloudV = random(50, 100);
                    } else {
                        cloudX = 1050;
                        cloudV = -1*random(50, 100);
                    }
                    if (random(1, 2) == 1) {
                        cloudT = 'cloud1';
                    } else {
                        cloudT = 'cloud2';
                    }
                    
                    var cloud = clouds.create(cloudX, random(20, 590), cloudT).setScale(random(30, 45)/10).refreshBody();
                    cloud.body.velocity.x = cloudV;
                }
                if (menuOpen) {
                    menu.visible = true;
                    if (menu.scaleX <= menu.targetScale) {
                        menu.scaleX += 0.2;
                        menu.scaleY += 0.2;
                    } else if (buttons.opened == false) {//once the opening is done.
                        buttons.opened = true;

                        for (var i = 0; i < buttons.count; i += 1) {
                            button = buttons.create(400 - (((buttons.count-1)*buttons.spacing)/2) + i * buttons.spacing, 300, 'level' + String(i));
                            
                            button.depth = 3;
                            button.body.x += button.width;
                            button.setOrigin(0.5, 0.5).refreshBody();
                            button.order = i;//determine which level it is later.
                            //button.setScale(1).refreshBody();
                            
                        }
                        //set the interactiveness afterwards
                        buttons.children.iterate(function(child){
                            console.log(child);
                            child.setInteractive({ useHandCursor: true });
                            child.on('pointerover', () => { child.setScale(1.25).refreshBody(); });
                            child.on('pointerout', () => { child.setScale(1).refreshBody(); });
                            child.on('pointerdown', () => {level = child.order;updateCurrentLevel();startGame();});
                            child.refreshBody();
                            child.setOrigin(0.5, 0.5);
                            child.setScale(1);
                        });
                        
                        
                    }
                }
            }

            //we add the games different scenes
            game.scene.add('title', titleScene);
            game.scene.add('game', gameScene);

            game.scene.start('title');
        </script>
        <h5>
            press m for creative mode. press b to select block. press e to delete block after it is selected<br>
            entities - 1<br>
            4:coin, 5:burrito, 6:burritoBoss, 7:treeTop, 8:stlagmite, 9:gumballForStlagmite, 10:burritoBarrier, 11:iceBottle, 12:lava, 13:rightPlatform, 14:lime <br>
            15:flag, 16:leftPlatform, 17:upPlatform, 18:downPlatform, 19: sourCreamForGrass.<br>
            blocks - 2<br>
            0:grass, 1:spikes, 2:dirt, 3:stone, 4:backgroundStone, 5:leftStump, 6:middleStump, 7:rightStump.<br>
            <br>
            press S to save. Copy both of the numbers and email them to owen4.greenhalgh@gmail.com to be loaded into the game.
            <br><br>
            WASD movement now available.<br>
            <br>
            Notes to level designers:<br>
            Keep in mind, if your mom or dad couldn't pass the level within ten minutes of trying, it is way too hard.<br>
            trees should be placed a block above the ground and block types 5, 6, and 7, should go underneath.<br>
            use plenty of burrito barriers as they can often by broken out of by burritos.<br>
            All entities are deleted from the top left corner, and aren't always perfectly accurate.

        </h5>
        
    </body>
    </html>
