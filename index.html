
<!--Copyright 2022 Owen Greenhalgh, and the rest of the bad burrito team. All Rights Reserved.-->
<!DOCTYPE html>
<html>
    <head>

    </head>
    <body>
        <script src="https://sdk.crazygames.com/crazygames-sdk-v2.js"></script>
        <script src="data.js"></script>
        <script>
            var fullScreen = false;
            var loaded = false;
            var lmap1, lentity1;
            var levelMaps = [null, null, levelMap2, mmap1, lmap1, bossMap1, mmap1, lmap1];
            var levelEntitys = [tutorialEntity1, levelEntity1, levelEntity2, eentity1, lentity1, bossEntity1, eentity1, lentity1];

            
            for (var i = 0; i < levelStrings.length; i += 1) {
                var code = levelStrings[i];//defined in data.js
                if (code != "") {
                    console.log('loading level from string');
                    lmap1 = code.split('*')[0];
                    lentity1 = code.split('*')[1];
                    lmap1 = lmap1.split('+');
                    for (var j = 0; j < lmap1.length; j += 1) {
                        lmap1[j] = lmap1[j].split(',');
                        
                        for (var e = 0; e < lmap1[j].length; e += 1) {
                            lmap1[j][e] = parseFloat(lmap1[j][e]);
                        }
                        lmap1[j].pop();
                    }
                    lmap1.shift();

                    lentity1 = lentity1.split('+');
                    for (var j = 0; j < lentity1.length; j += 1) {
                        lentity1[j] = lentity1[j].split(',');
                        
                        for (var e = 0; e < lentity1[j].length; e += 1) {
                            lentity1[j][e] = parseFloat(lentity1[j][e]);
                        }
                        lentity1[j].pop();
                    }
                    lentity1.shift();
                    levelMaps[i] = lmap1;
                    levelEntitys[i] = lentity1;
                }
            }

            var level = 3;
            var gameDelta;
            var hearts;
            var unlocked = 5;
            var tutorial;
            var inMenu = true;
            var finished = false;
            
            function updateCurrentLevel() {
                if (level == 0) {
                    tutorial = true;
                } else {
                    tutorial = false;
                }
                map1 = levelMaps[level];
                entity1 = levelEntitys[level];
            }
            updateCurrentLevel();
            
        </script>
        <canvas id="cnvs" width="800" height="600" style="display:block;"></canvas>
        <p id="outputMap"></p>
        <p id="outputEntity"></p>
        <script src="phaser.js"></script>
        <script>
            
            //game scenes
            var gameScene = new Phaser.Scene("game");
            gameScene.preload = preload;
            gameScene.create = create;
            gameScene.update = update;

            var UIScene = new Phaser.Scene("ui");
            UIScene.preload = UIpreload;
            UIScene.create = UIcreate;
            UIScene.update = UIupdate;

            var timeSkill;//used later.
            function UIpreload () 
            {
                //level UI
                this.load.image('tab1', 'assets/tab1.png');
                this.load.image('tab2', 'assets/tab2.png');
                this.load.image('tab3', 'assets/tab3.png');
                this.load.image('tab4', 'assets/tab4.png');
                this.load.image('tab5', 'assets/tab5.png');
                this.load.image('tab6', 'assets/tab6.png');
                //buttons
                this.load.image('unpause', 'assets/play1.png');
                this.load.image('pause', 'assets/play2.png');

                this.load.image('mouse', 'assets/mode1.png');
                this.load.image('erase', 'assets/mode2.png');
                //thumbnails
                this.load.spritesheet('thumbnails', 'assets/thumbnails2.png', {frameWidth:32, frameHeight:32});
                //skill check
                this.load.spritesheet('skill1', 'assets/skillCheck1.png', {frameWidth:36, frameHeight:36});
                //end
                this.load.image('levelEnd', 'assets/levelEnd.png');
                //in game UI
                this.load.image('UIplay', 'assets/UI1.png');
                this.load.image('UIpause', 'assets/UI2.png');
                this.load.image('UIsoundon', 'assets/soundon.png');
                this.load.image('UIsoundoff', 'assets/soundoff.png');
                this.load.image('UIrestart', 'assets/redo.png');
                this.load.image('UImenu', 'assets/toMenu.png');
                //sprinkles
                this.load.spritesheet('sprinkles', 'assets/sprinkles.png', { frameWidth: 30, frameHeight: 10 });
                //level complete
                this.load.audio('complete', ['assets/complete.mp3']);
                //level locks
                this.load.image('lock', 'assets/lock.png');
                //saving buttons
                this.load.image('import', 'assets/import.png');
                this.load.image('export', 'assets/export.png');
            }
            var gameLoaded = false;
            var check1 = -1;//tell UI what to display.
            var score;//access between scenes.
            var textBox;//access throughout the game.
            function UIcreate () 
            {
                //sound
                completeSound = this.sound.add('complete');
                //debug
                this.physics.world.drawDebug = false;
                this.physics.world.debugGraphic.clear();
                //mouse pointer
                UIZone = this.add.zone(0, 0).setSize(2, 2);
                this.physics.world.enable(UIZone);
                UIZone.hover = false;
                //word zone, used for ensuring they can always place blocks.
                worldZone = this.add.zone(0, 0).setSize(800, 600);
                this.physics.world.enable(worldZone);
                //we run this first so that the folder.hover overlap can override it if necesary.
                this.physics.add.overlap(UIZone, worldZone, hoverWorld, null, this);
                function hoverWorld(UIZone, worldZone) {
                    disableEdit = false;
                }
                //level UI
                folder = this.physics.add.sprite(400, 84, 'tab1').setScale(6).refreshBody();
                folder.scrollFactorX = 0;
                folder.scrollFactorY = 0;
                folder.tab = 0;
                folder.setOrigin(0.5, 0.5);
                folder.hover = this.physics.add.overlap(UIZone, folder, hoverFolder, null, this);
                function hoverFolder(UIZone, folder) {
                    if (folder.texture.key == 'tab6' && UIZone.hover == false) {
                        disableEdit = false;
                    } else {
                        disableEdit = true;
                    }
                }
                folder.setInteractive();
                folder.on('pointerout', () => {setTimeout(() => {disableEdit = false;}, 20)});
                folder.visible = false;
                //tabs
                tabs = [];
                for (var i = 0; i < 5; i += 1) {
                    tab = this.add.zone(folder.body.x+(i*72), folder.body.y).setSize(72, 60);
                    tab.setOrigin(0, 0);
                    tab.setScrollFactor(0, 0);
                    tab.order = i + 1;
                    this.physics.world.enable(tab);
                    tabs.push(tab);
                }
                
                tabs[0].setInteractive();
                tabs[0].on('pointerdown', function() {
                    clickTab(1);
                });
                tabs[1].setInteractive();
                tabs[1].on('pointerdown', function() {
                    clickTab(2);
                });
                tabs[2].setInteractive();
                tabs[2].on('pointerdown', function() {
                    clickTab(3);
                });
                tabs[2].depth = 1;
                tabs[3].setInteractive();
                tabs[3].on('pointerdown', function() {
                    clickTab(4);
                });
                tabs[4].setInteractive();
                tabs[4].on('pointerdown', function() {
                    clickTab(5);
                });
                function clickTab (tabClick) {
                    if (folder.texture.key !== 'tab6' && creative == true) {
                        folder.setTexture('tab' + String(tabClick));
                        folder.tab = tabClick - 1;
                        selectors.refresh();
                        selectors.refresh();
                        selectors.refresh();//just in case.
                    }
                }
                //close and open the folder
                handle = this.add.zone(folder.body.x+(folder.width*folder.scale)-72, folder.body.y+(folder.height*folder.scale)-60).setSize(72, 60);
                handle.setOrigin(0, 0);
                handle.setScrollFactor(0, 0);
                this.physics.world.enable(handle);
                handle.setInteractive({ useHandCursor: false });
                handle.on('pointerup', () => {
                    if (creative == true) {
                        openHandle.depth = 1; 
                        tabs[2].depth = 0;
                        folder.setTexture('tab6');
                        selectors.setVisible(false);
                    }
                });
                //opening again
                openHandle = this.add.zone(folder.x, folder.body.y).setSize(72, 60);
                openHandle.hover = false;
                openHandle.setOrigin(0.5, 0);
                openHandle.setScrollFactor(0, 0);
                this.physics.world.enable(openHandle);
                openHandle.setInteractive({ useHandCursor: false });
                openHandle.on('pointerup', () => {
                    if (creative == true) {
                        openHandle.depth = 0; 
                        tabs[2].depth = 1;
                        folder.setTexture('tab' + String(folder.tab + 1));
                        selectors.setVisible(true);
                    }
                });
                
                openHandle.on('pointerover', () => {UIZone.hover = true});
                openHandle.on('pointerout', () => {UIZone.hover = false});
                //selectors in the folder
                selectData = {
                    tabsType: [
                        [2, 2, 2, 2, 2, 1, 1, 1],
                        [1, 1, 1],
                        [1, 1, 1, 1, 1, 2, 1],
                        [1, 1, 1, 1, 1],
                        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
                    ],
                    tabsSelect: [
                        [0, 2, 3, 4, 11, 19, 4, 26],
                        [5, 25, 29],
                        [2, 3, 1, 0, 12, 21, 8],
                        [7, 11, 14, 8, 9],
                        [24, 30, 31, 23, 21, 15, 17, 18, 16, 13, 20, 27]
                    ],
                    tabsThumb: [
                        [49, 2, 3, 4, 11, 10, 18, 32],
                        [14, 22, 51],
                        [1, 12, 1, 1, 24, 58, 26],
                        [27, 57, 23, 26, 19],
                        [54, 53, 52, 21, 56, 55, 28, 29, 30, 31, 40, 50]
                    ]
                }
                selectors = this.physics.add.group();
                selectors.refresh = function() {
                    selectors.children.iterate(function(child) {
                        if (child) {
                            child.destroy();
                        }
                    });
                    selectors.children.iterate(function(child) {
                        if (child) {
                            child.destroy();
                        }
                    });

                    for (var i = 0; i<selectData.tabsThumb[folder.tab].length; i += 1) {
                        
                        if (i < 8) {
                            selector = selectors.create(36+folder.body.x+(40*i), folder.body.y+82, 'thumbnails');
                        } else {
                            selector = selectors.create(36+folder.body.x+(40*(i-8)), folder.body.y+82+40, 'thumbnails');
                        }

                        if (folder.tab == 0) {
                            switch (i) {
                                case 0:
                                    var grassFrame = 49;
                                    for (var e = 0; e < rotate; e += 1) {
                                        grassFrame += 1;
                                        if (grassFrame > 49) {
                                            grassFrame = 42;
                                        }
                                    }
                                    selector.setFrame(grassFrame);
                                    selectData.tabsSelect[folder.tab][i] = 13 + (rotate);
                                    break;
                                case 7:
                                    selector.setFrame(selectData.tabsThumb[folder.tab][i]+rotate);
                                    selectData.tabsSelect[folder.tab][i] = 26 + (rotate/10);
                                    break;
                                default:
                                    selector.setFrame(selectData.tabsThumb[folder.tab][i]);
                                    break;
                            }
                        } else {
                            selector.setFrame(selectData.tabsThumb[folder.tab][i]);
                        }
                        
                        
                        selector.i = i;
                        if (folder.tab == 2) {
                            switch(i) {
                                case 2:
                                    selector.angle += 90;
                                    break;
                                case 3:
                                    selector.angle -= 90;
                                    break;
                            }
                        }
                    }
                    selectors.children.iterate(function(child) {
                        child.setInteractive({ useHandCursor: true });
                        child.on('pointerover', () => {child.setScale(1.25).refreshBody(); });
                        child.on('pointerout', () => {child.setScale(1).refreshBody(); });
                        child.on('pointerdown', () => {currentSelector = child.i;typeEdit = selectData.tabsType[folder.tab][child.i];select = selectData.tabsSelect[folder.tab][child.i];});
                    });
                }
                selectors.refresh();
                selectors.setVisible(false);
                //mode buttons
                mode = this.physics.add.sprite(760, 40, 'unpause');
                //mode.visible = false;//no creative on default.
                mode.scale = 0.035;
                mode.setInteractive();
                mode.on('pointerup', () => {
                    if (mode.texture.key == 'unpause') {
                        mode.setTexture('pause');
                        tool.visible = true;
                        folder.visible = true;
                        Import.visible = true;
                        Export.visible = true;
                        if (folder.texture.key !== 'tab6') {
                            selectors.setVisible(true);
                        }
                        creative = true;
                        creativeUpdate = true;
                    } else {
                        mode.setTexture('unpause');
                        tool.visible = false;
                        folder.visible = false;
                        Import.visible = false;
                        Export.visible = false;
                        selectors.setVisible(false);
                        creative = false;
                        creativeUpdate = true;
                    }
                });
                
                mode.on('pointerover', () => {disableEdit = true});
                mode.on('pointerout', () => {disableEdit = false});

                tool = this.physics.add.sprite(690, 40, 'mouse');
                tool.scale = 0.035;
                tool.setInteractive();
                tool.on('pointerup', () => {
                    if (tool.texture.key == 'mouse') {
                        tool.setTexture('erase');
                        toolSelect = 'erase';
                    } else {
                        tool.setTexture('mouse');
                        toolSelect = 'mouse';
                    }
                });
                tool.visible = false;
                tool.on('pointerover', () => {disableEdit = true});
                tool.on('pointerout', () => {disableEdit = false});
                //export and import
                Import = this.physics.add.sprite(760, 110, 'import');
                Import.setInteractive();
                Import.scale = 3;
                Import.visible = false;
                Import.on('pointerup', () => {
                    var code = prompt("Level Code:");
                    if (code != "") {
                        console.log('preparing level from code');
                        lmap1 = code.split('*')[0];
                        lentity1 = code.split('*')[1];
                        lmap1 = lmap1.split('+');
                        for (var i = 0; i < lmap1.length; i += 1) {
                            lmap1[i] = lmap1[i].split(',');
                            
                            for (var e = 0; e < lmap1[i].length; e += 1) {
                                lmap1[i][e] = parseFloat(lmap1[i][e]);
                            }
                            lmap1[i].pop();
                        }
                        lmap1.shift();

                        lentity1 = lentity1.split('+');
                        for (var i = 0; i < lentity1.length; i += 1) {
                            lentity1[i] = lentity1[i].split(',');
                            
                            for (var e = 0; e < lentity1[i].length; e += 1) {
                                lentity1[i][e] = parseFloat(lentity1[i][e]);
                            }
                            lentity1[i].pop();
                        }
                        lentity1.shift();
                    }
                    //go out of creative mode.
                    mode.setTexture('unpause');
                    tool.visible = false;
                    folder.visible = false;
                    Import.visible = false;
                    Export.visible = false;
                    selectors.setVisible(false);
                    creative = false;
                    creativeUpdate = true;
                    levelMaps[7] = lmap1;
                    levelEntitys[7] = lentity1;
                    //reset the game with new level.
                    level = 7;updateCurrentLevel();
                    transportThisGame.scene.restart();

                });
                Import.on('pointerover', () => {disableEdit = true});
                Import.on('pointerout', () => {disableEdit = false});
                Export = this.physics.add.sprite(690, 110, 'export');
                Export.setInteractive();
                Export.scale = 3;
                Export.visible = false;
                Export.on('pointerup', () => {
                    var exMap = '';
                    for (var i=0; i<map1.length; i += 1) {
                        exMap = String(exMap) + '+' + String(map1[i]) + ', ';
                    }
                    var exEntity = '';
                    for (var i=0; i<entity1.length; i += 1) {
                        exEntity = String(exEntity) + '+' + String(entity1[i]) + ', ';
                    }
                    navigator.clipboard.writeText(exMap + '*' + exEntity);//copy to clipboard.
                    alert('Level Code Copied to Clipboard.');
                });
                Export.on('pointerover', () => {disableEdit = true});
                Export.on('pointerout', () => {disableEdit = false});
                //skill check
                timeSkill = this.physics.add.sprite(400, 200, 'skill1');
                timeSkill.scale = 2;
                timeSkill.visible = false;
                //score
                score = this.add.text(20, 60, 'Coins: 0', {fontSize: 20, color: '#ffffff' });
                score.visible = false;
                score.scrollFactorX = 0;
                score.scrollFactorY = 0;
                score.value = 0;
                score.add = function(value) {
                    score.value += value;
                    score.setText('Coins: ' + score.value);
                }
                score.depth = 5;

                menu = this.physics.add.sprite(400, 350, 'menu').setScale(0.2).refreshBody();
                menu.scrollFactorX = 0;
                menu.scrollFactorY = 0;
                menu.depth = 5;
                menu.targetScale = 3.5;
                menu.visible = false;

                menu.clickHere2 = this.physics.add.sprite(400, 300, 'clickHere2').setScale(0.35);
                menu.clickHere2.visible = false;
                menu.clickHere2.depth = 5;

                buttons = this.physics.add.group();
                buttons.scrollFactorX = 0;
                buttons.scrollFactorY = 0;

                locks = this.physics.add.group();
                // here we have some config type things for the button layout.
                buttons.opened = false;
                buttons.count = 6;
                buttons.spacing = 88;
                buttons.depth = 4;

                //also associated with minigame, is the level complete sign.
                levelEnd = this.physics.add.sprite(400, 300, 'levelEnd');
                levelEnd.alpha = 0;
                levelEnd.scrollFactorX = 0;
                levelEnd.scrollFactorY = 0;
                levelEnd.depth = 4;

                //guides
                clickHere = this.physics.add.sprite(400, 300, 'clickHere').setScale(0.35);
                clickHere.visible = false;
                clickHere.depth = 5;
                //General Ui
                sound = this.physics.add.sprite(700, 40, 'UIsoundon');
                sound.visible = false;
                sound.setInteractive();
                sound.on('pointerup', ()=>{
                    if (sound.texture.key == "UIsoundon") {
                        sound.setTexture('UIsoundoff');
                        transportThisGame.sound.setMute(true);
                    } else {
                        sound.setTexture('UIsoundon');
                        transportThisGame.sound.setMute(false);
                    }
                });
                pause = this.physics.add.sprite(760, 40, 'UIplay');
                pause.setInteractive();
                pause.on('pointerup', ()=>{
                    if (pause.texture.key == "UIplay") {
                        pause.setTexture('UIpause');
                        sound.visible = true;
                        restart.visible = true;
                        toMenu.visible = true;
                        transportThisGame.scene.pause();
                    } else {
                        pause.setTexture('UIplay');
                        sound.visible = false;
                        restart.visible = false;
                        toMenu.visible = false;
                        transportThisGame.scene.resume();
                    }
                });
                
                pause.visible = false;
                restart = this.physics.add.sprite(640, 40, 'UIrestart');
                restart.scale = 2;
                restart.visible = false;
                restart.setInteractive();
                restart.on('pointerup', ()=>{
                    clearInterval(makeText);
                    text('', 30, function(){});
                    transportThisUI.hideMenuButtons(false);
                    pause.setTexture('UIplay');
                    sound.setTexture('UIsoundon');
                    //go out of creative mode.
                    mode.setTexture('unpause');
                    tool.visible = false;
                    folder.visible = false;
                    Import.visible = false;
                    Export.visible = false;
                    selectors.setVisible(false);
                    creative = false;
                    creativeUpdate = true;
                    levelMaps[7] = lmap1;
                    levelEntitys[7] = lentity1;
                    transportThisGame.scene.restart();
                });
                toMenu = this.physics.add.sprite(580, 40, 'UImenu');
                toMenu.scale = 2;
                toMenu.visible = false;
                toMenu.setInteractive();
                toMenu.on('pointerup', ()=>{
                    transportThisUI.hideMenuButtons(false);
                    score.visible = false;
                    clearInterval(makeText);
                    text('', 30, function(){});
                    menuOpen = false;
                    clearInterval(transportThisUI.musicFade);
                    pause.setTexture('UIplay');
                    sound.setTexture('UIsoundon');
                    //go out of creative mode.
                    mode.setTexture('unpause');
                    mode.visible = false;
                    gameLoaded = false;//ensure that it actually gets hidden.
                    tool.visible = false;
                    folder.visible = false;
                    Import.visible = false;
                    Export.visible = false;
                    selectors.setVisible(false);
                    hearts.setVisible(false);
                    creative = false;
                    creativeUpdate = true;
                    levelMaps[7] = lmap1;
                    levelEntitys[7] = lentity1;
                    //restart.
                    restartMenu();
                });
                this.hideMenuButtons = function(visible) {
                    pause.visible = visible;
                    sound.visible = visible;
                    restart.visible = visible;
                    toMenu.visible = visible;
                }
                //sprinkles
                sprinkles = this.add.particles('sprinkles');
                sprinkles.depth = 6;
                this.sprinkles = sprinkles.createEmitter({
                    frame: [0, 1, 2],
                    x: 400,
                    y: 350,
                    frequency: 40,
                    quantity: 0,
                    angle: { min: -180, max: 180 },
                    speed: 400,
                    rotate: { min: -180, max: 180 },
                    gravityY: 250,
                    lifespan: { min: 1000, max: 2000 },
                });
                //text
                textBox = this.add.image(400, /*115*/170, 'text').setScale(5);
                textBox.scrollFactorX = 0;
                textBox.scrollFactorY = 0;
                textBox.depth = -1;
                textBox.visible = false;
                //define this here
                hearts = this.physics.add.group();
            }
            var menuOpen = false;
            
            function UIupdate () 
            {
                transportThisUI = this;
                UIPointer = this.input.activePointer.positionToCamera(this.cameras.main);
                if (UIPointer) {
                    UIZone.x = UIPointer.x;
                    UIZone.y = UIPointer.y;
                }
                if (UIPointer.y > folder.displayHeight) {
                    disableEdit = false;
                }

                if (gameLoaded == true) {
                    mode.visible = true;
                } else {
                    mode.visible = false;
                }

                if (check1 == -1) {
                    timeSkill.visible = false;
                } else {
                    timeSkill.visible = true;
                    timeSkill.setFrame(Math.round(check1));
                }

                keyM = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M);
                keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
                cursors = this.input.keyboard.createCursorKeys();
                if (Phaser.Input.Keyboard.JustDown(keyM) && (level > 5 || (keyS.isDown && cursors.down.isDown))) {
                    if (mode.texture.key == 'unpause') {
                        mode.setTexture('pause');
                        tool.visible = true;
                        folder.visible = true;
                        Import.visible = true;
                        Export.visible = true;
                        if (folder.texture.key !== 'tab6') {
                            selectors.setVisible(true);
                        }
                        creative = true;
                        creativeUpdate = true;
                    } else {
                        mode.setTexture('unpause');
                        tool.visible = false;
                        folder.visible = false;
                        Import.visible = false;
                        Export.visible = false;
                        selectors.setVisible(false);
                        creative = false;
                        creativeUpdate = true;
                    }
                }

                //rotate
                keyR = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.R);
                if (Phaser.Input.Keyboard.JustDown(keyR) && creative == true) {
                    rotate += 1;
                    if (rotate >= 8) {
                        rotate = 0;
                    }
                    selectors.refresh();
                    selectors.refresh();
                    selectors.refresh();
                    typeEdit = selectData.tabsType[folder.tab][currentSelector];
                    select = selectData.tabsSelect[folder.tab][currentSelector];
                }


                //menu
                if (menuOpen == true) {
                    menu.visible = true;
                    if (menu.scale == 0.2 && !(transportThisGame == null)) {
                        setTimeout(()=>{this.sprinkles.setQuantity(10);}, 1000);
                        setTimeout(()=>{this.sprinkles.setQuantity(0);}, 1250);
                        completeSound.play();
                    }
                    if (menu.scaleX <= menu.targetScale) {
                        menu.scaleX += 0.1;
                        menu.scaleY += 0.1;
                        buttons.opened = false;//reset this every time menu is opened.
                    } else if (buttons.opened == false) {//once the opening is done.
                        buttons.opened = true;
                        buttons.removeAll = function(){
                            while (buttons.children.entries.length > 0) {
                                buttons.children.iterate((child) =>{
                                    if (child) {
                                        child.destroy();
                                    }
                                });
                            }
                        }
                        buttons.removeAll();
                        for (var i = 0; i < buttons.count; i += 1) {
                            
                            button = buttons.create(400 - (((buttons.count-1)*buttons.spacing)/2) + i * buttons.spacing, 350, 'level' + String(i));
                            if (!(i <= unlocked)) {
                                lock = locks.create(button.x, button.y, 'lock');
                                lock.depth = 7;
                                lock.scale = 0.5;
                                lock.alpha = 0.35;
                                button.unlocked = false;
                            } else {
                                button.unlocked = true;
                            }
                            if (i == 0 && level == 0) {
                                clickHere.x = button.x;
                                clickHere.y = button.y - 50;
                                //clickHere.visible = true;
                            }
                            button.scrollFactorX = 0;
                            button.scrollFactorY = 0;
                            button.depth = 5;
                            button.body.x += button.width;
                            button.setOrigin(0.5, 0.5).refreshBody();
                            button.order = i;//determine which level it is later.
                            //button.setScale(1).refreshBody();
                            
                        }
                        menuOpen = false;
                        //set the interactiveness afterwards
                        var transportThis = this;
                        buttons.children.iterate(function(child){
                            if (child.unlocked == true) {
                                child.setInteractive({ useHandCursor: true });
                                child.on('pointerover', () => { child.setScale(1.25).refreshBody(); });
                                child.on('pointerout', () => { child.setScale(1).refreshBody(); });
                                child.on('pointerup', () => {
                                    child.removeInteractive();
                                    
                                    //play an ad before the next level, but only if out of titlescreen..
                                    function cont() {
                                        transportThisUI.cameras.main.fadeOut(2000).once('camerafadeoutcomplete', ()=>{
                                        level = child.order;
                                        menuOpen = false;
                                        updateCurrentLevel();
                                        if (!(transportThisGame == null)) {
                                            menu.scale = 0.2;
                                            menu.visible = false;
                                            setTimeout(()=>{menu.visible = false;}, 40);//double check.
                                            buttons.setVisible(false);
                                            locks.setVisible(false);
                                            levelEnd.visible = false;
                                            transportThisGame.scene.restart();
                                        } else {
                                            menu.visible = false;
                                            setTimeout(()=>{menu.visible = false;}, 40);//double check.
                                            menu.scale = 0.2;
                                            buttons.setVisible(false);
                                            locks.setVisible(false);
                                            startGame();
                                        }
                                        });
                                        transportThisUI.musicFade = setInterval(()=>{
                                            titleMusic.volume -= 0.008;
                                            if (titleMusic.volume <= 0) {
                                                titleMusic.volume = 0;
                                                clearInterval(transportThisUI.musicFade);
                                            }
                                        }, 16);
                                    }
                                    if (inMenu == false) {
                                        midGame(cont);
                                    } else {
                                        cont();
                                    }
                                    
                                });
                                child.refreshBody();
                                child.setOrigin(0.5, 0.5);
                                child.setScale(1);
                            }
                            
                        });
                        
                        
                    } else {
                        buttons.setVisible(true);
                        locks.setVisible(true);
                        menuOpen = false;
                    }
                }
                
            }

            var titleScene = new Phaser.Scene("title");
            //functions are specified further down.
            var width, height;
            /*if (fullScreen) {
                width = window.innerWidth;
                height = window.innerHeight;
                document.getElementById('cnvs').requestFullscreen();
            } else*/ if (true) {
                width = 800;
                height = 600;
            }
            var config = {
                type: Phaser.WEBGL,
                /*
                scale: {
                    //mode: Phaser.Scale.FIT,
                    //autoCenter: Phaser.Scale.CENTER_BOTH,
                    width: 800,
                    height: 600
                },*/
                width: width,
                height: height,//for the odd grid size
                backgroundColor: '#000000',//#ADD8E6
                pixelArt: true,
                canvas: document.getElementById('cnvs'),
                physics: {
                    default: 'arcade',
                    tileBias: 32,
                    arcade: {
                        gravity: { y: 0 },//to let us set this individualy
                        debug: true,
                    }
                },
                map: {
                    add: 'makeStuff',
                    load: 'loader'
                },
                timeScale: 1,
                fps: {
                    target: 60/*,
                    forceSetTimeOut: true*/
                }
            };

            var game = new Phaser.Game(config);
            
            function preload ()
            {
                transportThisUI.cameras.main.fadeIn(1);
                if (true) {
                    percentage = this.add.text(400, 300, '0%', { fontSize: '32px', fill: 'white' }).setOrigin(0.5);
                    this.load.on('progress', function(value) {
                        if (Math.round(value*100)<100) {
                            if (percentage.setText) {
                                percentage.setText(Math.round(value*100) + '%');
                            }
                            
                        } else {
                            percentage.setText('Finishing...');
                            loaded = true;
                        }
                        
                        
                    });
                    this.load.on('complete', function () {
                        percentage.destroy();
                        loaded = true;
                    });
                }
                loaded = true;
                
                //font
                var element = document.createElement('style');

                document.head.appendChild(element);

                var sheet = element.sheet;

                var styles = '@font-face { font-family: "mono"; src: url("assets/VCR_OSD_MONO_1.001.ttf") format("opentype"); }\n';

                sheet.insertRule(styles, 0);

                this.load.script('webfont', 'https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js');
                //music files
                this.load.audio('mainMusic', ['assets/UpTown.mp3']);
                this.load.audio('caveMusic', ['assets/Cave in.mp3']);
                this.load.audio('mainMusic2', ['assets/rainingFun.mp3']);
                this.load.audio('burritoJump', ['assets/burritojump.wav']);
                this.load.audio('walking', ['assets/walking.mp3']);
                this.load.audio('boss1', ['assets/boss0.mp3']);
                this.load.audio('boss2', ['assets/boss1.mp3']);
                this.load.audio('boss3', ['assets/boss2.mp3']);
                this.load.audio('boss4', ['assets/boss3.mp3']);
                this.load.audio('boss5', ['assets/boss4.mp3']);
                this.load.audio('boss6', ['assets/boss5.mp3']);
                this.load.audio('overMusic', ['assets/gameOver.mp3']);
                //text box
                this.load.image('text', 'assets/textBox.png');
                //clouds/background
                this.load.image('cloud1', 'assets/cloud-c.png');
                this.load.image('cloud2', 'assets/cloud-b.png');
                //tutorial
                this.load.image('potat1', 'assets/potato1.png');
                this.load.image('potat2', 'assets/potato2.png');
                //drill boss images below
                this.load.image('rock', 'assets/rock.png');
                this.load.image('drop1', 'assets/gumdrop1.png');
                this.load.image('drop2', 'assets/gumdrop2.png');
                this.load.image('drop3', 'assets/gumdrop3.png');
                this.load.image('drop4', 'assets/gumdrop4.png');
                this.load.image('drop5', 'assets/gumdrop5.png');
                this.load.image('drop6', 'assets/gumdrop6.png');

                this.load.image('aimArrow', 'assets/aimArrow.png');

                this.load.image('drill1', 'assets/boss1__1.png');
                this.load.image('drill2', 'assets/boss1__2.png');
                this.load.image('drill3', 'assets/boss1__3.png');
                this.load.image('drill4', 'assets/boss1__4.png');
                this.load.image('drill5', 'assets/boss1__5.png');
                this.load.image('drill6', 'assets/boss1__6.png');
                this.load.image('drill7', 'assets/boss1__7.png');
                this.load.image('drill8', 'assets/boss1__8.png');
                this.load.image('drill9', 'assets/boss1__9.png');

                this.load.image('down1', 'assets/down1.png');
                this.load.image('down2', 'assets/down2.png');
                this.load.image('down3', 'assets/down3.png');
                this.load.image('down4', 'assets/down4.png');
                this.load.image('down5', 'assets/down5.png');
                this.load.image('down6', 'assets/down6.png');
                this.load.image('down7', 'assets/down7.png');
                this.load.image('down8', 'assets/down8.png');
                this.load.image('down9', 'assets/down9.png');
                this.load.image('down10', 'assets/down10.png');
                this.load.image('down11', 'assets/down11.png');
                this.load.image('down12', 'assets/down12.png');
                this.load.image('down13', 'assets/down13.png');
                this.load.image('down14', 'assets/down14.png');

                this.load.image('up1', 'assets/up1.png');
                this.load.image('up2', 'assets/up2.png');
                this.load.image('up3', 'assets/up3.png');
                this.load.image('up4', 'assets/up4.png');
                this.load.image('up5', 'assets/up5.png');

                this.load.image('shred1', 'assets/shred1.png');
                this.load.image('shred2', 'assets/shred2.png');
                this.load.image('shred3', 'assets/shred3.png');
                this.load.image('shred4', 'assets/shred4.png');
                this.load.image('shred5', 'assets/shred5.png');
                this.load.image('shred6', 'assets/shred6.png');
                //burrito images below
                
                this.load.image('burrito1', 'assets/burrito__1.png');
                this.load.image('burrito2', 'assets/burrito__2.png');
                this.load.image('burrito3', 'assets/burrito__3.png');
                this.load.image('burrito4', 'assets/burrito__4.png');
                this.load.image('burrito5', 'assets/burrito__5.png');
                this.load.image('burrito6', 'assets/burrito__6.png');
                this.load.image('burrito7', 'assets/burrito__7.png');
                this.load.image('burrito8', 'assets/burrito__8.png');

                //shooters
                this.load.image('shooter1', 'assets/Shooter1.png');
                this.load.image('shooter2', 'assets/Shooter2.png');
                this.load.image('shooter3', 'assets/Shooter3.png');

                this.load.image('poison1', 'assets/poison1.png');
                this.load.image('poison2', 'assets/poison2.png');

                this.load.spritesheet('burritoParticles', 'assets/burritoParticles.svg', { frameWidth: 9, frameHeight: 9 });

                this.load.image('barrier', 'assets/barrier.png');

                this.load.image('key', 'assets/key.png');
                this.load.image('door1', 'assets/lock1.png');
                this.load.image('door2', 'assets/lock2.png');
                this.load.image('door3', 'assets/lock3.png');

                //burrito specific killers
                this.load.image('iceBottle', 'assets/Ice sauce.png');
                this.load.image('ice1', 'assets/ice1.png');
                this.load.image('ice2', 'assets/ice2.png');
                this.load.image('ice3', 'assets/ice3.png');
                
                this.load.image('iceBall', 'assets/Iceball.png');
                this.load.image('lime', 'assets/lime.png');
                //terrain images
                this.load.image('grass', 'assets/Dirt.png');
                this.load.image('dirt', 'assets/underground.png');
                this.load.image('tree1', 'assets/tree 1.png');
                this.load.image('streetlight', 'assets/Streetlight.png');

                this.load.image('landscape', 'assets/newLand.png');
                this.load.image('platform', 'assets/platform.png');
                this.load.image('platform1', 'assets/platform1.png');
                this.load.image('platform2', 'assets/platform2.png');

                this.load.image('spike', 'assets/spike_ground.png');

                this.load.image('flag1', 'assets/flag1.png');
                this.load.image('flag2', 'assets/flag2.png');
                this.load.image('flag3', 'assets/flag3.png');
                this.load.image('flag4', 'assets/flag4.png');
                this.load.image('flag5', 'assets/flag5.png');

                //along with flags goes the checkpoint ones
                this.load.image('point1', 'assets/point1.png');
                this.load.image('point2', 'assets/point2.png');
                this.load.image('point3', 'assets/point3.png');
                this.load.image('point4', 'assets/point4.png');
                this.load.image('point5', 'assets/point5.png');

                this.load.image('cream', 'assets/Cream.png');

                this.load.image('meatball', 'assets/meatball.png');
                //this.load.image

                //sky images
                this.load.image('sky1', 'assets/sky.png');
                //lava images
                this.load.image('lava1', 'assets/lavaTiles__1.png');
                this.load.image('lava2', 'assets/lavaTiles__2.png');
                this.load.image('lava3', 'assets/lavaTiles__3.png');
                this.load.image('lava4', 'assets/lavaTiles__4.png');
                this.load.image('lava5', 'assets/lavaTiles__5.png');
                this.load.image('lava6', 'assets/lavaTiles__6.png');
                this.load.image('lava7', 'assets/lavaTiles__7.png');
                this.load.image('lava8', 'assets/lavaTiles__8.png');

                //player images
                this.load.image('left1', 'assets/L1.png');
                this.load.image('left2', 'assets/L2.png');
                this.load.image('right1', 'assets/R1.png');
                this.load.image('right2', 'assets/R2.png');
                this.load.image('still', 'assets/Stanstill.png');
                //gumgrass
                names = ['up', 'upright', 'right', 'downright', 'down', 'downleft', 'left', 'upleft']
                for (var i = 0; i < 8; i += 1) {
                    this.load.image(names[i], 'assets/gum' + names[i] + '.png');
                }
                //game over
                this.load.image('gameOver', 'assets/gameOver.png');
                //lives
                this.load.image('heart1', 'assets/N heart1.png');
                this.load.image('heart2', 'assets/N heart2.png');
                this.load.image('heart3', 'assets/N heart3.png');
                this.load.image('heart4', 'assets/N heart4.png');
                this.load.image('heart5', 'assets/N heart5.png');
                this.load.image('heart6', 'assets/N heart6.png');
                this.load.image('heart7', 'assets/N heart7.png');
                this.load.image('heart8', 'assets/N heart8.png');

                //coin images
                this.load.image('coin1', 'assets/coin__1.png');
                this.load.image('coin2', 'assets/coin__2.png');
                this.load.image('coin3', 'assets/coin__3.png');
                this.load.image('coin4', 'assets/coin__4.png');

                //images for stlagmites (spelling is irrelevent haha).
                this.load.image('mite1', 'assets/stlagmite1.png');
                this.load.image('mite2', 'assets/stlagmite2.png');
                this.load.image('mite3', 'assets/stlagmite3.png');
                this.load.image('mite4', 'assets/stlagmite4.png');
                this.load.image('mite5', 'assets/stlagmite5.png');
                //boulders
                this.load.image('boulder1', 'assets/bouldersmall.png');
                this.load.image('boulder2', 'assets/boulderlarge.png');
                //minigame
                this.load.image('spaceBox', 'assets/spaceInvadersBox.png');
                //selector
                this.load.image('selector', 'assets/selector.png');
                //background stone
                this.load.image('3by3', 'assets/3by3stone.png');
                //flying burritos
                for (var i = 0; i < 8; i += 1) {
                    this.load.image('flying' + String(i+1), 'assets/flying' + String(i+1) + '.png');
                }

            }
            //global game functions and variables.
            function random (one, two) {
                return(Math.round(Math.random()*(two-one))+one);
            }
            function midGame(cont) {
                const callbacks = {
                    adFinished: () => {
                        console.log("End midgame ad (callback)");
                        transportThisGame.scene.resume();
                        transportThisGame.sound.setMute(false);
                        //continue with the game.
                        if (cont) {
                            cont();
                        }
                        
                    },
                    adError: (error) => {
                        console.log("Error midgame ad (callback)", error);
                        transportThisGame.scene.resume();
                        transportThisGame.sound.setMute(false);
                    },
                    adStarted: () => {
                        console.log("Start midgame ad (callback)");
                    },
                };
                transportThisGame.scene.pause();
                transportThisGame.sound.setMute(true);
                window.CrazyGames.SDK.ad.requestAd("midgame", callbacks);
            }
            function rewarded(cont) {
                const callbacks = {
                    adFinished: () => {
                        console.log("End rewarded ad (callback)");
                        transportThisTitle.scene.resume();
                        transportThisTitle.sound.setMute(false);
                        //continue with the game.
                        if (cont) {
                            cont();
                        }
                        
                    },
                    adError: (error) => {
                        console.log("Error rewarded ad (callback)", error);
                        transportThisTitle.scene.resume();
                        transportThisTitle.sound.setMute(false);
                    },
                    adStarted: () => {
                        console.log("Start rewarded ad (callback)");
                    },
                };
                transportThisTitle.scene.pause();
                transportThisTitle.sound.setMute(true);
                window.CrazyGames.SDK.ad.requestAd("rewarded", callbacks);
            }
            //deaths
            var dead = false;
            var transportThisGame;
            var transportThisTitle;
            var transportThisUI;
            function death(inevitable) {
                transportThisGame.physics.world.timeScale = 1;
                arrow.visible = false;
                trees.children.iterate(function(child) {
                    child.angle = 0;
                    child.angleSpeed = 0;
                    child.triggered = "none";
                    child.falling = false;
                    check1 = -1;
                    child.body.offset.x = 0;
                });
                timeSkill.alpha = 1;
                burritos.children.iterate(function(child) {
                    child.triggered = false;
                });
                bottles.children.iterate(function(child) {
                    child.enableBody(true, child.initX+16, child.initY+16, true, true);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.held = false;
                    child.angle = 0;
                    child.uses = 3;
                    child.setTexture("ice1");
                    child.visible = true;
                });
                

                if ((taco.skipDeath == false || inevitable == true) && taco.disabled == false) {
                    /*if (inevitable === true) {
                        taco.lives = 0;
                        taco.immortale = false;
                    }*/
                    meatballs.children.iterate(function(child) {
                        child.body.x = child.initX;
                        child.body.y = child.initY;
                        child.angle = random(0, 1)*180;
                    });
                    if (taco.lives > 0) {
                        taco.skipDeath = true;//after the check.
                        taco.alpha = 0.5;
                        taco.disabled = true;
                        taco.body.velocity.x = 0;
                        taco.body.velocity.y = 0;
                        setTimeout(function() {taco.disabled = false;}, 800);
                        setTimeout(function() {taco.skipDeath = false; taco.alpha = 1;}, 3000);
                    }
                    taco.lives -= 1;
                    setLives(taco.lives);
                    
                    
                    
                    if (taco.lives < 0) {
                        taco.lives = 0;
                    }
                    burritos.children.iterate(function(child) {
                        child.dying = false;
                    });
                    
                    taco.body.x = taco.startX;//for tutorial
                    taco.body.y = taco.startY;
                    taco.body.velocity.x = 0;
                    taco.body.velocity.y = 0;
                    //returnSprites();
                    //resumeSprites();
                    /*drillers.children.iterate(function(child) {
                        child.started = false;
                    });*/
                    
                    if (taco.lives == 0 && score.visible == true) {
                        rocks.setVisible(false);
                        score.visible = false;
                        hearts.setVisible(false);
                        mode.visible = false;
                        pause.visible = false;

                        taco.disabled = true;

                        finished = false;
                        gameOver = transportThisGame.add.image(400, 300, 'gameOver').setScale(0.77);
                        gameOver.scrollFactorX = 0;
                        gameOver.scrollFactorY = 0;
                        gameOver.alpha = 0;
                        gameOver.depth = 3;
                        gameOver.fadeout = setInterval(()=>{
                            gameOver.alpha += 0.005*(gameDelta/16.666);
                            transportThisGame.sound.volume -= 0.005*(gameDelta/16.666);
                            transportThisGame.sound.detune -= 5*(gameDelta/16.666);
                            if (gameOver.alpha >= 1)
                            {
                                mainMusic.volume = 0;
                                mainMusic2.volume = 0;
                                caveMusic.volume = 0;
                                for (var i = 0; i < bossMusic.length; i += 1) {
                                    bossMusic[i].volume = 0;
                                }
                                transportThisGame.sound.volume = 1;
                                transportThisGame.sound.detune = 1;
                                gameOver.setAlpha(1);
                                gameOverMusic.play();
                                gameOverMusic.once('complete', ()=>{
                                    transportThisUI.cameras.main.fadeOut(900);//ensure it completes first.
                                    setTimeout(()=>{
                                        
                                        midGame(()=>{
                                            transportThisGame.scene.restart();
                                        });
                                    }, 1000);
                                });
                                clearInterval(gameOver.fadeout);
                                transportThisGame.scene.pause();
                            }
                        }, 16);
                        
                        
                    }
                }
            }
            //creating entities
            function newEntity(type, x, y, offsetX, offsetY) {
                if (type == 2 || type == 3 || type == 1 || type == 0) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = type;
                    var coin = spikes.create(x+16, y+16, 'spike');
                    if (type == 3) {
                        coin.angle = 180;
                    } else if (type == 1) {
                        coin.angle = 90;
                    } else if (type == 0) {
                        coin.angle = -90;
                    }
                    coin.body.gravity.y = 0;
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                    if (type >= 2) {
                        coin.body.width *= 0.25;
                        coin.body.offset.x += 12;
                    } else {
                        coin.body.height *= 0.25;
                        coin.body.offset.y += 12;
                    }
                    
                } 
                if (type == 4) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 4;
                    var coin = coins.create(x+16, y+16, 'coin1');//.setScale(2);//.refreshBody();// this causes a bug i think?
                    coin.anims.play('coin');
                    coin.setOrigin(0.5, 0.5);
                    coin.setScale(2);
                    coin.body.gravity.y = 0;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 5) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 5;
                    var burrito = burritos.create(x+16, y+32, 'burrito1').setGravity(0, 1500);//32 because it is two "blocks" tall.
                    burrito.anims.play('burritoAnimation');
                    burrito.setScale(2);
                    //burrito.body.bounce.y = 1; we don't want it to stop when it is in tight spaces.
                    burrito.body.bounce.x = 1;
                    burrito.body.velocity.x = 0;//normally 200 but doesn't need to move yet.
                    burrito.body.allowGravity = false;
                    //look above :)
                    burrito.initX = x;
                    burrito.initY = y;
                    burrito.initXV = 200;
                    burrito.initYV = 0;
                    burrito.fly = false;
                    //tree killing
                    burrito.triggered = false;
                    burrito.frozen = false;
                    
                }
                if (type == 6) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 6;
                    var driller = drillers.create(x+8, y+32+16, 'drill1').setGravity(0, 1000);//32 because it is two "blocks" tall.
                    driller.anims.play('drillingAnimation');
                    driller.setScale(3)//.refreshBody(); apparently this causes bugs???
                    //driller.body.bounce.y = 1;
                    //driller.body.bounce.x = 1;
                    driller.body.allowGravity = false;
                    //look above :)
                    driller.initX = x;
                    driller.initY = y;
                    driller.initXV = 200;
                    driller.initYV = 0;
                    driller.started = false;
                    driller.que = 0;
                    driller.phase = 0;
                    driller.lives = 8;
                    driller.immune = false;
                    //music que
                    driller.currentSong = 0;
                    driller.goUpTo = 1;
                    driller.invincible = false;
                    
                }
                if (type == 7) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 7;
                    var tree = trees.create(x+74-63, y+76-64, 'tree1');
                    tree.setScale(0.75)//.refreshBody(); apparently this causes bugs???
                    
                    map.putTileAt(5, map.worldToTileX(x-32), map.worldToTileY(y));
                    map.putTileAt(6, map.worldToTileX(x), map.worldToTileY(y));
                    map.putTileAt(7, map.worldToTileX(x+32), map.worldToTileY(y));
                    tree.body.allowGravity = false;
                    //look above :)
                    tree.initX = x;
                    tree.initY = y;
                    tree.initXV = 0;
                    tree.initYV = 0;
                    tree.triggered = "none";
                    tree.falling = false;
                    tree.angleSpeed = 0;
                    tree.setOrigin(0.5, 1);
                    tree.depth = -1;
                }
                if (type == 8) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 8;//because this isn't going to be perfectly centered, we don't add anything to the y
                    var mite = mites.create(x+16, y+0, 'mite1');
                    mite.setScale(3)//.refreshBody(); apparently this causes bugs???
                    mite.anims.play('growingMite');
                    mite.setOrigin(0.5, 0);
                    //mite.body.allowGravity = false;
                    //look above :)
                    mite.initX = x;
                    mite.initY = y;
                    mite.initXV = 0;
                    mite.initYV = 0;
                }
                if (type == 9) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 9;
                    image = 'drop' + String(random(1, 6));
                    var rock = rocks.create(x+16, y+16, image).setGravity(0, 500);//throwing should be a bit more moonlike.
                    rock.setScale(2);
                    rock.body.bounce.x = 0.3;
                    rock.body.bounce.y = 0.3;
                    rock.body.allowGravity = false;
                    rock.initX = x;
                    rock.initY = y;
                    rock.initXV = 0;
                    rock.initYV = 0;
                    rock.held = false;
                    rock.depth = 0;

                }
                if (type == 10) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 10;
                    var coin = burritoBarriers.create(x+16, y+16, 'barrier').setScale(1.1).refreshBody(); //this causes a bug i think?
                    coin.originX = 0.5;
                    coin.originY = 0.5;
                    coin.body.gravity.y = 0;
                    //too lazy to rename the coin.
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                }
                if (type == 11) {
                    //bottles, but variables are called coins from the first one. Same with type 10.
                    entity1[Math.round(y/32)][Math.round(x/32)] = 11;
                    var coin = bottles.create(x+16, y+16, 'ice1');//.setScale(2);//.refreshBody(); this causes a bug i think?
                    coin.setScale(0.2);
                    coin.setOrigin(0.5, 0.5);
                    
                    coin.body.gravity.y = 500;
                    coin.body.bounce.y = 0.3;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                    coin.depth = 4;
                    coin.body.allowGravity = false;
                    coin.uses = 3;
                } 
                if (type == 12) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 12;
                    var coin = lava.create(x+32, y+14, 'lava1').setScale(2)//.refreshBody(); this causes a bug i think?
                    coin.setOrigin(0.5, 0.5);
                    coin.anims.play('lava');
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 13) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 13;
                    var coin;
                    if (offsetX == 0) {
                        coin = platforms.create(x+64, y+32, 'platform');
                    } else {
                        coin = platforms.create(x+offsetX, y+offsetY, 'platform');
                    }
                    
                    coin.body.gravity.y = 0;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 130;
                    coin.initYV = 0;
                    coin.distance = 300;//how far it goes.
                    coin.setFrictionX(1);
                    coin.dir = 1;
                    coin.body.setImmovable = true;
                    coin.anims.play('platformAnimation');
                    //coin.setOrigin(0.5, 0.5);
                    coin.depth = 1;
                } 
                if (type == 14) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 14;
                    var coin = limes.create(x+48, y+48, 'lime');
                    coin.setScale(3);
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.body.gravity.y = 500;
                    coin.body.bounce.x = 1;
                    coin.body.bounce.y = 0.3;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                    coin.body.allowGravity = false;
                    coin.body.mass = 1;
                    coin.setOrigin(0.5, 0.5);
                } 
                if (type == 15) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 15;
                    var coin = flags.create(x-20, y+32, 'flag1').setScale(0.2)//.refreshBody(); this causes a bug i think?
                    coin.anims.play('flagSleepingAnimation');
                    coin.setOrigin(0, 1);
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 16) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 16;
                    var coin;
                    if (offsetX == 0) {
                        coin = platformsLeft.create(x+64, y+32, 'platform');
                    } else {
                        coin = platformsLeft.create(x+offsetX, y+offsetY, 'platform');
                    }//coin.setOrigin(0.5, 0.5);
                    coin.anims.play('platformAnimation');
                    coin.body.gravity.y = 0;
                    coin.body.setAllowGravity(false);
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = -130;
                    coin.initYV = 0;
                    coin.distance = 300;//how far it goes.
                    coin.setFrictionX(1);
                    coin.dir = 1;
                    coin.body.setImmovable = true;
                    coin.depth = 1;
                } 
                if (type == 17) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 17;
                    var coin;
                    if (offsetX == 0) {
                        coin = platformsUp.create(x+64, y+32, 'platform');
                    } else {
                        coin = platformsUp.create(x+offsetX, y+offsetY, 'platform');
                    }//coin.setOrigin(0.5, 0.5);
                    coin.anims.play('platformAnimation');
                    coin.body.gravity.y = 0;
                    coin.body.setAllowGravity(false);
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = -130;
                    coin.distance = 300;//how far it goes.
                    coin.dir = -1;
                    coin.body.setImmovable = true;
                    coin.depth = 1;
                } 
                if (type == 18) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 18;
                    var coin;
                    if (offsetX == 0) {
                        coin = platformsDown.create(x+64, y+32, 'platform');
                    } else {
                        coin = platformsDown.create(x+offsetX, y+offsetY, 'platform');
                    }//coin.setOrigin(0.5, 0.5);
                    coin.anims.play('platformAnimation');
                    coin.body.gravity.y = 0;
                    coin.body.setAllowGravity(false);
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 130;
                    coin.distance = 300;//how far it goes.
                    coin.setFrictionX(1);
                    coin.dir = 1;
                    coin.body.setImmovable = true;
                    coin.depth = 1;
                } 
                if (type == 19) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 19;
                    var coin = creams.create(x+16, y+16, 'cream');//.setScale(2);//.refreshBody();// this causes a bug i think?
                    map.putTileAt(0, map.worldToTileX(x), map.worldToTileY(y));
                    coin.setScale(0.4999999, 0.5000001);
                    coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 20) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 20;
                    var coin = meatballs.create(x+32, y+32, 'meatball');//.setScale(2);//.refreshBody();// this causes a bug i think?
                    coin.setScale(0.5);
                    coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 500;
                    coin.body.allowGravity = false;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 21) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 21;
                    var coin = checkpoints.create(x-20, y+32, 'point1').setScale(0.2)//.refreshBody(); this causes a bug i think?
                    coin.anims.play('pointSleepingAnimation');
                    coin.setOrigin(0, 1);
                    coin.body.gravity.y = 0;
                    coin.depth = 1;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 22) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 22;
                    var tree = lights.create(x+74-57, y+65-34, 'streetlight');
                    tree.setScale(0.75)//.refreshBody(); apparently this causes bugs???
                    
                    tree.body.allowGravity = false;
                    //look above :)
                    tree.initX = x;
                    tree.initY = y;
                    tree.initXV = 0;
                    tree.initYV = 0;
                    tree.triggered = "none";
                    tree.falling = false;
                    tree.angleSpeed = 0;
                    tree.setOrigin(0.8, 1);
                    tree.depth = 2;
                }
                if (type == 23) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 23;
                    var coin = keys.create(x+16, y+16, 'key');
                    coin.setOrigin(0.5, 0.5);
                    coin.setScale(0.4);
                    coin.depth = 2;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                    coin.follow = false;
                    coin.body.maxVelocity.x = 500;
                    coin.body.maxVelocity.y = 500;
                } 
                if (type == 24 || type == 30 || type == 31) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = type;
                    var coin;
                    if (type == 24) {
                        coin = doors.create(x+16, y+16, 'door1');
                        
                    } else if (type == 30) {
                        coin = doors.create(x+16, y+16, 'door2');
                    } else {
                        coin = doors.create(x+16, y+16, 'door3');
                    }
                    coin.setOrigin(0.5, 0.5);
                    coin.locked = true;
                    coin.body.gravity.y = 0;
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 25) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 25;
                    var coin = shooters.create(x+16, y+12, 'shooter1');
                    coin.anims.play('shooterAnimation');
                    coin.on(Phaser.Animations.Events.ANIMATION_UPDATE, function (anim, frame, sprite, frameKey) {
                        if (frame.index == 1 || frame.index == 3) {
                            poison = poisons.create(sprite.x, sprite.y, 'poison1');
                            poison.scale = 0.6;
                            poison.anims.play('poisonAnimation');
                            poison.body.velocity.x = 150;

                            poison = poisons.create(sprite.x, sprite.y, 'poison1');
                            poison.scale = 0.6;
                            poison.anims.play('poisonAnimation');
                            poison.body.velocity.x = -150;
                            poison.flipX = true;
                        }
                    }, this);
                    
                    coin.setOrigin(0.5, 0.5);
                    coin.setScale(0.75);
                    coin.body.gravity.y = 0;
                    coin.initX = x;
                    coin.initY = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type >= 26 && type < 27) {
                    names = ['up', 'upright', 'right', 'downright', 'down', 'downleft', 'left', 'upleft']
                    var coin;
                    for (var i = 0; i < 8; i += 1) {
                        if (26 + (i/10) == type) {
                            coin = gums.create(x+16, y+16, names[i]);
                        }
                    }
                    entity1[Math.round(y/32)][Math.round(x/32)] = type;
                    
                    map.putTileAt(0, map.worldToTileX(x), map.worldToTileY(y));
                    coin.setScale(0.100001);
                    coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 27) {
                    entity1[Math.round(y/32)][Math.round(x/32)] = 27;
                    var coin = lives.create(x+16, y+16, 'heart1');
                    coin.setOrigin(0.5, 0.5);
                    coin.setScale(2);
                    coin.body.gravity.y = 0;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 28) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 28;
                    var coin = stones.create(x+16, y+16, '3by3');
                    coin.depth = -3;
                    coin.setOrigin(0.5, 0.5);
                    coin.body.gravity.y = 0;
                    //we need to keep track of initial positions for later.
                    coin.initX = x;
                    coin.initY = y;
                    //coin.body.x = x;
                    //coin.body.y = y;
                    coin.initXV = 0;
                    coin.initYV = 0;
                } 
                if (type == 29) {
                    
                    entity1[Math.round(y/32)][Math.round(x/32)] = 29;
                    var burrito = burritos.create(x+16, y+48, 'flying1');//32 because it is two "blocks" tall.
                    burrito.anims.play('burrito2Animation');
                    burrito.setScale(0.2);
                    //burrito.body.bounce.y = 1; we don't want it to stop when it is in tight spaces.
                    burrito.body.bounce.x = 1;
                    burrito.body.velocity.x = 0;//normally 200 but doesn't need to move yet.
                    burrito.body.allowGravity = false;
                    //look above :)
                    burrito.initX = x;
                    burrito.initY = y;
                    burrito.initXV = 200;
                    burrito.initYV = 0;
                    burrito.fly = true;
                    //tree killing
                    burrito.triggered = false;
                    burrito.frozen = false;
                    
                }
            }
            function returnSprites() {
                
                camera.stopFollow();
                taco.x = Math.round(taco.x);
                taco.y = Math.round(taco.y);
                camera.startFollow(taco, false, 0.1, 0.1);
                taco.setCollideWorldBounds(false);
                while (taco.lives < taco.defLives) {
                    taco.lives += 1;
                    setLives(taco.lives);
                }
                checkpoints.children.iterate((child)=>{
                    child.anims.play('pointSleepingAnimation');
                });
                flags.children.iterate((child)=>{
                    child.anims.play('flagSleepingAnimation');
                    mainMusic.volume = 1;
                });
                coins.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('coin');
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                
                });
                lives.children.iterate(function(child) {
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                });
                burritos.children.iterate(function(child) {
                    if (child.fly == true) {
                        child.anims.stop();
                        child.anims.play('burrito2Animation');
                    } else {
                        child.anims.stop();
                        child.anims.play('burritoAnimation');
                    }
                    
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.triggered = false;
                    child.frozen = false;
                    Phaser.tacoHarmony.active = true;
                    child.setTint(0xffffff);//clear tint.
                            
                });
                drillers.children.iterate(function(child) {
                    bossEmitter.setQuantity(0);
                    child.anims.stop();
                    child.anims.play('drillingAnimation');
                    child.enableBody(true, child.initX+8, child.initY+32+16, true, true);
                    child.originX = 0.5;
                    child.originY = 0.5;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.invincible = false;
                    child.que = 0;
                    child.goUpTo = 1;
                    child.currentSong = 0;
                    child.phase = 0;
                    child.lives = 8;
                    child.immune = false;
                    child.started = false;
                });
                rocks.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.held = false;
                            
                });
                bottles.children.iterate(function(child) {
                    child.enableBody(true, child.initX+16, child.initY+16, true, true);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.held = false;
                    child.angle = 0;
                    child.uses = 3;
                    child.setTexture("ice1");
                    child.visible = true;
                });
                lava.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('lava');
                
                });
                platforms.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.angle = 0;
                
                });
                platformsLeft.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.angle = 0;
                });
                platformsUp.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.angle = 0;
                });
                platformsDown.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.angle = 0;
                });
                limes.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                            
                });
                meatballs.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.angle = random(0, 1)*180;
                    //child.originX = 0.5;
                    //child.originY = 0.5;
                    child.setOrigin(0.5, 0.5);
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                });
                keys.children.iterate(function(child) {
                    child.enableBody(true, child.body.x, child.body.y, true, true);
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                    child.follow = false;
                });
                doors.children.iterate(function(child) {
                    child.enableBody(true, child.x, child.y, true, true);
                    child.scale = 1;
                    child.locked = true;
                    child.body.velocity.x = 0;
                    child.body.velocity.y = 0;
                    child.body.allowGravity = false;
                });
                trees.children.iterate(function(child) {
                    child.angle = 0;
                    
                });
                lights.children.iterate(function(child) {
                    child.angle = 0;
                });
                for (var i = 0; i < bossMusic.length; i += 1) {
                    bossMusic[i].stop();
                }
                taco.setCollideWorldBounds(false);
            }
            function resumeSprites() {
                lava.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('lava');
                
                });
                coins.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('coin');
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                });
                burritos.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                            
                });
                drillers.children.iterate(function(child) {/*
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;*/
                    child.body.gravity.y = 1000;
                    for (var i = 0; i < bossMusic.length; i += 1) {
                        bossMusic[i].stop();
                    }
                });
                mites.children.iterate(function(child) {
                    if (child.body.velocity.y == 0) {
                        child.setOrigin(0.5, 0);
                        child.refreshBody();
                        child.body.allowGravity = true;
                        //child.body.x = child.initX;
                        //child.body.y = child.initY;
                        child.body.velocity.x = child.initXV;
                        child.body.velocity.y = child.initYV;
                        child.anims.stop();
                        child.anims.play('growingMite');
                    }
                    child.body.x = child.initX+16-(child.body.width/2);
                });
                rocks.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                    //we need to re enable gravity as well because of the way we hold the rock
                    child.body.gravity.y = 500;
                });
                trees.children.iterate(function(child) {
                    child.angle = 0;
                    child.triggered = "none";
                    child.falling = false;
                    child.angleSpeed = 0;
                });
                lights.children.iterate(function(child) {
                    child.angle = 0;
                    child.triggered = "none";
                    child.falling = false;
                    child.angleSpeed = 0;
                });
                bottles.children.iterate(function(child){
                    child.body.allowGravity = true;
                    child.body.gravity.y = 500;
                });
                platforms.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.dir = 1;
                    child.angle = 0;
                });
                platformsLeft.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.dir = -1;
                    child.angle = 0;
                });
                platformsUp.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.dir = -1;
                });
                platformsDown.children.iterate(function(child) {
                    child.body.velocity.x = /*child.initXV*/0;
                    child.body.velocity.y = child.initYV;
                    child.dir = 1;
                });
                limes.children.iterate(function(child) {
                    child.body.x = child.initX;
                    child.body.y = child.initY;
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                            
                });
                meatballs.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                });
                keys.children.iterate(function(child) {
                    child.body.velocity.x = child.initXV;
                    child.body.velocity.y = child.initYV;
                    child.body.allowGravity = true;
                });
                shooters.children.iterate(function(child) {
                    child.anims.stop();
                    child.anims.play('shooterAnimation');
                });
                
            }

            function updateColliders() {
                //player update collider
                taco.body.offset.x =  0;
                taco.body.offset.y = 0;
                taco.body.width = taco.width*taco._scaleX;
                taco.body.height = taco.height*taco._scaleY;
                //coins update collider
                coins.children.iterate(function(child) {
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;
                });
                //mites update collider
                mites.children.iterate(function(child) {
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;
                });
                //burrito update collider 
                
                burritos.children.iterate(function(child) {
                    child.body.width = -5+child.width*child._scaleX;
                    /*
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;*/
                });
                //drill boss 
                
                drillers.children.iterate(function(child) {
                    child.body.offset.x = 0;
                    child.body.offset.y = 0;
                    child.body.width = child.width*child._scaleX;
                    child.body.height = child.height*child._scaleY;
                });
            }
            //this variable is used later for the level editing
            var typeEdit = 0;
            var select = 0;
            var rotate = 0;//0 is default, used for grass and gum. loops through 45 degree intervals.
            var currentSelector = 0;
            var disableEdit = false;
            var creative = false;
            var creativeUpdate = false;
            var toolSelect = 'mouse';
            var mainMusic;
            var mainMusic2;
            var bossMusic;
            function create ()
            {
                textSequence = 0;

                menuOpen = false;
                menu.visible = false;
                clearInterval(makeText);
                setTimeout(()=>{clearInterval(transportThisUI.musicFade);}, 1000);
                transportThisUI.cameras.main.fadeIn(1000);
                pause.visible = true;
                score.visible = true;
                hearts.setVisible(true);
                for (var i = 0; i < 5; i += 1) {
                    hearts.children.iterate((child) =>{
                        if (child) {
                            child.destroy();
                        }
                    });
                }
                mode.visible = true;
                
                if (level == 6 || level == 7) {
                    gameLoaded = true;//let it know to add the button for creative.
                    pause.y = 560;
                    sound.y = 560;
                    restart.y = 560;
                    toMenu.y = 560;
                    pause.x = 40;
                    sound.x = 100;
                    restart.x = 160;
                    toMenu.x = 220;
                } else {
                    pause.x = 760;
                    sound.x = 700;
                    restart.x = 640;
                    toMenu.x = 580;
                    pause.y = 40;
                    sound.y = 40;
                    restart.y = 40;
                    toMenu.y = 40;
                    gameLoaded = false;
                }
                menuOpen = false;
                menu.visible = false;
                //text and menu type stuff.
                //levelDisplay = this.add.text(400, 300, 'Level ' + level, {fontFamily: 'Arial', fontSize: '32px', fill: 'white' });//.setOrigin(0.5);
                //vars for tutorial
                
                // "tutorial" var is in the code above
                tutorialSequence = 0;
                //stop sound from last level.
                this.game.sound.stopAll();
                //we don't want this to be shown yet
                this.physics.world.drawDebug = false;
                this.cameras.main.roundPixels = true;
                camera = this.cameras.main;
                camera.setBackgroundColor("#ADD8E6");
                camera.zoom = 1.3;
                this.camera = camera; //better access.
                //music
                mainMusic = this.sound.add('mainMusic');
                mainMusic2 = this.sound.add('mainMusic2');
                caveMusic = this.sound.add('caveMusic');
                burritoJump = this.sound.add('burritoJump');
                bossMusic = [];
                for (var i = 1; i < 7; i += 1) {
                    bossMusic.push(this.sound.add('boss' + String(i)));
                }
                /*
                for (var i = 0; i < bossMusic.length; i += 1) {
                    bossMusic[i].loop = true;
                }*/
                gameOverMusic = this.sound.add('overMusic');
                mainMusic.volume = 0;
                mainMusic2.volume = 0;
                
                //mainMusic.loop = true;
                if (level != 5) {
                    if (Math.round(level/2) != level/2) {
                        mainMusic2.play();
                        
                    } else {
                        mainMusic.play();
                    }
                } else {
                    caveMusic.play();
                }
                
                mainMusic.fade = setInterval(()=>{
                    mainMusic.volume += 0.08;
                    mainMusic2.volume += 0.08;
                    if (mainMusic.volume >= 1) {
                        mainMusic.volume = 1;
                        mainMusic2.volume = 1;
                        clearInterval(mainMusic.fade);
                    }
                }, 16);
                mainMusic.on('complete', ()=>{setTimeout(()=>{mainMusic2.play();}, 1000)});
                mainMusic2.on('complete', ()=>{setTimeout(()=>{mainMusic.play();}, 1000)});
                caveMusic.on('complete', ()=>{setTimeout(()=>{caveMusic.play();}, 1000)});
                this.graphics = this.add.graphics();
                //the variables of the game.
                tacoVelocityX = 0;
                select = 0;

                map = this.make.tilemap({data: map1, tileWidth: 32, tileHeight: 32});
                map.addTilesetImage('landscape')//.setScale(0.5).refreshBody();
                layer1 = map.createLayer(0, 'landscape', 0, 0);
                layer1.depth = 0;
                function createEntities(entityList, gridWidth, gridHeight) {
                    creative = true;

                    for (var i=0; i<entityList.length; i += 1) {
                        for (var e=0; e<entityList[0].length; e += 1) {
                            var platformOffset = 0;
                            if (entityList[i][e] == 13 || entityList[i][e] == 16 || entityList[i][e] == 17 || entityList[i][e] == 18) {
                                platformOffset = 64;
                            }
                            newEntity(entityList[i][e], -16+(e*gridHeight)+gridHeight/2, -16+(i*gridWidth)+gridWidth/2, platformOffset, 32);
                        }
                    }
                    creative = false;
                    resumeSprites();
                }
                //the background
                clouds = this.physics.add.group();
                clouds.depth = -1;
                for (var i = 0; i < ((layer1.width/7000) * 30); i += 1) {
                    cloud = clouds.create(random(1, layer1.width), random(1, 450), 'cloud' + String(random(1, 2))).setScale(random(30, 40)/10).refreshBody(); 
                    if (random(1, 2) == 1) {
                        cloud.body.velocity.x = random(25, 50);
                    } else {
                        cloud.body.velocity.x = random(-25, -50);
                    }
                    cloud.depth = -5;
                    if (random(1, 2) == 1) {
                        cloud.flipX = true;
                    }
                }

                //game.stage.backgroundColor = "#4488AA";
                
                
                //layer1.setFrictionX(5);
                

                //animations below
                //drilling around
                this.anims.create({key:'drillingAnimation',
                 frames: [{key: 'drill1'},
                 {key: 'drill2'},
                 {key: 'drill3'},
                 {key: 'drill4'},
                 {key: 'drill5'},
                 {key: 'drill6'},
                 {key: 'drill7'},
                 {key: 'drill8'},
                 {key: 'drill9'},],
                frameRate:10,
                repeat:-1});
                this.anims.create({key:'downAnimation',
                 frames: [{key: 'down1'},
                 {key: 'down2'/*, width:16, height:31*/},
                 {key: 'down3'},
                 {key: 'down4'},
                 {key: 'down5'},
                 {key: 'down6'},
                 {key: 'down7'},
                 {key: 'down8'},
                 {key: 'down9'},
                 {key: 'down10'},
                 {key: 'down11'},
                 {key: 'down12'},
                 {key: 'down13'},
                 {key: 'down14'},],
                frameRate:10,
                repeat:0});
                this.anims.create({key:'upAnimation',
                 frames: [{key: 'down13'},
                 {key: 'down12'/*, width:16, height:31*/},
                 {key: 'down11'},
                 {key: 'down10'},
                 {key: 'down9'},
                 {key: 'down8'},
                 {key: 'down7'},
                 {key: 'down6'},
                 {key: 'down5'},
                 {key: 'down4'},
                 {key: 'down3'},
                 {key: 'down2'},
                 {key: 'down1'},],
                frameRate:45,
                repeat:0});
                this.anims.create({key:'poppingAnimation',
                 frames: [{key: 'up1'},
                 {key: 'up2'/*, width:16, height:31*/},
                 {key: 'up3'},
                 {key: 'up4'},
                 {key: 'up5'},],
                frameRate:20,
                repeat:0});
                this.anims.create({key:'shredingAnimation',
                 frames: [{key: 'shred1'},
                 {key: 'shred2'/*, width:16, height:31*/},
                 {key: 'shred3'},
                 {key: 'shred4'},
                 {key: 'shred5'},
                 {key: 'shred6'},],
                frameRate:20,
                repeat:-1});
                this.anims.create({key:'unPoppingAnimation',
                 frames: [{key: 'up5'},
                 {key: 'up4'/*, width:16, height:31*/},
                 {key: 'up3'},
                 {key: 'up2'},
                 {key: 'up1'},
                 {key: 'down14'},],//down 14 is a transparent image :)
                frameRate:20,
                repeat:0});
                //burrito
                this.anims.create({key:'burritoAnimation',
                 frames: this.anims.generateFrameNames('burrito'),
                frameRate:10,
                repeat:-1});
                //burrito2
                this.anims.create({key:'burrito2Animation',
                 frames: [{key: 'flying1'},
                 {key: 'flying2'/*, width:16, height:31*/},
                 {key: 'flying3'},
                 {key: 'flying4'},
                 {key: 'flying5'},
                 {key: 'flying6'},
                 {key: 'flying7'},
                 {key: 'flying8'},],
                frameRate:10,
                repeat:-1});
                //shooter poison
                this.anims.create({key: 'poisonAnimation',
                 frames: [{key: 'poison1'},
                {key: 'poison2'},],
                frameRate:10,
                repeat:-1});
                //lava
                this.anims.create({key:'lavaAnimation',
                 frames: [{key: 'lava1'},
                 {key: 'lava2'},
                 {key: 'lava3'},
                 {key: 'lava4'},
                 {key: 'lava5'},
                 {key: 'lava6'},
                 {key: 'lava7'},
                 {key: 'lava8'},],
                frameRate:10,
                repeat:-1});
                //heart animation
                this.anims.create({key:'heartAnimation',
                 frames: [{key: 'heart1'},
                 {key: 'heart2'},
                 {key: 'heart3'},
                 {key: 'heart4'},
                 {key: 'heart5'},
                 {key: 'heart6'},
                 {key: 'heart7'},
                 {key: 'heart8'},],
                frameRate:20,
                repeat:0});
                //moving right
                this.anims.create({key: 'right',
                 frames: [{key: 'right1'},
                {key: 'right2'},],
                frameRate:10,
                repeat:-1});
                //moving left
                this.anims.create({key: 'left',
                 frames: [{key: 'left1'},
                {key: 'left2'},],
                frameRate:10,
                repeat:-1});
                //holding still
                this.anims.create({key: 'holdStill',
                 frames: [{key: 'still'},],
                frameRate:10,
                repeat:-1});
                //coin
                this.anims.create({key: 'coin',
                 frames: [{key: 'coin1'},
                {key: 'coin3'},
                {key: 'coin2'},
                {key: 'coin4'},],
                frameRate:10,
                repeat:-1});
                //mites
                this.anims.create({key: 'growingMite',
                 frames: [{key: 'mite1'},
                {key: 'mite2'},
                {key: 'mite3'},
                {key: 'mite4'},
                {key: 'mite5'},],
                frameRate:0.3,
                repeat:0});
                //potato
                this.anims.create({key: 'potatAnim',
                 frames: [{key: 'potat1'},
                {key: 'potat2'},],
                frameRate:10,
                repeat:-1});
                //lava
                this.anims.create({key: 'lava',
                 frames: [{key: 'lava1'},
                {key: 'lava2'},
                {key: 'lava3'},
                {key: 'lava4'},
                {key: 'lava5'},
                {key: 'lava6'},
                {key: 'lava7'},
                {key: 'lava8'},],
                frameRate:10,
                repeat:-1});
                //platform
                this.anims.create({key: 'platformAnimation',
                 frames: [{key: 'platform1'},
                {key: 'platform2'},],
                frameRate:10,
                repeat:-1});
                //checkpoint animations and flag animations
                this.anims.create({key:'pointSleepingAnimation',
                 frames: [{key: 'point4'},
                 {key: 'point5'},],
                frameRate:1,
                repeat:-1});
                this.anims.create({key:'pointAwakeAnimation',
                 frames: [{key: 'point1'},
                 {key: 'point2'},
                 {key: 'point3'},
                 {key: 'point2'},],
                frameRate:4,
                repeat:-1});
                this.anims.create({key:'flagSleepingAnimation',
                 frames: [{key: 'flag4'},
                 {key: 'flag5'},],
                frameRate:1,
                repeat:-1});
                this.anims.create({key:'flagAwakeAnimation',
                 frames: [{key: 'flag1'},
                 {key: 'flag2'},
                 {key: 'flag3'},
                 {key: 'flag2'},],
                frameRate:4,
                repeat:-1});

                //end of animations :)
                //but start of particle emitters
                ingredients = this.add.particles('burritoParticles');
                //we make a few of these just in case more than one burrito needs one.
                ingredientEmitters = [];
                for (var i=0; i < 6; i += 1) {
                    ingredientEmitters.push(ingredients.createEmitter({
                        frame: [0, 1, 2, 3],
                        x: 500,
                        y: 500,
                        frequency: 50,
                        quantity: 0,
                        angle: { min: -180, max: 180 },
                        speed: 200,
                        gravityY: 100,
                        lifespan: { min: 1000, max: 2000 },
                    }));
                }
                ingredientEmitter = ingredients.createEmitter({
                    frame: [0, 1, 2, 3],
                    x: 500,
                    y: 500,
                    frequency: 50,
                    quantity: 0,
                    angle: { min: -180, max: 180 },
                    speed: 200,
                    gravityY: 100,
                    lifespan: { min: 1000, max: 2000 },
                });
                dirtEmitter = ingredients.createEmitter({
                    frame: [0],
                    x: 500,
                    y: 500,
                    frequency: 120,
                    quantity: 0,
                    angle: { min: -150, max: -30 },
                    speed: 100,
                    gravityY: 200,
                    lifespan: { min: 200, max: 400 },
                });
                dirtEmitter.setScale(0.5);
                bossEmitter = ingredients.createEmitter({
                    frame: [0],
                    x: 500,
                    y: 500,
                    frequency: 120,
                    quantity: 0,
                    angle: { min: -150, max: -30 },
                    speed: 100,
                    gravityY: 200,
                    lifespan: { min: 200, max: 400 },
                });
                bossEmitter.setScale(0.5);
                //able to restart later
                this.restartGame = function() {
                    this.scene.restart();
                }
                //tutorial potato
                potat = this.physics.add.sprite(400, 1000, 'potat1').setScale(2.3).refreshBody();
                potat.anims.play('potatAnim');
                potat.depth = 2;
                potat.summoned = false;//only used outside of tutorial.
                if (tutorial == true) {
                    potat.visible = true;
                    potat.y = 400;
                } else {
                    potat.visible = false;
                }
                potat.goto = false;
                
                //player sprite
                if (tutorial == true) {
                    taco = this.physics.add.sprite(400, layer1.height-200, 'still').setScale(1.75).refreshBody();
                } else {
                    taco = this.physics.add.sprite(100, layer1.height-200, 'still').setScale(1.75).refreshBody();
                }
                taco.body.setMaxVelocityY(900);
                taco.disabled = false;//control whether they can move;
                taco.cream = false;
                taco.gum = false;
                taco.holding = false;
                taco.gumDir = 1;
                taco.body.gravity.y = 1150;
                taco.body.drag.x = 100;
                taco.depth = 2;
                taco.touchingTree = false;
                taco.immortale = false;//used for boss
                taco.skipDeath = false;//used for general purpose.
                taco.lives = 5;
                taco.defLives = 5;
                taco.setFrictionX(1);
                taco.limitX = 664;
                //taco.setCollideWorldBounds();
                taco.jumpHold = 0;
                taco.minigame = false;
                if (tutorial == true) {
                    taco.startX = 400;
                } else {
                    taco.startX = 100;
                }
                taco.startY = layer1.height-200;
                //minigame
                ship = this.physics.add.sprite(400, 480, "still");
                ship.visible = false;
                bullets = this.physics.add.group();
                enemies = this.physics.add.group();
                

                //collisions with player
                layer1.setCollision([0, 2, 3, 8, 10, 13, 14, 15, 16, 17, 18, 19, 20]);
                this.physics.add.collider(taco, layer1);
                //hearts
                //hearts = this.physics.add.group();
                //we put this in the UI create
                for (var i = 0; i < taco.lives; i += 1) {
                    heart = hearts.create(35+(i*35), 35, 'heart1').setScale(2);
                    heart.scrollFactorX = 0;
                    heart.scrollFactorY = 0;
                    heart.depth = 3;
                }

                
                //mouse selector
                gridSelector = this.physics.add.sprite(0, 0, 'selector');
                gridSelector.depth = 2;
                
                //entity groups etc
                entities = [];//store the groups for erasing and level editor.
                mouseZone = this.add.zone(0, 0).setSize(2, 2);
                this.physics.world.enable(mouseZone);
                //creating the groups
                entities.push(spikes = this.physics.add.group());
                entities.push(stones = this.physics.add.group());
                entities.push(coins = this.physics.add.group());
                entities.push(drillers = this.physics.add.group());
                entities.push(trees = this.physics.add.group());
                entities.push(burritos = this.physics.add.group());
                entities.push(mites = this.physics.add.group());
                entities.push(rocks = this.physics.add.group());
                entities.push(drillerFlags = this.physics.add.group());
                entities.push(burritoBarriers = this.physics.add.staticGroup());
                entities.push(bottles = this.physics.add.group());
                entities.push(iceBalls = this.physics.add.group());
                entities.push(lava = this.physics.add.group());
                entities.push(platforms = this.physics.add.group({
                    immovable: true
                }));
                entities.push(platformsLeft = this.physics.add.group({
                    immovable: true
                }));
                entities.push(platformsUp = this.physics.add.group({
                    immovable: true
                }));
                entities.push(platformsDown = this.physics.add.group({
                    immovable: true
                }));
                entities.push(limes = this.physics.add.group());
                entities.push(flags = this.physics.add.group());
                entities.push(creams = this.physics.add.group());
                entities.push(meatballs = this.physics.add.group());
                entities.push(checkpoints = this.physics.add.group());
                entities.push(lights = this.physics.add.group());
                entities.push(keys = this.physics.add.group());
                entities.push(doors = this.physics.add.group({
                    immovable: true
                }));
                entities.push(shooters = this.physics.add.group({
                    immovable: true
                }));
                poisons = this.physics.add.group();
                boulders = this.physics.add.group();
                entities.push(lives = this.physics.add.group());
                boulders.makeNew = function() {
                    camera.shake(400, 0.005);
                    if (random(1,5) == 1) {
                        boulder = boulders.create(random(camera.worldView.x, camera.worldView.x + camera.worldView.width), camera.worldView.y - 25, 'boulder2');
                        boulder.body.gravity.y = 100;
                    } else {
                        boulder = boulders.create(random(camera.worldView.x, camera.worldView.x + camera.worldView.width), camera.worldView.y - 25, 'boulder1');
                        boulder.body.gravity.y = 200;
                    }
                    boulder.scale = 0.3;
                    
                }
                
                entities.push(gums = this.physics.add.group());
                
                //not necesariily a group but goes along with rocks
                arrow = this.physics.add.sprite(taco.body.x, taco.body.y, 'aimArrow').setScale(4).refreshBody();
                arrow.setOrigin(0.5, 1);
                arrow.visible = false;
                arrow.depth = 3;
                arrow.direction = 1;
                //colliding/overlaping the groups
                this.physics.add.overlap(taco, coins, collectCoin, null, this);
                this.physics.add.overlap(taco, burritos, hitBurrito, null, this);
                this.physics.add.overlap(taco, shooters, tacoHitShooters, null, this);
                this.physics.add.overlap(taco, drillers, hitDrill, null, this);
                this.physics.add.overlap(taco, rocks, touchingRock, null, this);
                this.physics.add.overlap(mites, rocks, rockHitMite, null, this);
                this.physics.add.overlap(mites, drillers, drillerHitMite, null, this);
                this.physics.add.overlap(mites, burritos, burritoHitMite, null, this);
                this.physics.add.overlap(taco, mites, tacoHitMites, null, this);
                this.physics.add.overlap(rocks, drillers, rockHitDriller, null, this);
                this.physics.add.overlap(taco, trees, tacoHitTree, null, this);
                this.physics.add.overlap(taco, lights, tacoHitLight, null, this);
                this.physics.add.overlap(burritos, trees, burritoHitTree, null, this);
                this.physics.add.overlap(burritos, lights, burritoHitLight, null, this);
                this.physics.add.overlap(taco, bottles, tacoHitBottle, null, this);
                this.physics.add.overlap(burritos, iceBalls, burritoHitIceBall, null, this);
                this.physics.add.overlap(burritos, burritos, burritoHitBurrito, null, this);
                this.physics.add.overlap(taco, lava, tacoHitLava, null, this);
                this.physics.add.overlap(burritos, limes, burritoHitLime, null, this);
                this.physics.add.overlap(taco, limes, tacoHitLime, null, this);
                this.physics.add.overlap(taco, flags, tacoHitFlag, null, this);
                this.physics.add.overlap(taco, creams, tacoHitCream, null, this);
                this.physics.add.overlap(taco, meatballs, tacoHitMeatball, null, this);
                this.physics.add.overlap(ship, enemies, shipHitEnemy, null, this);
                this.physics.add.overlap(bullets, enemies, bulletHitEnemy, null, this);
                this.physics.add.overlap(taco, checkpoints, tacoHitCheckpoint, null, this);
                this.physics.add.overlap(burritoBarriers, platforms, barrierHitPlatform, null, this);
                this.physics.add.overlap(burritoBarriers, platformsLeft, barrierHitPlatform, null, this);
                this.physics.add.overlap(burritoBarriers, platformsDown, barrierHitPlatform, null, this);
                this.physics.add.overlap(burritoBarriers, platformsUp, barrierHitPlatform, null, this);
                this.physics.add.overlap(taco, keys, tacoHitKey, null, this);
                this.physics.add.overlap(keys, doors, keyHitDoor, null, this);
                this.physics.add.overlap(taco, poisons, tacoHitPoison, null, this);
                for (var i = 0; i < entities.length; i += 1) {
                    this.physics.add.overlap(mouseZone, entities[i], mouseOverlap, null, this);
                }
                this.physics.add.overlap(taco, spikes, death, null, this);
                this.physics.add.overlap(taco, gums, tacoHitGum, null, this);
                this.physics.add.overlap(taco, boulders, tacoHitBoulder, null, this);
                this.physics.add.overlap(taco, lives, tacoHitLive, null, this);
                this.physics.add.overlap(doors, doors, doorHitDoor, null, this)

                this.physics.add.collider(rocks, rocks);
                this.physics.add.collider(doors, meatballs);
                this.physics.add.collider(doors, platforms);
                this.physics.add.collider(doors, platformsDown);
                this.physics.add.collider(doors, platformsLeft);
                this.physics.add.collider(doors, platformsUp);
                this.physics.add.collider(burritos, layer1);
                this.physics.add.collider(drillers, layer1);
                this.physics.add.collider(rocks, layer1);
                this.physics.add.collider(burritos, burritoBarriers);
                this.physics.add.collider(bottles, layer1);
                this.physics.add.collider(bottles, bottles);
                this.physics.add.collider(burritos, burritos);
                this.physics.add.collider(taco, platforms);
                this.physics.add.collider(taco, platformsLeft);
                this.physics.add.collider(taco, platformsUp);
                this.physics.add.collider(taco, platformsDown);
                this.physics.add.collider(limes, platforms);
                this.physics.add.collider(limes, platformsLeft);
                this.physics.add.collider(limes, platformsUp);
                this.physics.add.collider(limes, platformsDown);
                this.physics.add.collider(limes, layer1);
                this.physics.add.collider(taco, limes);
                this.physics.add.collider(limes, limes);
                this.physics.add.collider(limes, burritos);
                this.physics.add.collider(taco, meatballs, false, null, this);
                this.physics.add.collider(meatballs, layer1);
                this.physics.add.collider(keys, layer1);
                this.physics.add.collider(taco, doors);
                this.physics.add.collider(poisons, layer1);
                this.physics.add.collider(keys, limes);
                this.physics.add.collider(doors, limes);
                this.physics.add.collider(burritos, doors);
                this.physics.add.collider(bottles, doors);
                this.physics.add.collider(meatballs, meatballs);
                Phaser.tacoHarmony = this.physics.add.collider(taco, burritos);//have to access it elsewhere
                Phaser.tacoHarmony.active = false;

                //reaction functions
                function shipHitEnemy(ship, enemy) {
                    sequenceEnd = 14;
                    box.destroy();
                    taco.minigame = false;
                    ship.destroy();
                    enemies.destroy();
                    bullets.destroy();
                }
                function bulletHitEnemy(bullet, enemy) {
                    enemy.destroy();
                    bullet.destroy();
                }
                function collectCoin(Taco, coin) {//taco capitalized so that we don't confuse it with regular "taco"
                    coin.disableBody(true, true);
                    score.add(1);
                }
                function hitBurrito(Taco, burrito) {
                    if (burrito.frozen == false) {
                        //Phaser.tacoHarmony.active = false;
                        death();
                    }
                }
                function tacoHitShooters(taco, shooter) {
                    death();
                }
                function tacoHitCheckpoint(taco, checkpoint) {
                    if (checkpoint.anims.currentAnim.key == "pointSleepingAnimation") {
                        checkpoint.anims.play("pointAwakeAnimation");
                        taco.startX = checkpoint.x;
                        taco.startY = checkpoint.y - 150;
                        while (taco.lives < taco.defLives) {
                            taco.lives += 1;
                            setLives(taco.lives);
                        }
                    }
                }
                function burritoHitTree(burrito, tree) {
                    if (tree.triggered == true && burrito.triggered == false && check1 == 60) {
                        burrito.triggered = true;
                        setTimeout(()=>{ingredientParticleEmit(burrito.x, burrito.y, 10, 300, burrito);}, 500);
                        
                    }
                }
                function burritoHitLight(burrito, tree) {
                    if (tree.triggered == true && burrito.triggered == false) {
                        burrito.triggered = true;
                        setTimeout(()=>{ingredientParticleEmit(burrito.x, burrito.y, 10, 300, burrito);}, 500);
                    }
                }
                
                function rockHitMite(mite, rock) {
                    mite.body.gravity.y = 1000;
                    mite.anims.stop();
                }
                function drillerHitMite(mite, driller) {
                    if (driller.invincible == false && driller.immune == false) {
                        driller.immune = true;
                        driller.alpha = 0.5;
                        setTimeout(()=>{driller.immune = false;driller.alpha = 1;}, 1500);
                        mite.body.x = mite.initX;
                        mite.body.y = mite.initY;
                        mite.body.gravity.y = 0;
                        mite.body.velocity.y = 0;
                        mite.anims.stop();
                        mite.anims.play("growingMite");
                        driller.lives -= 1;
                        if (driller.lives < 1) {
                            
                            bossEmitter.setQuantity(0);
                            driller.goUpTo = 5;
                            for (var i = 0; i < bossMusic.length; i += 1) {
                                bossMusic[i].stop();

                            }
                            bossMusic[5].play();
                            bossMusic[5].once('complete', ()=>{
                                //have mr potat congradulate them
                                finished = true;
                            });
                            setTimeout(function(){camera.shake(2000, 0.02)}, 400);
                            
                            driller.disableBody(true, true);
                            ingredientParticleEmit(driller.x, driller.y, 40, 1500, false);
                            
                        } else {
                            camera.shake(400, 0.005);
                        }
                    }
                }
                function burritoHitMite(mite, burrito) {
                    if (burrito) {
                        ingredientParticleEmit(burrito.x, burrito.y, 10, 300, burrito);
                        burrito.disableBody(true, true);
                    }
                }
                function hitDrill (taco, drill) {
                    if (drill.texture.key != 'down14') {//make sure he isn't invisible
                        death();
                    }
                };
                function tacoHitMites(taco, mite) {
                    death();
                }
                function rockHitDriller(rock, driller) {
                    if (driller.invincible == true && rock.body.velocity.y < 50) {
                        rock.body.velocity.y = -300;
                    }
                }
                this.dirX = 0;
                this.dirY = -500;
                this.dirChange = 1;
                function touchingRock(Taco, Rock) {
                    if (keySpace.isDown) {
                        var anyHeld = false;
                        rocks.children.iterate(function(child) {
                            if (child.held) {
                                anyHeld = true;
                            }
                        })
                        if (anyHeld == false) {
                            Rock.held = true;
                        } 
                        /*
                        rocks.children.iterate(function(child) {
                            if (child.held == true && !(child == Rock)) {
                                Rock.held = false;
                            } else {
                                Rock.held = true;
                            }
                        });*/
                    }

                }
                function tacoHitTree(Taco, Tree) {
                    taco.touchingTree = true;
                    var otherTree = false;
                    trees.children.iterate((child) =>{
                        if (child.triggered == true) {
                            otherTree = true;
                        }
                    });
                    if (Tree.triggered == "none" && keySpace.isDown && otherTree == false) {
                        console.log('triggered');
                        Tree.triggered = true;
                        check1 = 0;
                        Tree.body.offset.x = 175; //move the tree with it.
                        Tree.body.offset.y = 0;
                        //Tree.body.width += 175;
                    }
                }
                function tacoHitLight(Taco, Light) {
                    taco.touchingTree = true;
                    if (Light.triggered == "none" && keySpace.isDown) {
                        Light.triggered = true;
                        Light.body.offset.x =  0;
                        Light.body.offset.y = 0;
                        Light.body.width += 60;
                    }
                }
                function tacoHitBottle(Taco, Bottle) {
                    if (keySpace.isDown && Bottle.visible == true) {
                        
                        Bottle.held = true;
                        //Bottle.allowGravity = false;
                        Bottle.body.gravity.y = 0;
                        Bottle.body.velocity.y = 0;
                        if (camera.zoom > 1) {
                            camera.zoom -= 0.015;
                        }
                    }
                }
                function burritoHitIceBall(Burrito, Ball) {
                    Burrito.frozen = true;
                    Burrito.body.velocity.x = 0;
                    Burrito.setTint(0x0101CC);
                    //Phaser.tacoHarmony.active = true;
                    Burrito.anims.stop();
                    Ball.destroy();
                }
                function burritoHitBurrito(burrito1, burrito2) {
                    if (burrito1.frozen == true && Math.abs(burrito1.body.velocity.x) > 220 && burrito2.frozen == false) {
                        burrito2.disableBody(true, true);
                        ingredientParticleEmit(burrito2.x, burrito2.y, 10, 300, burrito2);
                    }
                }
                function tacoHitLava(Taco, Lava) {
                    death(true);
                } 
                function burritoHitLime(Burrito, Lime) {
                    if (Math.abs(Lime.body.velocity.x) > 0) {
                        ingredientParticleEmit(Burrito.x, Burrito.y, 10, 400, Burrito);
                        Burrito.disableBody(true, true);
                        Lime.body.velocity.x *= 1.7;
                        if (Lime.x < taco.x) {
                            Lime.body.x -= 5;
                        } else {
                            Lime.body.x += 5;
                        }
                        if (Math.abs(Lime.body.velocity.x) > 700) {
                            Lime.body.velocity.x = 700 * (Lime.body.velocity.x / Math.abs(Lime.body.velocity.x));
                        }

                    }
                }
                function tacoHitLime(Taco, Lime) {
                    if (Math.abs(Lime.body.velocity.x) > 300) {
                        if (Lime.x > Taco.x && Lime.body.velocity.x < 0) {
                            death();
                        } else if (Lime.x < Taco.x && Lime.body.velocity.x > 0) {
                            death();
                        }
                        
                    }
                }
                function barrierHitPlatform(barrier, platform) {
                    platform.turn = true;
                }
                function tacoHitKey(taco, key) {
                    if (keySpace.isDown) {
                        /*
                        key.x = taco.x;
                        key.y = taco.y;
                        key.body.velocity.x = taco.body.velocity.x;
                        key.body.velocity.y = taco.body.velocity.y;
                        */
                        key.follow = true;
                    }
                }
                function keyHitDoor(key, door) {
                    if (creative == false) {
                        key.disableBody(true, true);
                        door.scale = 1.01;
                        door.locked = false;
                        setTimeout(()=>{door.disableBody(true, true);}, 200);
                    }
                }
                function tacoHitPoison(taco, poison) {
                    death();
                }
                function mouseOverlap(mouse, child) {
                    if (creative == true && ((this.input.manager.activePointer.isDown && toolSelect == 'erase') || keyE.isDown)) {
                        if (child.texture.key == 'tree1') {
                            //checks if it is a tree
                            map.putTileAt(-1, map.worldToTileX(child.initX-32), map.worldToTileY(child.initY));
                            map.putTileAt(-1, map.worldToTileX(child.initX), map.worldToTileY(child.initY));
                            map.putTileAt(-1, map.worldToTileX(child.initX+32), map.worldToTileY(child.initY));
                        }
                        
                        entity1[Math.round(child.initY/32)][Math.round(child.initX/32)] = -1;
                        child.destroy();
                    }
                }
                function tacoHitGum(taco, gum) {
                    taco.gum = true;
                    if (gum.x > taco.x) {
                        taco.gumDir = 1;
                    } else {
                        taco.gumDir = 01;
                    }
                }
                function tacoHitBoulder(Taco, Boulder) {
                    if (taco.alpha != 0.5) {
                        death(true);
                    }
                }
                function tacoHitLive(Taco, Live) {
                    Live.disableBody(true, true);
                    taco.lives += 1;
                    setLives(taco.lives);
                }
                function doorHitDoor(door1, door2) {
                    if (creative == false) {
                        if (door1.locked == false && door1.scale > 1 || door2.locked == false && door2.scale > 1) {
                            door1.locked = false;
                            door2.locked = false;
                            if (door1.scale == 1) {
                                setTimeout(()=>{door1.scale = 1.01;}, 200);
                                setTimeout(()=>{door1.disableBody(true, true);}, 600);
                            }
                            if (door2.scale == 1) {
                                setTimeout(()=>{door2.scale = 1.01;}, 200);
                                setTimeout(()=>{door2.disableBody(true, true);}, 600);
                            }
                        }
                    }
                }
                var transportThis = this;//allow us to restart the game in a callback.
                var sequenceEnd = 8;
                function tacoHitFlag(Taco, Flag) {
                    score.visible = false;
                        if (mainMusic.volume == 1) {//check if started yet
                            mainMusic.volume = 0.999;
                            Flag.anims.play('flagAwakeAnimation');
                            if (level < 6) {
                                if (unlocked < level + 1) {
                                    unlocked = level + 1;
                                }
                                levelEnd.alpha = 0;
                                levelEnd.visible = true;
                                mainMusic.volume = 0.999;//make sure that it only goes once.
                                levelEnd.fadeout = setInterval(()=>{
                                    levelEnd.alpha += 0.017;
                                    transportThisGame.sound.volume -= 0.017;
                                    if(levelEnd.alpha >= 1)
                                    {
                                        
                                        mainMusic.volume = 0;
                                        mainMusic2.volume = 0;
                                        transportThisGame.sound.volume = 1;
                                        levelEnd.setAlpha(1);
                                        clearInterval(levelEnd.fadeout);
                                        menuOpen = true;
                                        transportThisGame.scene.pause();
                                    }
                                }, 16);
                                if (taco.disabled == false) {
                                    transportThis = this;
                                    taco.disabled = true;
                                }
                                taco.disabled = true;
                            }
                            
                        }
                    
                    
                    
                }
                function tacoHitCream(Taco, Cream) {
                    taco.cream = true;
                }
                function tacoHitMeatball(Taco, Meatball) {
                    if (Math.abs(Taco.x - Meatball.x) < 30 && (Taco.body.y + Taco.height) < Meatball.y) {
                        if (Taco.body.touching.down) {
                            Taco.body.velocity.y = -600;
                            Meatball.body.velocity.x = random(-200, 200);
                        }
                        if (Taco.body.touching.down && (cursors.up.isDown || keyW.isDown) && taco.disabled == false) {
                            Taco.body.velocity.y = -1500;
                            Meatball.body.velocity.x = random(-200, 200);
                        }
                    }
                }
                
                
                //burritoparticles
                //this is where the ingredientParticle emit funciton was.
                //accessing this elsewhere
                this.ingredientParticleEmit = ingredientParticleEmit;
                //create the entities
                createEntities(entity1, 32, 32);
                //text on top
                //font
                
                add = this.add;
                WebFont.load({
                    custom: {
                        families: [ 'mono' ]
                    },
                    active: function ()
                    {
                        //add.text(32, 32, 'Bad Bad Burritos', { fontFamily: 'mono', fontSize: 60, color: '#ffffff' });
                    }
                });
                textBox = this.add.image(400, /*115*/170, 'text').setScale(0.2);
                textBox.scrollFactorX = 0;
                textBox.scrollFactorY = 0;
                if (tutorial == true) {
                    textBox.visible = true;
                } else {
                    textBox.visible = false;
                }
                
                //tutorial vars at the top of create function, for earlier use.
                
                //the main camera
                this.cameras.main.setBounds(0, 0, map.widthInPixels, map.heightInPixels);//infinite worlds
                taco.x = Math.round(taco.x);
                taco.y = Math.round(taco.y);
                this.cameras.main.startFollow(taco, false, 0.1, 0.1);
                //restart
                this.restart = function () {
                    this.scene.restart();
                }
                this.eraseEntity = function eraseEntity(x, y) {
                    
                    for (var i = 0; i < entities.length; i += 1) {
                        entities[i].children.iterate(function(child) {
                            if (child && Math.round(child.initX/32)*32 == Math.round((-16+x)/32)*32 && Math.round(child.initY/32)*32 == Math.round((-16+y)/32)*32) {
                                entity1[Math.round(child.initY/32)][Math.round(child.initX/32)] = -1;
                                child.destroy();
                            }
                        });
                    }
                }
            }
            function setLives(lives) {
                if (/*hearts.children.entries[0]*/true) {
                    if (lives < 1) {
                        lives = 1;
                    }
                    if (lives < hearts.children.entries.length) {
                        heart = hearts.children.entries[hearts.children.entries.length-1];
                        heart.anims.play('heartAnimation').once('animationcomplete', function(){
                            heart.destroy();
                        });
                    }
                    if (lives > hearts.children.entries.length) {
                        lastHeart = hearts.children.entries[hearts.children.entries.length-1];
                        heart = hearts.create(lastHeart.x + 35, 35, 'heart1').setScale(2);
                        heart.depth = 3;
                        heart.scrollFactorX = 0;
                        heart.scrollFactorY = 0;
                    }
                }
            }
            function ingredientParticleEmit(x, y, quantity, time, burrito) {
                    var ingredientSelect = 0;//default is zero to prevent bugs when too many burritos
                        //loop through emitters
                        for (var i = 0; i < ingredientEmitters.length; i += 1) {
                            if (ingredientEmitters[i].quantity.propertyValue == 0) {
                                //when we find the right one give us it.
                                ingredientSelect = i;
                                break;
                                
                            }
                        }
                        ingredientEmitters[ingredientSelect].setPosition(x, y);
                        ingredientEmitters[ingredientSelect].setQuantity(quantity);
                        if (burrito) {//checks if it exists.
                            burrito.dying = true;
                            setTimeout(function() {
                                if (burrito.dying) {//we have this here so that if we die before it does, the burrito stays alive.
                                    burrito.body.blocked.down = false;
                                    burrito.disableBody(true, true);
                                }
                                ingredientEmitters[ingredientSelect].setQuantity(0);
                            }, time);
                        } else {
                            setTimeout(function() {ingredientEmitters[ingredientSelect].setQuantity(0)}, time);
                        }
                        
                }
            //goes with text function as global var
            var currentDialog;
            var makeText;
            function text(text, delay, action) {
                makeText = setInterval(drawCurrentText, 65);
                if (currentDialog) {
                    currentDialog.destroy();
                }
                add = transportThisUI.add;
                WebFont.load({
                    custom: {
                        families: [ 'mono' ]
                    },
                    active: function ()
                    {
                        
                        currentDialog = add.text(220, 50, text.charAt(0), { fontFamily: 'mono', fontSize: 22, color: '#ffffff' });
                        currentDialog.scrollFactorX = 0;
                        currentDialog.scrollFactorY = 0;
                        //currentDialog.style.wordWrapWidth = 350;
                        //currentDialog.style.wordWrapUseAdvanced = true;
                    }

                });
                function drawCurrentText() {
                    if (text.charAt(currentDialog._text.length) == ' ') {
                        if (currentDialog.setText) {
                            currentDialog.setText(currentDialog._text + text.charAt(currentDialog._text.length));
                        }
                        
                    }
                    if (currentDialog.setText) {
                            currentDialog.setText(currentDialog._text + text.charAt(currentDialog._text.length));
                        }
                    if (currentDialog._text == text) {
                        clearInterval(makeText);
                        makeText = null;//ensure it is gone.
                        action();
                    }
                }
            }
            function nextLevel() {
                
                level += 1;
                updateCurrentLevel();
                
            }
            //mr potat summoning
            function summonPotat() {
                taco.disabled = true;
                textBox.visible = true;
                if (textBox.scale < 4) {
                    textBox.scale += 0.2;
                } else {
                    potat.x = taco.x - 350;
                    potat.visible = true;
                    potat.summoned = true;
                }
            }
            function banishPotat() {
                taco.disabled = false;
                text('', 30, function(){});
                textBox.visible = false;
                textBox.scale = 0.2;
                potat.visible = false;
                potat.summoned = false;
                //this.ingredientParticleEmit(potat.x, potat.y, 20, 300, false);
            }
            //all level sequences with mr potat besides the tutorial
            var textSequence = 0;
            var checkpoint = 0;
            function sequence() {
                if (finished == true) {
                    if (potat.summoned == false) {
                        summonPotat();
                    }
                    if (potat.summoned) {
                        taco.disabled = false;
                        if (textSequence == 0) {
                            textSequence += 1;
                            text('congradulations!', 30, ()=>{setTimeout(()=>{textSequence += 1;}, 1500)});
                        }
                        if (textSequence == 2) {
                            textSequence += 1;
                            text('now what will we do \nwith you?', 30, ()=>{setTimeout(()=>{textSequence += 1;}, 1500)});
                        }
                        if (textSequence == 4) {
                            textSequence += 1;
                            text('might as well put \nyou in the level \ncreator.', 30, ()=>{setTimeout(()=>{textSequence += 1;}, 1500)});
                        }
                        if (textSequence == 6) {
                            textSequence += 1;
                            ingredientParticleEmit(potat.x, potat.y, 30, 300, false);
                            banishPotat();
                            transportThisUI.cameras.main.fadeOut(2000).once('camerafadeoutcomplete', ()=>{
                                level = 6;
                                //play an ad before the next level, but only if out of titlescreen..
                                function cont2() {
                                    updateCurrentLevel();
                                    transportThisGame.scene.restart();
                                }
                                midGame(cont2);

                            });
                            finished = false;
                            potat.summoned = false;
                        }
                    }
                }
            }
            var frameTime = 0;
            function update (time, delta)
            {
                transportThisGame = this;
                frameTime += delta;
                //account for fast monitors
                if (frameTime > 14.5) {
                    if (delta > 6 && delta < 8) {
                        delta *= 2;
                    }
                    if (delta > 2.5 && delta < 4.5) {
                        delta *= 4;
                    }
                    frameTime = 0;
                    //actual update loop
                    gameDelta = delta;
                    if (this.physics.world.timeScale < 1) {
                        this.physics.world.timeScale = 1;
                    }
                    
                    inMenu = false;
                    //coins
                    if (score.value >= 50) {
                        taco.lives += 1;
                        setLives(taco.lives);
                        score.value = 0;
                    }
                    var mousePointer = this.input.activePointer.positionToCamera(this.cameras.main);
                    //mouse selector
                    if (creative == true) {
                        gridSelector.body.x = Math.round((mousePointer.x-16)/32)*32;
                        gridSelector.body.y = Math.round((mousePointer.y-16)/32)*32;
                        gridSelector.visible = true;
                    } else {
                        gridSelector.visible = false;
                    }
                    if (taco.minigame == true) {
                    
                        if (cursors.right.isDown || keyD.isDown) {
                            ship.body.x += 5;
                        }
                        if (cursors.left.isDown || keyA.isDown) {
                            ship.body.x -= 5;
                        }
                        if (ship.x > 600) {
                            ship.x = 600;
                        }
                        if (ship.x < 200) {
                            ship.x = 200;
                        }

                        if (Phaser.Input.Keyboard.JustDown(keySpace)) {
                            bullet = bullets.create(ship.x, ship.y, "lava1");
                            bullet.body.velocity.y = -200;
                            bullet.scrollFactorX = 0;
                            bullet.scrollFactorY = 0;
                            bullet.depth = 13;
                        }
                        if (random(1, 60) > taco.timeLeft && random(1, 6) == 1) {
                            enemy = enemies.create(random(100, 500, "burrito1"));
                            enemy.anims.play("burritoAnimation");
                            enemy.body.velocity.y = 100 + (60-taco.timeLeft);
                            enemy.depth = 15;
                        }
                        
                    }
                    sequence();
                    //update clouds and backgroundthis.input.keyboard.createCursorKeys()
                    if (random(1, 125) == 3) {
                        
                        if (random(1, 2) == 1) {
                            cloud = clouds.create(-200, random(1, layer1.height-150), 'cloud' + String(random(1, 2))).setScale(random(30, 40)/10).refreshBody(); 
                            cloud.body.velocity.x = random(25, 50);
                        } else {
                            cloud = clouds.create(layer1.width + 200, random(1, layer1.height-150), 'cloud' + String(random(1, 2))).setScale(random(30, 40)/10).refreshBody(); 
                            cloud.body.velocity.x = random(-25, -50);
                        }
                        cloud.depth = -5;
                        if (random(1, 2) == 1) {
                            cloud.flipX = true;
                        }
                    }
                    clouds.children.iterate((child) =>{
                        if (child.x < -5000 && child.x > layer1.width + 5000) {
                            child.destroy();
                        }
                    });
                    
                    var mousePointer = this.input.activePointer.positionToCamera(this.cameras.main);
                    mouseZone.x = mousePointer.x;
                    mouseZone.y = mousePointer.y;
                    
                    var tileSelectX = map.worldToTileX(mousePointer.x);
                    var tileSelectY = map.worldToTileY(mousePointer.y);

                    //keys
                    cursors = this.input.keyboard.createCursorKeys();
                    keyB = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.B);
                    keyM = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M);
                    keyC = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C);
                    keyE = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E);
                    keyF = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F);
                    keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                    keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
                    keyW = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);
                    keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
                    keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
                    keyY = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Y);
                    keyN = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.N);
                    //make sure the camera zoom is right
                    if (camera.zoom <= 1.3 && keySpace.isDown == false) {
                        camera.zoom += 0.015;
                    }
                    //debugging cursor position
                    if (Phaser.Input.Keyboard.JustDown(keyC)) {
                        /*
                        if (this.scale.isFullscreen)
                        {

                            this.scale.stopFullscreen();
                        }
                        else
                        {

                            this.scale.startFullscreen();
                        }
                        */
                    }
                    
                    //before doing anything with creative, it is important that the positions of sprites are all working the right way animations wise
                    updateColliders();
                    
                    //creative mode decisions
                    if (creativeUpdate == true) {
                        creativeUpdate = false;
                        if (creative == true) {
                            returnSprites();
                            taco.body.checkCollision.none = true;
                            taco.body.allowGravity = false;
                            taco.body.velocity.y = 0;
                            //this.physics.world.drawDebug = true;
                        } else {
                            resumeSprites();
                            taco.body.checkCollision.none = false;
                            taco.body.allowGravity = true;
                            //this.physics.world.drawDebug = false;
                            //this.physics.world.debugGraphic.clear();
                        }
                    }
                    
                    
                    //tutorial code and potat code.
                    access = this;
                    if (potat && potat.goto == false) {
                        if (potat.x > taco.x+100) {
                            potat.body.velocity.x = -180;
                        }else if (potat.x < taco.x-100) {
                            potat.body.velocity.x = 180;
                        } else {
                            potat.body.velocity.x *= 0.94;
                        }
                    }
                    if (potat && potat.goto !== false) {
                        if (potat.x > potat.goto+100) {
                            potat.body.velocity.x = -140;
                        }else if (potat.x < potat.goto-100) {
                            potat.body.velocity.x = 140;
                        } else {
                            potat.body.velocity.x *= 0.94;
                        }
                    }
                    if (finished == true) {

                    }
                    if (tutorial == true) {
                        if (taco.x > taco.limitX) {
                            taco.x = taco.limitX;
                        }
                        if (textBox.scale < 4) {
                            textBox.scale += 0.2;
                        } else {
                            var intro = false;
                            if (tutorialSequence == 0) {
                                tutorialSequence += 1;
                                //taco.disabled = true;
                                intro = text('Hello player. \nWelcome to the \nwonderful world of \nbad burritos. ', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1000)});
                                
                            }
                            if (tutorialSequence == 2) {
                                taco.disabled = false;
                                tutorialSequence += 1;
                                text('You should press \nsome arrow keys and \nsee what happens.', 150, function(){tutorialSequence += 1;})
                            }
                            if ((cursors.up.isDown || keyW.isDown) && tutorialSequence == 4) {
                                tutorialSequence += 1;
                                text('Great!\nOver here you will \nsee a wall.\nwalk up to it.', 150, function(){tutorialSequence += 1;})
                            }
                            if (tutorialSequence == 6 && taco.x > 565) {
                                //taco.disabled = true;
                                tutorialSequence += 1;
                                text('You could cross it, \nbut who wants to do \nthat?', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1000)})
                            }
                            if (tutorialSequence == 8) {
                                tutorialSequence += 1;
                                text('Just Kidding, this \nside of the wall is \ndepressing.', 150, function(){setTimeout(function(){tutorialSequence += 1;taco.disabled = false;}, 1000)})
                            }
                            if (tutorialSequence == 10) {
                                taco.limitX = 900;
                                tutorialSequence += 1;
                                text('Hold the up arrow \nwhile walking to \njump over it.', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1000)})
                            }
                            if (taco.x > 800 && tutorialSequence == 12) {
                                tutorialSequence += 1;
                                //taco.disabled = true;
                                text('look over there, \nsome unsuspecting \nred points!', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1500)})
                            }
                            if (tutorialSequence == 14) {
                                tutorialSequence += 1;
                                //taco.disabled = true;
                                //potat.goto = potat.x - 230;
                                text('if you couldn\'t \ntell, these adorable \nlittle spikes will \nsend you to the \nstart of the level. \n(don\'t ask me how)', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1500)})
                            }
                            if (tutorialSequence == 16) {
                                tutorialSequence += 1;
                                potat.goto = 1530;
                                camera.stopFollow();
                                camera.pan(1530, 3000, 4000);
                                //taco.disabled = true;
                                text('but that can change,\nsee this sleepy \nlittle guy over \nhere?', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1500);})
                            }
                            if (tutorialSequence == 18) {
                                tutorialSequence += 1;
                                taco.disabled = true;
                                
                                text('This man right here \nis what I like to \ncall a checkpoint.', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1000);})
                            }
                            if (tutorialSequence == 20) {
                                tutorialSequence +=1;
                                text('he will bring you \nback to where he is \nwhen you die...', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                }, 1000);})
                            }
                            if (tutorialSequence == 22) {
                                tutorialSequence +=1;
                                taco.limitX = 1710;
                                text('if you wake him up.', 150, function(){setTimeout(function(){
                                    
                                    potat.goto = false;
                                    camera.pan(taco.x, 3000, 4000).once('camerapancomplete', ()=>{
                                        taco.x = Math.round(taco.x);
                                        taco.y = Math.round(taco.y);
                                        camera.startFollow(taco, 0.1, 0.1);
                                        taco.disabled = false;
                                        tutorialSequence += 1;
                                    });
                                    
                                }, 1000);});
                            }
                            if (tutorialSequence == 24 && checkpoints.children.entries[1].anims.currentAnim.key == "pointAwakeAnimation") {
                                tutorialSequence += 1;
                                text('Great job!', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1000);})
                            }
                            if (tutorialSequence == 26) {
                                tutorialSequence +=1;
                                camera.stopFollow();
                                camera.pan(1850, 3000, 2000);
                                taco.disabled = true;
                                potat.goto = 1850;
                                text('what is that?', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                }, 1000);});
                            }
                            if (tutorialSequence == 28) {
                                tutorialSequence +=1;
                                text('Don\'t bother \nanswering because I \nknow what it is. ', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                }, 1000);});
                            }
                            if (tutorialSequence == 30) {
                                tutorialSequence +=1;
                                text('That is a burrito, \nand it wants to \nsmash you.', 150, function(){setTimeout(function(){
                                    potat.goto = false;
                                    camera.pan(taco.x, 3000, 1800).once('camerapancomplete', ()=>{
                                        taco.x = Math.round(taco.x);
                                        taco.y = Math.round(taco.y);
                                        camera.startFollow(taco, 0.1, 0.1);
                                        
                                        tutorialSequence += 1;
                                    });
                                }, 1000);});
                            }
                            if (tutorialSequence == 32) {
                                tutorialSequence +=1;
                                text('See that tree next \nto him?', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                }, 1000);});
                            }
                            if (tutorialSequence == 34) {
                                tutorialSequence +=1;
                                taco.limitX = 2060;
                                taco.disabled = false;
                                text('I want you to go up \nto the tree and \npress space as fast \nas you can. ', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                }, 1000);});
                            }
                            if (trees.children.entries[0].angle > 50 && tutorialSequence == 36) {
                                tutorialSequence +=1;
                                //taco.disabled = true;
                                text('Oh, well lookie here \nthat burrito was \nguarding the way to \nthe next part of the \nlevel.', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                }, 1000);});
                            }
                            if (tutorialSequence == 38) {
                                tutorialSequence +=1;
                                text('It\'s a shame he \njust... ran off.', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                }, 1000);});
                            }
                            if (tutorialSequence == 40) {
                                tutorialSequence += 1;
                                text('Well, that is all. \nGood luck with the \nrest of the level!', 150, function(){setTimeout(function(){
                                    tutorialSequence += 1;
                                    taco.disabled = false;
                                    taco.limitX = 4000;
                                text('', 10, function(){/*console.log(tutorial = false);*/});
                                    textBox.visible = false;
                                    ingredientParticleEmit(potat.x, potat.y, 30, 300, false);
                                    banishPotat();
                                }, 1500);});
                            }
                            /*
                            if (tutorialSequence == 22) {
                                tutorialSequence += 1;
                                text('We don\'t exactly\nlike burritos, so\nstay away.', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1500)})
                            }
                            if (tutorialSequence == 18) {
                                tutorialSequence += 1;
                                text('However, there are\nways to get rid\nof them.', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1500)})
                            }
                            if (tutorialSequence == 20) {
                                tutorialSequence += 1;
                                taco.disabled = false;
                                text('Go up to the\ntree and press space\nuntil the circle is\nfull.', 150, function(){tutorialSequence += 1;})
                            }
                            if (trees.children.entries[0].angle > 50 && tutorialSequence == 22) {
                                taco.disabled = true;
                                tutorialSequence += 1;
                                text('hmm... \nsatisfying...', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1500)})
                                
                            }
                            if (tutorialSequence == 24) {
                                tutorialSequence += 1;
                                text("Throughout the game\nyou'll find more\nexciting ways to\nkill burritos.", 150, function(){setTimeout(function(){tutorialSequence += 1;taco.disabled = false;}, 1500)})
                            }
                            if (tutorialSequence == 26) {
                                tutorialSequence += 1;
                                text('Now go try\nthe rest of\nthe level!', 150, function(){setTimeout(function(){tutorialSequence += 1}, 1000)})
                            }
                            if (tutorialSequence == 28) {
                                tutorialSequence += 1;
                                
                                text('', 10, function(){console.log(tutorial = false);});
                                textBox.visible = false;
                                ingredientParticleEmit(potat.x, potat.y, 30, 300, false);
                                banishPotat();
                                //this.game.sound.stopAll();
                                //nextLevel();
                                //this.restartGame();
                            }
                            */
                        }
                        
                    }
                    //the map editing
                    
                    //typeEdit is defined at the beggining of the code :)
                    if (keyS.isDown && cursors.down.isDown && keyB.isDown && creative == true) {
                        if (prompt('1.entity 2.block') == '1') {
                            typeEdit = 1;
                            select = prompt('type');
                            select = Number(select);
                        } else {
                            typeEdit = 2;
                            select = prompt('type');
                            select = Number(select);
                        }
                        
                    }
                    
                    if (toolSelect == 'mouse' && this.input.manager.activePointer.isDown && typeEdit == 1/* && hold == false*/ && creative == true && disableEdit == false) {
                        if (entity1[Math.round((-16+mousePointer.y)/32)][Math.round((-16+mousePointer.x)/32)] !== -1) {
                            this.eraseEntity(Math.round((mousePointer.x-16)/32)*32, Math.round((mousePointer.y-16)/32)*32);
                        }
                        if (entity1[Math.round((-16+mousePointer.y)/32)][Math.round((-16+mousePointer.x)/32)] !== select) {
                            newEntity(select, Math.round((mousePointer.x-16)/32)*32, Math.round((mousePointer.y-16)/32)*32, 0, 0);
                        }
                        
                    }
                    if (this.input.manager.activePointer.isDown) {
                        hold = true;
                        //this isn't in the above statement because it ends up alternating.
                    } else {
                        hold = false;
                    }
                    
                    if (creative == true && ((this.input.manager.activePointer.isDown && toolSelect == 'erase') || keyE.isDown)) {
                        var tile = map.getTileAtWorldXY(mousePointer.x, mousePointer.y);
                        
                        if (tile !== null) {
                            map.removeTile(tile, -1, false);
                            map1[tile.y][tile.x] = -1;
                        }
                        var xAlter = 0;
                        var yAlter = 0;
                        for (var i = 0; i < 7; i += 1) {
                            switch(i) {
                                case 0:
                                    xAlter = 0;
                                    yAlter = -1;
                                    break;
                                case 1:
                                    xAlter = 1;
                                    yAlter = -1;
                                    break;
                                case 2:
                                    xAlter = 1;
                                    yAlter = 0;
                                    break;
                                case 3:
                                    xAlter = 1;
                                    yAlter = 1;
                                    break;
                                case 4:
                                    xAlter = 0;
                                    yAlter = 1;
                                    break;
                                case 5:
                                    xAlter = -1;
                                    yAlter = 1;
                                    break;
                                case 6:
                                    xAlter = -1;
                                    yAlter = 0;
                                    break;
                                case 7:
                                    xAlter = -1;
                                    yAlter = -1;
                                    break;
                            }
                            if (tileSelectX+xAlter > 0 && tileSelectX+xAlter < layer1.width/32 && tileSelectY+yAlter > 0 && tileSelectY+yAlter < layer1.height/32) {
                                map.putTileAt(map1[tileSelectY+yAlter][tileSelectX+xAlter], tileSelectX+xAlter, tileSelectY+yAlter);
                            }
                        }
                    }

                    if (toolSelect == 'mouse' && this.input.manager.activePointer.isDown && typeEdit == 2 && creative == true && disableEdit == false) {
                            map.putTileAt(select, tileSelectX, tileSelectY);
                            map1[tileSelectY][tileSelectX] = select;
                            //fix block style entities
                            var blockEntities = [creams, gums, doors];
                            for (var i = 0; i < blockEntities.length; i += 1) {
                                blockEntities[i].children.iterate((child) =>{
                                    if (child) {
                                        if (Math.round(child.initY/32) == tileSelectY && Math.round(child.initX/32) == tileSelectX) {
                                            entity1[Math.round(child.initY/32)][Math.round(child.initX/32)] = -1;
                                            child.destroy();
                                        }
                                    }
                                });
                            }
                            
                        //we need to make sure that block groups get updated when we change the map
                        /*
                        spikes = map.filterTiles(function (tile) {
                            return (tile.index == 1 || tile.index == 12);
                        });
                        flag = map.filterTiles(function (tile) {
                            return (tile.index == 9);
                        });*/
                    }

                    //before we move, run this
                    bottles.children.iterate(function(child){
                        if (child.held) {
                            child.x = taco.x;
                            child.y = taco.y-52;
                            child.body.velocity.x = taco.body.velocity.x;
                            child.body.velocity.y = taco.body.velocity.y;
                            //child.body.x = taco.body.x+taco._displayOriginX/2;
                            //child.body.y = taco.body.y+8+taco._displayOriginY/2;
                            //child.angle += 3;
                            //aim arrow
                            arrow.body.x = taco.body.x+(taco.body.width-arrow.body.width);
                            arrow.body.y = taco.body.y-arrow.body.height-15;
                            arrow.angle += 3;
                            arrow.visible = true;
                            if (keySpace.isDown == false/*Phaser.Input.Keyboard.JustDown(keySpace)*/) {
                                //take a bite
                                child.uses -= 1;
                                if (child.uses > 0) {
                                    child.setTexture('ice' + String((child.uses*-1)+4));
                                } else {
                                    child.visible = false;
                                }
                                //other things
                                iceBall = iceBalls.create(child.x, child.y, 'iceBall').setScale(0.8);
                                
                                iceBall.body.velocity.x = 500*Math.sin(arrow.angle * Math.PI/180);
                                iceBall.body.velocity.y = -500*Math.cos(arrow.angle * Math.PI/180);
                                iceBall.angle = arrow.angle-90;
                                child.held = false;
                                arrow.angle = 0;
                                arrow.visible = false;
                                child.body.velocity.x = 0;
                                child.body.velocity.y = -260;
                                child.body.allowGravity = true;
                                child.body.gravity.y = 500;
                                Phaser.tacoHarmony.active = true;
                            }
                        }
                    });
                    //walking effects
                    if ((cursors.right.isDown || cursors.left.isDown || keyA.isDown || keyD.isDown) && taco.body.blocked.down && Math.abs(taco.body.velocity.x) > 90) {
                        dirtEmitter.setQuantity(3);
                    }
                    if (!((cursors.right.isDown || cursors.left.isDown || keyA.isDown || keyD.isDown) && taco.body.blocked.down && Math.abs(taco.body.velocity.x) > 90)) {
                        dirtEmitter.setQuantity(0);
                    }
                    //walking
                    if (cursors.left.isDown || keyA.isDown)
                    {
                        dirtEmitter.setPosition(taco.x, taco.y + 40);
                        if (taco.disabled == false) {
                            if (taco.cream) {
                                tacoVelocityX -= 4.5;
                            } else {
                                tacoVelocityX -= 27;
                                if (delta/16.66 > 1.5) {
                                    tacoVelocityX -= 7;
                                }
                            }
                            
                        }
                        
                        //47
                        if (creative == true) {
                            taco.body.x -= 12;
                        }
                        taco.anims.play('left', true);
                    } else if (cursors.right.isDown || keyD.isDown)
                    {
                        dirtEmitter.setPosition(taco.x, taco.y + 40);
                        if (taco.disabled == false) {
                            if (taco.cream) {
                                tacoVelocityX += 4.5;
                            } else {
                                tacoVelocityX += 27;
                                if (delta/16.66 > 1.5) {
                                    tacoVelocityX += 7;
                                }
                            }
                        }
                        if (creative == true) {
                            taco.body.x += 12;
                        }
                        taco.anims.play('right', true);
                    } else
                    {
                        taco.anims.play('holdStill');
                    }

                    taco.setVelocityX(tacoVelocityX);
                    if (taco.cream) {
                        tacoVelocityX = tacoVelocityX * 0.991;//0.8
                    } else if (taco.gum) {
                        tacoVelocityX = tacoVelocityX * 0.78;
                        taco.body.velocity.y *= 0.8;
                    } else {
                        tacoVelocityX = tacoVelocityX * 0.88;//0.8
                    }
                    
                    if ((cursors.up.isDown || keyW.isDown) && taco.body.blocked.down) {
                        taco.body.velocity.y = -120*(delta/16.666);//base jump;
                        if (taco.body.velocity.y < -240) {
                            taco.body.velocity.y = -240;
                        }
                        taco.jumpHold = 105;
                    }
                    if ((cursors.up.isDown || keyW.isDown) && taco.jumpHold > 0)
                    {
                        taco.jumpHold -= 8;
                        taco.body.velocity.y -= (taco.jumpHold*0.92);
                    }
                    if ((cursors.up.isDown || keyW.isDown) && (cursors.right.isDown || cursors.left.isDown) && !(taco.body.blocked.down) && taco.gum == true) {
                        taco.body.velocity.y = -470;
                        taco.jumpHold = 0;

                        if (cursors.right.isDown && taco.body.blocked.right) {
                            tacoVelocityX = -300;
                        }
                        if (cursors.left.isDown && taco.body.blocked.left) {
                            tacoVelocityX = 300;
                        }
                    }
                    if (taco.body.blocked.up && taco.gum == true && (cursors.up.isDown || keyW.isDown)) {
                        if (taco.holding == false) {
                            taco.holding = true;
                            taco.timeout = setTimeout(()=>{taco.holding = false; taco.body.velocity.y = 50;}, 2000*(delta/16.666));
                        } else {
                            taco.body.velocity.y = -50;
                        }
                        
                        tacoVelocityX *= 0.89;
                    } else if (cursors.up.isDown == false) {
                        taco.holding = false;
                        if (taco.timeout) {
                            clearTimeout(taco.timeout);
                        }
                    }
                    if (taco.body.blocked.down) {
                        taco.cream = false;
                    }
                    taco.gum = false;

                    //we need to be able to move up and down in creative too
                    if (creative == true) {
                        taco.body.velocity.x = 0;
                        taco.body.velocity.y = 0;
                        if (cursors.up.isDown || keyW.isDown) {
                            taco.body.y -= 8;
                        }
                        if (cursors.down.isDown || keyS.isDown) {
                            taco.body.y += 8;
                        }
                    }
                    
                    //make sure that we die when we fall into the void :)
                    if (taco.body.y > 2000) {
                        death(true);
                    }
                    
                    var transportThis = this;
                    function treeSkillCheck(child, fallAngle, widthPullback) {
                        function roundTimeScale() {
                            if (Math.round(transportThisGame.physics.world.timeScale) == 1 && child.triggered == false) {
                                transportThisGame.physics.world.timeScale = 1;
                            }
                        }
                        if (child.triggered == true || (timeSkill.alpha < 1)) {
                            timeSkill.alpha -= 0.0022;
                            if (transportThisGame.physics.world.timeScale < 5) {
                                transportThisGame.physics.world.timeScale += 0.1;
                            }
                            if (check1 >= 60) {
                                check1 = 60;
                                child.falling = true;
                                if (transportThisGame.physics.world.timeScale > 1) {
                                    transportThisGame.physics.world.timeScale -= 0.2;
                                    //roundTimeScale();
                                }
                            }
                            if (check1 < 0) {
                                check1 = 0;
                            } else if (check1 != 60) {
                                check1 -= 0.4;
                            }
                            if (Phaser.Input.Keyboard.JustDown(keySpace) && check1 !== 60) {
                                check1 += 7.5;
                                if (check1 > 60) {
                                    check1 = 60;
                                }
                            }
                            if (child.falling == true) {
                                child.angle += 0.1*(child.angleSpeed/(transportThisGame.physics.world.timeScale));
                                child.angleSpeed += 1/(transportThisGame.physics.world.timeScale);
                            }
                            
                            if (child.angle > fallAngle || timeSkill.alpha <= 0) {
                                child.triggered = false;
                                child.falling = false;
                                check1 = -1;
                                timeSkill.visible = false;
                                
                                //child.body.width -= widthPullback;//counter for the first collider extension.
                                child.body.offset.x = 0;
                                if (timeSkill.alpha <= 0 && !(child.angle > fallAngle)) {
                                    //if unused, then reset and give them another go at it.
                                    console.log('reset');
                                    child.speedUp = setInterval(()=>{
                                        if (transportThisGame.physics.world.timeScale > 1) {
                                            transportThisGame.physics.world.timeScale -= 0.2;
                                        }
                                        if (Math.round(transportThisGame.physics.world.timeScale) == 1) {
                                            transportThisGame.physics.world.timeScale = 1;

                                            clearInterval(child.speedUp);
                                        }
                                        
                                    }, 16.66);
                                    setTimeout(()=>{child.triggered = "none";}, 1000);
                                }
                                timeSkill.alpha = 1;
                            }
                        }
                    }
                    trees.children.iterate(function(child) {
                        if (child.triggered == true) {
                            treeSkillCheck(child, 60, 175);
                        }
                    });
                    lights.children.iterate(function(child) {
                        if (child.triggered == true) {
                            treeSkillCheck(child, 75, 60);
                        }
                    });
                    poisons.children.iterate(function (child) {
                        if (child) {
                            if (child.body.blocked.right || child.body.blocked.left || child.body.velocity.x == 0) {
                                child.destroy();
                            } 
                        }
                    });
                    keys.children.iterate(function (child) {
                        if (child.follow == true) {
                            if (child.x < taco.x) {
                                child.body.velocity.x += 5;
                            } else {
                                child.body.velocity.x -= 5;
                            }
                            if (child.y < taco.y) {
                                child.body.velocity.y += 5;
                            } else {
                                child.body.velocity.y -= 5;
                            }
                            child.body.velocity.x *= 0.98;
                            child.body.velocity.y *= 0.98;
                        }
                    });
                    rocks.children.iterate(function(child) {
                        if (child.held == true) {
                            transportThis.physics.world.timeScale = 1;
                            arrow.body.x = taco.body.x+(taco.body.width-arrow.body.width);
                            arrow.body.y = taco.body.y-arrow.body.height-18;
                            if (arrow.direction == 1) {
                                arrow.angle += (delta/16.666)*(4/transportThis.physics.world.timeScale);
                            } else {
                                arrow.angle -= (delta/16.666)*(4/transportThis.physics.world.timeScale);
                            }
                            if (arrow.angle > 70 || arrow.angle < -70) {
                                arrow.direction *= -1;
                            }
                            arrow.visible = true;
                            child.originX = 0.5;
                            child.originY = 0.5;
                            //child.body.gravity.y = 0;
                            child.body.velocity.x = 0;
                            child.body.velocity.y = 0;
                            child.body.x = taco.body.x+taco._displayOriginX;
                            child.body.y = taco.body.y-43+taco._displayOriginY/2;
                            //child.x = taco.x;
                            //child.y = taco.y;
                            
                            child.depth = 5;
                            if (keySpace.isDown == false) {
                                child.held = false;
                                child.body.velocity.x = 500*Math.sin(arrow.angle * Math.PI/180);
                                child.body.velocity.y = -700*Math.cos(arrow.angle * Math.PI/180);
                                arrow.angle = 0;
                                arrow.visible = false;
                                transportThis.physics.world.timeScale = 1;
                            }
                        }
                    })
                    //reset mites when below screen
                    mites.children.iterate(function(child) {
                        if (child.body.y > 2000) {
                            /*
                            child.anims.stop();
                            child.anims.play('growingMite');
                            child.body.x = child.initX;
                            child.body.y = child.initY;
                            child.body.gravity.y = 0;
                            child.body.velocity.y = 0;*/
                            child.setOrigin(0.5, 0);
                            //child.refreshBody();
                            //child.body.allowGravity = true;
                            child.body.x = child.initX+16-(child.body.width/2);
                            child.body.y = child.initY;
                            child.body.velocity.y = 0;
                            child.body.gravity.y = 0;
                            child.anims.stop();
                            child.anims.play('growingMite');
                        }
                    });
                    platforms.children.iterate(function(child) {
                        if (creative == false) {
                            if (child.body.x > child.initX+child.distance) {
                                child.dir = -1;
                            }
                            if (child.body.x < child.initX) {
                                child.dir = 1;
                            }
                            /*
                            if (child.turn == true && child.waiting == false) {
                                child.dir *= -1;
                                child.waiting = true;
                            }
                            if (child.turn == false) {
                                child.waiting = false;
                            }*/
                            if ((child.dir * child.body.velocity.x) < 130) {
                                child.body.velocity.x += child.dir*3*(delta/16.666);
                                child.angle += ((child.body.velocity.x * -1)/160)*(delta/16.666);
                            } else {
                                if (child.angle > 0) {
                                    child.angle -= 0.5;
                                } 
                                if (child.angle < 0) {
                                    child.angle += 0.5;
                                }
                                if (Math.round(child.angle) == 0) {
                                    child.angle = 0;
                                }
                            }
                            //child.turn = false;//reset
                        }
                    });
                    platformsLeft.children.iterate(function(child) {
                        if (creative == false) {
                            if (child.body.x < child.initX-child.distance) {
                                child.dir = 1;
                            }
                            if (child.body.x > child.initX) {
                                child.dir = -1;
                            }
                            if ((child.dir * child.body.velocity.x) < 130) {
                                child.body.velocity.x += child.dir*3*(delta/16.666);
                                child.angle += ((child.body.velocity.x * -1)/160)*(delta/16.666);

                            } else {
                                if (child.angle > 0) {
                                    child.angle -= 0.5;
                                } 
                                if (child.angle < 0) {
                                    child.angle += 0.5;
                                }
                                if (Math.round(child.angle) == 0) {
                                    child.angle = 0;
                                }
                            }
                        }
                    });
                    platformsDown.children.iterate(function(child) {
                        if (creative == false) {
                            if (child.body.y > child.initY+child.distance) {
                                child.dir = -1;
                            }
                            if (child.body.y < child.initY) {
                                child.dir = 1;
                            }
                            if ((child.dir * child.body.velocity.y) < 130) {
                                child.body.velocity.y += child.dir*3*(delta/16.666);
                            }
                        }
                    });
                    platformsUp.children.iterate(function(child) {
                        if (creative == false) {
                            if (child.body.y < child.initY-child.distance) {
                                child.dir = 1;
                            }
                            if (child.body.y > child.initY) {
                                child.dir = -1;
                            }
                            if ((child.dir * child.body.velocity.y) < 130) {
                                child.body.velocity.y += child.dir*3*(delta/16.666);
                            }
                        }
                    });
                    
                    //sound effects for burritos and ice effect
                    //this.physics.world.timeScale = 1;
                    burritos.children.iterate(function(child) {
                        if (child.body.blocked.down && !child.frozen && child.fly == false) {
                            child.body.velocity.y = -410;
                            
                        }
                    });
                    //slow down the rocks
                    rocks.children.iterate(function(child) {
                        child.body.velocity.x *= 0.97;
                        if (child.body.blocked.down == true) {
                            child.body.velocity.x = 0;
                        }
                    });
                    //slow down the meatballs
                    meatballs.children.iterate(function(child) {
                        child.body.velocity.x *= 0.97;
                        child.angle += 0.012 * child.body.velocity.x;
                        child.body.velocity.x *= 0.995;
                    });
                    //we want to slow down and turn the limes
                    limes.children.iterate(function(child) {
                        child.angle += 0.012 * child.body.velocity.x;
                        child.body.velocity.x *= 0.995;
                    });
                    
                    //here we have the code for the drill boss
                    
                    drillers.children.iterate(function(child) {
                        if (creative == false && child.active == true && (taco.x > 6175 || child.started == true)) {
                            
                            if (child.phase == 2) {
                                if (random(1, 170) == 1) {
                                    boulders.makeNew();
                                }
                            }
                            if (child.phase == 3) {
                                if (random(1, 120) == 1) {
                                    boulders.makeNew();
                                }
                            }
                            if (child.phase == 4) {
                                if (random(1, 70) == 1) {
                                    boulders.makeNew();
                                }
                            }
                            if (child.started == false) {
                                child.started = true;
                                if (bossMusic[0].isPlaying == false) {
                                    bossMusic[0].play();
                                }
                                mainMusic.stop();
                                mainMusic2.stop();
                                caveMusic.stop();
                            }
                            if ((bossMusic[child.currentSong].totalDuration - bossMusic[child.currentSong].seek) < 0.1 || bossMusic[child.currentSong].isPlaying == false) {
                                if (child.goUpTo > child.currentSong) {
                                    bossMusic[child.currentSong].stop();
                                    child.currentSong += 1;
                                    bossMusic[child.currentSong].play();
                                }
                                if (child.goUpTo == child.currentSong) {
                                    bossMusic[child.currentSong].play();
                                }
                                
                            }
                            if (child.body.allowGravity == false) {
                                camera.pan(6176+400, 760+300, 1500);
                                camera.once('camerapancomplete', ()=>{
                                    taco.setCollideWorldBounds();
                                    rocks.children.iterate((child)=>{
                                        if (camera.worldView.contains(child.x, child.y)) {
                                            child.setCollideWorldBounds();
                                        }
                                    });
                                    child.setCollideWorldBounds();
                                    transportThisGame.physics.world.setBounds(camera.worldView.x, camera.worldView.y, camera.worldView.width, camera.worldView.height);
                                });
                                camera.stopFollow();
                                while (taco.lives < 5) {
                                    taco.lives += 1;
                                    setLives(taco.lives);
                                }
                                child.body.velocity.x = child.initXV;
                                child.body.velocity.y = child.initYV;
                                child.body.allowGravity = true;
                                child.que = 1;
                                child.phase = 1;
                                child.setOrigin(0.5, 0.5);
                                taco.x = Math.round(taco.x);
                                taco.y = Math.round(taco.y);
                                //camera.startFollow(child, false, 0.1, 0.1);
                            }
                            if (child.body.blocked.down) {
                                bossEmitter.setQuantity(10);
                                bossEmitter.setPosition(child.x, child.body.y+child.displayHeight);
                            } else {
                                bossEmitter.setQuantity(0);
                            }
                            switch (child.phase) {
                                default:
                                    switch (child.que) {
                                        case 1:
                                            if (child.body.x > (child.initX + 200)) {
                                                child.que += 1;
                                                child.body.velocity.x = -200;
                                            }
                                            break;
                                        case 2:
                                            if (child.body.x < (child.initX - 200)) {
                                                child.que += 1;
                                                child.body.velocity.x = 200;
                                            }
                                            break;
                                        case 3:
                                            if (child.body.x > (child.initX-100)) {
                                                child.que += 1;
                                                child.body.velocity.y = -600;
                                                camera.shake(400, 0.005);
                                            }
                                            break;
                                        case 4:
                                            if (child.body.x > (child.initX + 200)) {
                                                child.que += 1;
                                                child.body.velocity.x = -200;
                                            }
                                            break;
                                        case 5:
                                            if (child.body.x < (child.initX+100)) {
                                                child.que += 1;
                                                child.body.velocity.y = -600;
                                                camera.shake(400, 0.005);
                                            }
                                            break;
                                        case 6:
                                            if (child.body.x < (child.initX - 200)) {
                                                child.que += 1
                                                child.body.velocity.x = 200;
                                            }
                                            break;
                                        
                                        
                                        case 7:
                                            if (child.body.x > (child.initX + 200)) {
                                                child.que += 1;
                                                child.anims.stop();
                                                child.setOrigin(0.5, 1);
                                                child.pastXV = child.body.velocity.x;
                                                child.pastGY = child.body.gravity.y;
                                                child.body.gravity.y = 0;
                                                child.body.velocity.x = 0;
                                                child.body.velocity.y = 0;
                                                child.body.y += (child.displayHeight/2);
                                                child.anims.play('downAnimation').once('animationcomplete-downAnimation', ()=>{
                                                    taco.immortale = true;
                                                    setTimeout(function(){child.que += 1;taco.immortale = false;}, 500);
                                                });
                                            }
                                            break;
                                        case 9:
                                            child.que += 1;
                                            child.anims.play('poppingAnimation').once('animationcomplete-poppingAnimation', ()=>{
                                                
                                                child.que += 1;
                                                child.anims.play('shredingAnimation');
                                            });
                                            child.invincible = true;
                                            break;
                                        case 11:
                                            child.que += 1;
                                            child.body.velocity.x = -300;
                                            break;
                                        case 12:
                                            if (child.body.x < (child.initX - 200)) {
                                                child.que += 1;
                                                child.body.velocity.x = 300;
                                            }
                                            break;
                                        case 13:
                                            if (child.body.x > (child.initX + 200)) {
                                                child.que += 1;
                                                child.body.velocity.x = 0;
                                                child.anims.play('unPoppingAnimation').once('animationcomplete-unPoppingAnimation', ()=>{
                                                    setTimeout(function(){child.que += 1;}, 500);
                                                });
                                            }
                                            break;
                                        case 15:
                                            child.que += 1;
                                            child.anims.play('upAnimation').once('animationcomplete-upAnimation', ()=>{
                                                child.que += 1;
                                                child.setOrigin(0.5, 0.5);
                                                child.body.velocity.x = -200;
                                                child.body.gravity.y = 1000;
                                                child.y -= (child.displayHeight/2);
                                                child.anims.play('drillingAnimation');
                                                child.body.velocity.y = -400;
                                                camera.shake(400, 0.005);
                                            });
                                            child.body.velocity.x = 0;
                                            child.invincible = false;
                                            break;
                                        case 17:
                                            if (child.body.blocked.down == true) {
                                                child.body.velocity.y = -400;
                                                camera.shake(400, 0.005);
                                                child.que += 1;
                                            }
                                            break;
                                        case 18:
                                            if (child.body.x < (child.initX - 200)) {
                                                child.body.velocity.x = 200;
                                                
                                                if (child.lives == 8 || child.lives == 7) {
                                                    child.que = 1;
                                                } else if (child.lives == 5 || child.lives == 6) {
                                                    child.que = 1;
                                                    child.phase = 2;
                                                    child.goUpTo = 2;
                                                } else {
                                                    child.que = 1;
                                                    child.phase += 1;
                                                    child.goUpTo += 1;
                                                }
                                                
                                            }
                                            break;
                                    }
                                    break;
                                case 3:
                                    switch (child.que) {
                                        case 1:
                                            child.body.velocity.x = 300;
                                            if (child.body.blocked.down == true) {
                                                child.body.velocity.y = -300;
                                                camera.shake(400, 0.005);
                                                child.que += 1;
                                            }
                                            break;
                                        case 2:
                                        if (child.body.blocked.down == true) {
                                                camera.shake(400, 0.005);
                                                child.que += 1;
                                                child.setOrigin(0.5, 1);
                                                child.pastXV = child.body.velocity.x;
                                                child.pastGY = child.body.gravity.y;
                                                child.body.gravity.y = 0;
                                                child.body.velocity.x = 0;
                                                child.body.velocity.y = 0;
                                                child.body.y += (child.displayHeight/2);
                                                child.anims.play('downAnimation').once('animationcomplete-downAnimation', ()=>{
                                                    taco.immortale = true;
                                                    setTimeout(()=>{
                                                        taco.immortale = false;
                                                        child.que += 1;
                                                        child.anims.play('upAnimation').once('animationcomplete-upAnimation', ()=>{
                                                            child.anims.play('drillingAnimation');
                                                            child.body.velocity.y = -300;
                                                            child.body.velocity.x = 300;
                                                            child.body.gravity.y = child.pastGY;
                                                            child.setOrigin(0.5, 0.5);
                                                            child.y -= (child.displayHeight/2);
                                                            child.que += 1;
                                                        });
                                                    }, 400);
                                                });
                                            }
                                            break;
                                        case 5:
                                            if (child.body.x > (child.initX + 200) && child.body.blocked.down) {
                                                child.que += 1;
                                                child.anims.stop();
                                                child.setOrigin(0.5, 1);
                                                child.pastXV = child.body.velocity.x;
                                                child.pastGY = child.body.gravity.y;
                                                child.body.gravity.y = 0;
                                                child.body.velocity.x = 0;
                                                child.body.velocity.y = 0;
                                                child.body.y += (child.displayHeight/2);
                                                camera.shake(400, 0.005);
                                                child.anims.play('downAnimation').once('animationcomplete-downAnimation', ()=>{
                                                    taco.immortale = true;
                                                    child.timer = setTimeout(function(){child.que += 1;taco.immortale = false;}, 500);
                                                });
                                            }
                                            break;
                                        case 7:
                                            child.que += 1;
                                            child.anims.play('poppingAnimation').once('animationcomplete-poppingAnimation', ()=>{
                                                child.que += 1;
                                                child.anims.play('shredingAnimation');
                                            });
                                            child.invincible = true;
                                            break;
                                        case 9:
                                            child.que += 1;
                                            child.body.velocity.x = -400;
                                            break;
                                        case 10:
                                            if (child.body.x < (child.initX - 200)) {
                                                child.que += 1;
                                                child.body.velocity.x = 0;
                                                child.anims.play('unPoppingAnimation').once('animationcomplete-unPoppingAnimation', ()=>{
                                                    setTimeout(function(){child.que += 1;}, 400);
                                                });
                                            }
                                            break;
                                        case 12:
                                            child.que += 1;
                                            child.anims.play('upAnimation').once('animationcomplete-upAnimation', ()=>{
                                                child.que += 1;
                                                child.setOrigin(0.5, 0.5);
                                                child.body.velocity.x = 300;
                                                child.body.gravity.y = 1000;
                                                child.y -= (child.displayHeight/2);
                                                child.anims.play('drillingAnimation');
                                                camera.shake(400, 0.005);
                                                //return to start of this phase, or move on to next
                                                child.que = 1;
                                                if (child.lives < 3) {
                                                    child.phase = 4;
                                                    child.goUpTo += 1;
                                                }
                                            });
                                            child.body.velocity.x = 0;
                                            child.invincible = false;
                                            break;
                                    }
                                    break;
                                case 4:
                                    switch(child.que) {
                                        case 1:
                                            if (child.x < (taco.x-100)) {
                                                child.body.velocity.x += 12;
                                            } else if (child.x > (taco.x+100)) {
                                                child.body.velocity.x -= 12;
                                            } else {
                                                child.que += 1;
                                                child.setOrigin(0.5, 1);
                                                child.pastXV = child.body.velocity.x;
                                                child.pastGY = child.body.gravity.y;
                                                child.body.gravity.y = 0;
                                                child.body.velocity.x = 0;
                                                child.body.velocity.y = 0;
                                                child.body.y += (child.displayHeight/2);
                                                camera.shake(400, 0.005);
                                                setTimeout(()=>{child.anims.play('downAnimation').once('animationcomplete-downAnimation', ()=>{
                                                    child.visible = false;
                                                    taco.immortale = true;
                                                    child.timer = setTimeout(function(){child.que += 1;}, 50);
                                                    boulders.makeNew();
                                                })}, 0);
                                            }
                                            child.body.velocity.x *= 0.96;
                                            break;
                                        case 3:
                                            child.gotoX = taco.x;
                                            child.y += 20;
                                            child.que += 1;
                                            setTimeout(()=>{child.y -= 20;child.visible = true;child.que += 1;child.x = child.gotoX}, 900);
                                            break;
                                        case 5:
                                            child.que += 1;
                                            setTimeout(()=>{taco.immortale = false;}, 300);
                                            child.anims.play('poppingAnimation').once('animationcomplete-poppingAnimation', ()=>{
                                                child.que += 1;
                                                child.anims.play('unPoppingAnimation').once('animationcomplete-unPoppingAnimation', ()=>{
                                                    child.que += 1;
                                                    taco.immortale = true;
                                                    setTimeout(()=>{child.que += 1;}, 500);
                                                });
                                            });
                                            break;
                                        case 9:
                                            child.que += 1;
                                            taco.immortale = false;
                                            child.anims.play('upAnimation').once('animationcomplete-upAnimation', ()=>{
                                                child.que += 1;
                                                child.setOrigin(0.5, 0.5);
                                                child.body.velocity.x = 200;
                                                child.body.gravity.y = 1000;
                                                child.y -= (child.displayHeight/2);
                                                child.anims.play('drillingAnimation');
                                                camera.shake(400, 0.005);
                                            });
                                            child.body.velocity.x = 0;
                                            child.invincible = false;
                                            break;
                                        case 11:
                                            child.que += 1;
                                            if (child.x < taco.x) {
                                                child.body.velocity.x = 200;
                                                child.body.velocity.y = -450;
                                            } else {
                                                child.body.velocity.x = -200;
                                                child.body.velocity.y = -450;
                                            }
                                            break;
                                        case 12:
                                            if (child.body.blocked.down) {
                                                child.que = 1;
                                            }
                                            break;
                                    }
                                    break;
                            }
                            
                            /*
                            if (child.que == 1 && child.body.x > (child.initX + 230)) { 
                                child.que += 1;
                                child.body.velocity.y = -600;
                                child.body.velocity.x = -200;
                                camera.shake(400, 0.005);
                            }else if (child.que == 2 && child.body.x < (child.initX)) {
                                child.que += 1;
                                child.body.velocity.y = -600;
                                child.body.velocity.x = 200;
                                camera.shake(400, 0.005);
                            }else if (child.que == 3 && child.body.x > (child.initX + 230)) {
                                child.que += 1;
                                child.body.velocity.y = -300;
                                child.body.velocity.x = -200;
                            }else if (child.que == 4 && child.body.x < (child.initX + 100)) {
                                child.que += 1;
                                child.body.velocity.y = -300;
                            }else if (child.que == 5 && child.body.x < (child.initX - 50)) {
                                child.que += 1;
                                child.body.velocity.y = -300;
                            }else if (child.que == 6 && child.body.x < (child.initX - 230)) {
                                child.que += 1
                                
                                child.anims.stop();
                                child.setOrigin(0.5, 1);
                                child.pastXV = child.body.velocity.x;
                                child.pastGY = child.body.gravity.y;
                                child.body.gravity.y = 0;
                                child.body.velocity.x = 0;
                                child.body.velocity.y = 0;
                                child.body.y += (child.body.height/2) + 2;
                                child.anims.play('downAnimation').on('animationcomplete', ()=>{
                                    taco.immortale = true;
                                    setTimeout(function(){child.que = 8;taco.immortale = false;}, 500);
                                });
                            }else if (child.que == 8) {
                                child.que += 1;
                                child.anims.play('poppingAnimation').on('animationcomplete', ()=>{
                                    child.que += 1;
                                });
                                child.invincible = true;
                            }else if (child.que == 10) {
                                child.que += 1;
                                child.anims.play('shredingAnimation');
                                child.body.velocity.x = Math.abs(child.pastXV*1.5);
                            }else if (child.que == 11 && child.body.x > (child.initX + 230)) {
                                child.que += 1;
                                child.body.velocity.x = Math.abs(child.pastXV*1.5) * -1;
                            }else if (child.que == 12 && child.body.x < (child.initX - 230)) {
                                
                                child.que += 1;
                                child.body.velocity.x = 0;
                                child.anims.play('unPoppingAnimation').on('animationcomplete', ()=>{
                                    child.que = 14;
                                });
                            }else if (child.que == 14 && child.lives < 5) {
                                child.que += 1;
                                child.anims.play('upAnimation').on('animationcomplete', ()=>{
                                    child.que = 16;
                                    child.originY = 0.5;
                                    child.body.velocity.x = child.pastXV * -1;
                                    child.body.gravity.y = child.pastGY;
                                    child.body.y -= (child.body.height)+4;
                                    child.anims.play('drillingAnimation');
                                    child.body.velocity.y = -600;
                                    camera.shake(400, 0.005);
                                });
                                child.body.velocity.x = 0;
                                child.invincible = false;
                            }
                            */
                            
                        }/* else {
                            child.body.x = child.initX;
                            child.body.y = child.initY;
                            child.body.velocity.x = child.initXV;
                            child.body.velocity.x = child.initXV;
                        }*/
                        
                    });
                    taco.touchingTree = false;//reset after everything else is done.
                    
                }
                
                
            }  
            
            //the titlescreen functions 
            function startGame() {
                titleMusic.stop();
                introMusic.destroy();
                game.scene.stop('title');
                game.scene.start('game');
                if (transportThisGame) {
                    transportThisGame.scene.restart();
                }
            }
            function restartMenu() {
                transportThisGame = null;
                mainMusic.destroy();
                mainMusic2.destroy();
                caveMusic.destroy();
                for (var i = 0; i < bossMusic; i += 1) {
                    bossMusic[i].stop();
                    bossMusic[i].destroy();
                }
                game.scene.stop('game');
                game.scene.start('title');
            }
            function restartGame() {
                //game.scene.restart('game');
                this.scene.restart();
            }
            var introMusic;
            var titleMusic;
            titleScene.preload = function () {
                this.load.image('madeBy', 'assets/madeBy.png');
                this.load.image('tv1', 'assets/tvTransparent.png');
                this.load.image('tv2', 'assets/tv.png');
                this.load.image('lines', 'assets/scanLines.png');
                this.load.image('background', 'assets/title.png');
                this.load.image('play', 'assets/playButton.png');
                this.load.image('cloud1', 'assets/cloud-c.png');
                this.load.image('cloud2', 'assets/cloud-b.png');
                this.load.image('button1', 'assets/Dirt.png');
                this.load.image('menu', 'assets/menu2.png');
                this.load.audio('titleMusic', ['assets/Good\ Gummy\ Bears.mp3']);
                this.load.audio('introMusic', ['assets/Silent\ steak.mp3']);
                for (var i = 0; i <= 5; i += 1) {
                    this.load.image('level' + String(i), 'assets/level' + String(i) + '.png');
                }
                this.load.image('bird1', 'assets/bird1.png');
                this.load.image('bird2', 'assets/bird2.png');
                for (var i = 1; i <= 7; i += 1) {
                    this.load.image('mountain' + String(i), 'assets/mountain' + String(i) + '.png');
                }
                //more on the intro
                for (var i = 1; i <= 8; i += 1) {
                    this.load.image('intro' + String(i), 'assets/intro' + String(i) + '.png');
                }
                this.load.image('block', 'assets/Strip.png');
                //text box
                this.load.image('text', 'assets/textBox.png');
                //burrito
                this.load.spritesheet('burrito', 'assets/burrito.png', { frameWidth: 16, frameHeight: 32 });
                //fire
                this.load.image('fire1', 'assets/fire1.png');
                this.load.image('fire2', 'assets/fire2.png');
                //shooters
                this.load.image('shooter1', 'assets/Shooter1.png');
                this.load.image('shooter2', 'assets/Shooter2.png');
                this.load.image('shooter3', 'assets/Shooter3.png');
                //Beginning credits
                this.load.image('credit1', 'assets/Creator.png');
                this.load.image('credit2', 'assets/Programming.png');
                this.load.image('credit3', 'assets/Art.png');
                this.load.image('credit4', 'assets/Blank.png');

                this.load.image('pre1', 'assets/preTitle1.png');
                this.load.image('pre2', 'assets/preTitle2.png');
                this.load.image('pre3', 'assets/preTitle3.png');

                this.load.image('clickHere', 'assets/clickHere.png');
                this.load.image('clickHere2', 'assets/clickHere2.png');

                this.load.image('creatorGuide', 'assets/creatorGuide.png');
                
                //new Ui for tutorial
                this.load.image('new', 'assets/new.png');
                this.load.image('vid', 'assets/vid.png');

                //font
                var element = document.createElement('style');

                document.head.appendChild(element);

                var sheet = element.sheet;

                var styles = '@font-face { font-family: "mono"; src: url("assets/VCR_OSD_MONO_1.001.ttf") format("opentype"); }\n';

                sheet.insertRule(styles, 0);

                this.load.script('webfont', 'https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js');
            }

            
            //vars?
            var menuOpen = false;
            var graphics = true;
            var graphics2 = false;
            var start = false;
            setTimeout(function() {start = true;}, 2000);
            titleScene.create = function () {
                camera = this.cameras.main;
                camera.setBackgroundColor("#ADD8E6");
                this.anims.create({key: 'birdAnimation',
                 frames: [{key: 'bird1'},
                {key: 'bird2'}],
                frameRate:2,
                repeat:-1});
                this.anims.create({key: 'mountainAnimation1',
                 frames: [{key: 'mountain1'},
                {key: 'mountain2'},
                {key: 'mountain3'},
                {key: 'mountain4'},
                {key: 'mountain5'},],
                frameRate:1,
                repeat:0});
                this.anims.create({key: 'mountainAnimation2',
                 frames: [{key: 'mountain6'},
                {key: 'mountain7'},],
                frameRate:1,
                repeat:-1});
                this.anims.create({key: 'mountainAnimationStill',
                 frames: [{key: 'mountain1'},],
                frameRate:1,
                repeat:-1});
                this.anims.create({key: 'fireAnimation',
                 frames: [{key: 'fire1'},
                {key: 'fire2'}],
                frameRate:10,
                repeat:-1});
                this.anims.create({key: 'introAnimation',
                 frames: [{key: 'intro1'},
                {key: 'intro7'},
                {key: 'intro2'},
                {key: 'intro6'},/*used to be 3
                {key: 'intro4'},
                {key: 'intro5'},
                {key: 'intro8'},
                {key: 'intro6'},*/
                {key: 'intro6'},
                {key: 'intro6'},
                {key: 'intro6'},
                {key: 'intro6'},
                {key: 'intro6'},],
                frameRate:0.375,
                repeat:0});
                this.anims.create({key: 'shooterAnimation',
                 frames: [{key: 'shooter1'},
                {key: 'shooter2'},
                {key: 'shooter3'},
                {key: 'shooter2'}],
                frameRate:0.9,
                repeat:-1});
                this.anims.create({key: 'creditAnimation',
                 frames: [{key: 'credit1'},
                {key: 'credit2'},
                {key: 'credit3'},
                {key: 'credit4'},],
                frameRate:0.375,
                repeat:0});
                this.anims.create({key: 'preAnimation',
                 frames: [{key: 'pre1'},
                {key: 'pre2'},
                {key: 'pre3'}],
                frameRate:0.6,
                repeat:0});

                keyC = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C);
                /*graphics = this.add.graphics();

                graphics.fillStyle(0x000000, 1);
                graphics.fillRect(0, 0, 800, 600);
                graphics.depth = 4;*/

                madeBy = this.add.image(400, 300, 'madeBy');
                madeBy.visible = false;
                madeBy.depth = 5;
                madeBy.scale = 0.4;
                tv = this.add.image(400, 300, 'tv1');
                tv.depth = 6;
                tv.scale = 0.05;
                tv.fadeIn = -1;//false
                /*
                //opening cutscene
                bird = this.physics.add.sprite(-50, 500, 'bird1');
                bird.anims.play('birdAnimation');
                bird.depth = 1;
                */
                mountain = this.physics.add.sprite(400, 600, 'mountain1').setScale(8.5).refreshBody();
                mountain.setOrigin(0.5, 1);
                mountain.started = false;
                //mountain.visible = false;
                mountain.depth = -3;
                /*
                burrito = this.physics.add.sprite(400, -100, 'burrito').setScale(4).refreshBody();
                burrito.depth = 22;

                fireballs = this.physics.add.group();
                */
                //attempt two at cutscene
                /*intro = this.physics.add.sprite(400, 300, 'intro1');
                intro.started = false;
                intro.Data = {
                    scale: [1, 1, 1.1, 1.4, 1.1, 1, 2, 1.4],
                    angle: [-5, 5, -5, 5, -5, 7, -5, 5],
                    offsetX: [50, 50, 25, 40, -60, 0, 0, 40],
                    offsetY: [0, 0, 0, 0, 30, 0, 0, 0, 200],
                    frame: 0
                }*/

                block = this.physics.add.sprite(800, 580, 'block').setScale(8);
                block.angle = 5;
                block.visible = false;
                
                credit = this.physics.add.sprite(400, 200, 'credit1').setScale(0.75);
                credit.angle = 5;
                credit.visible = false;
                //here we have our shooters
                shooters = this.physics.add.group();
                shooters.visible = true;

                this.physics.world.drawDebug = false;// we have to specify this because we alternate this later in the code
                titleMusic = this.sound.add('titleMusic');
                introMusic = this.sound.add('introMusic');
                titleMusic.loop = true;
                titleMusic.play();
                //clouds
                clouds = this.physics.add.group();
                for (var i=0; i<12; i += 1) {
                    if (random(1, 2) == 1) {
                        cloudV = random(50, 100);
                    } else {
                        cloudV = -1*random(50, 100);
                    }
                    if (random(1, 2) == 1) {
                        cloudT = 'cloud1';
                    } else {
                        cloudT = 'cloud2';
                    }
                    
                    var cloud = clouds.create(random(10, 790), random(20, 590), cloudT).setScale(random(30, 45)/10).refreshBody();
                    cloud.body.velocity.x = cloudV;
                    cloud.depth = -5;
                }
                //the non moving parts (except for button kindof)
                logo = this.add.image(400, 200, 'background').setScale(2.5);
                //logo.visible = false;
                logo.depth = 1;
                
                playButton = this.add.image(400, 545, 'play').setScale(1);
                //playButton.visible = false;
                playButton.depth = 1;
                playButton.start = function() {
                    playButton.setInteractive({ useHandCursor: true });
                    playButton.on('pointerover', () => { playButton.setScale(1.2); });
                    playButton.on('pointerout', () => { playButton.setScale(1); });
                    playButton.on('pointerdown', () => {
                        menuOpen = true;
                    });
                }
                playButton.start();
                
                
                //new level
                //section of new UI for tutorial.
                newLevel = this.physics.add.sprite(40, 40, 'new');
                newLevel.scale = 0.75;
                newLevel.setInteractive({ useHandCursor: true });
                newLevel.on('pointerover', ()=>{newLevel.scale = 0.9;creatorGuide.visible = true;});
                newLevel.on('pointerout', ()=>{newLevel.scale = 0.75;creatorGuide.visible = false;});
                newLevel.on('pointerdown', ()=>{

                    rewarded(()=>{
                        transportThisTitle.scene.pause();
                        buttons.setVisible(false);
                        locks.setVisible(false);
                        menu.visible = false;
                        level = 6;
                        updateCurrentLevel();
                        startGame();
                        newLevel.visible = false;

                    });
                });

                creatorGuide = this.physics.add.sprite(110, 40, 'vid');
                creatorGuide.visible = false;
                creatorGuide.scale = 4;
                creatorGuide.depth = 4;

                //font
                WebFont.load({
                    custom: {
                        families: [ 'mono' ]
                    },
                    active: function ()
                    {
                        //add.text(32, 32, 'Bad Bad Burritos', { fontFamily: 'mono', fontSize: 60, color: '#ffffff' });
                    }
                });
                //dialog
                //goes with text function as global var
                var currentDialog;
                this.dialogText = function (text, delay, action) {
                    var makeText = setInterval(drawCurrentText, 70);
                    if (currentDialog) {
                        currentDialog.destroy();
                    }
                    add = this.add;
                    WebFont.load({
                        custom: {
                            families: [ 'mono' ]
                        },
                        active: function ()
                        {
                            currentDialog = add.text(220, 30 + 68, text.charAt(0), { fontFamily: 'mono', fontSize: 17, color: '#FFFFFF' });
                            currentDialog.scrollFactorX = 0;
                            currentDialog.scrollFactorY = 0;
                            currentDialog.depth = 20;
                            camera.ignore([currentDialog, textBox]);
                        }

                    });
                    function drawCurrentText() {
                        if (text.charAt(currentDialog._text.length) == ' ') {
                            if (currentDialog.setText) {
                                currentDialog.setText(currentDialog._text + text.charAt(currentDialog._text.length));
                            }
                            
                        }
                        if (currentDialog.setText) {
                                currentDialog.setText(currentDialog._text + text.charAt(currentDialog._text.length));
                            }
                        if (currentDialog._text == text) {
                            clearInterval(makeText);
                            action();
                        }
                    }
                }
            }
            var delay = 0;//non interval delay.
            titleScene.update = function () {
                transportThisTitle = this;
                inMenu = true;
                //fullscreen
                if (Phaser.Input.Keyboard.JustDown(keyC)) {
                    /*
                    if (this.scale.isFullscreen)
                    {
                        this.scale.stopFullscreen();
                    }
                    else
                    {
                        this.scale.startFullscreen();
                    }
                    */
                }
                //intro animation
                /*
                if (tv.scale < 15) {
                    if (tv.fadeIn === 1) {
                        tv.alpha += 0.02;
                    } else if (tv.fadeIn === 0) {
                        tv.fadeIn = 0.1;//prevent from running again.
                        tv.alpha = 1 - 0.02;
                        setTimeout(function(){tv.fadeIn = -1;}, 1000);
                    } else if (tv.fadeIn === -1) {
                        tv.alpha -= 0.02;
                    } else {
                    }
                    if (tv.alpha == 1) {
                        tv.fadeIn = 0;
                    }
                    if (tv.alpha == 0) {
                        tv.fadeIn = 1;
                        tv.scale += 5;
                        tv.alpha = 0.02;
                    }
                } else if (graphics) {
                    graphics2 = this.add.graphics();
                    this.graphics2 = graphics2;
                    graphics2.fillStyle(0x000000, 1);
                    graphics2.fillRect(0, 0, 800, 600);
                    graphics2.depth = 20;
                    graphics.destroy();
                    graphics = false;
                    

                } else if (delay < 250) {
                    delay += 1;//note to fix this later. Not good practice.
                    if (delay == 50) {
                        madeBy.visible = true;
                    }
                    if (delay == 200) {
                        madeBy.visible = false;
                    }
                    introMusic.volume = 0;
                } else */
                //got rid of tv
                //regular intro disable
                /*
                if (introMusic.isPlaying == false && start == true) {
                    //textBox.depth = 19;
                    madeBy.visible = false;
                    intro.visible = true;
                    
                    tv.destroy();

                    //this.graphics2.alpha -= 0.02;
                    camera.zoom += 0.0007;//account for the delay caused by the graphics 2 fading out.
                    
                    if (true) {
                        introMusic.play();
                        intro.started = true;
                        intro.anims.play('introAnimation');
                        intro.scale = intro.Data.scale[intro.Data.frame];
                        intro.angle = intro.Data.angle[intro.Data.frame];
                        intro.x = intro.Data.offsetX[intro.Data.frame] + 400;
                        intro.y = intro.Data.offsetY[intro.Data.frame] + 300;

                        intro.on(Phaser.Animations.Events.ANIMATION_UPDATE, function (anim, frame, sprite, frameKey) {
                            intro.Data.frame += 1;
                            if (intro.Data.frame < 4) {
                                intro.scale = intro.Data.scale[intro.Data.frame];
                                intro.angle = intro.Data.angle[intro.Data.frame];
                                intro.x = intro.Data.offsetX[intro.Data.frame] + 400;
                                intro.y = intro.Data.offsetY[intro.Data.frame] + 300;
                                camera.zoom = 1;
                            } else {
                                if (shooters.visible == true) {
                                    shooter = shooters.create(907.3, 430, 'shooter1').setScale(2);
                                    shooter.angle = 5;
                                    shooter.anims.play('shooterAnimation');
                                    shooter.body.velocity.y = -100 * 0.087;
                                    shooter.body.velocity.x = -100 * 0.99;
                                }
                                
                            }
                            if (intro.Data.frame == 3) {
                                block.visible = true;
                            }
                            if (intro.Data.frame == 4) {
                                credit.visible = true;
                                credit.anims.play('creditAnimation');
                                block.body.velocity.y = -100 * 0.087;//set this to the same velocity as shooters below.
                                block.body.velocity.x = -100 * 0.99;
                            }
                            if (intro.Data.frame == 7) {
                                var outro = setInterval(function(){
                                    if (introMusic.volume >= 0) {
                                        introMusic.volume -= 0.015;
                                    }
                                }, 16);
                                
                                camera.fadeOut(2000).once('camerafadeoutcomplete', () => {
                                    clearInterval(outro);
                                    introMusic.volume = 0;
                                    shooters.visible = false;
                                    shooters.children.iterate(function(child) {
                                        child.visible = false;
                                    });
                                    block.visible = false;
                                    camera.zoom = 1;
                                    setTimeout(function(){
                                        intro.anims.play('preAnimation').once('animationcomplete', () => {
                                            titleMusic.volume = 0;
                                            titleMusic.play();
                                            var backIn = setInterval(function(){
                                                if (titleMusic.volume < 1) {
                                                    titleMusic.volume += 0.015;
                                                }
                                            }, 16);
                                            camera.fadeIn(2500).once('camerafadeincomplete', () => {
                                                clearInterval(backIn);
                                            });
                                            logo.visible = true;
                                            intro.visible = false;
                                            mountain.visible = true;
                                            playButton.visible = true;
                                            playButton.start();
                                            
                                            credit.visible = false;
                                        });
                                        intro.x = 400;
                                        intro.y = 300;
                                        intro.angle = 0;
                                        intro.scale = 1;
                                        camera.fadeIn(1);
                                    }, 1000);
                                    
                                });
                            }
                        }, this);


                    }
                    introMusic.resume();
                    if (introMusic.volume < 1) {
                        introMusic.volume += 0.01;
                    }
                }else if (intro.Data.frame < 4) {
                    camera.zoom += 0.0007;
                } else if (intro.started == true) {
                }
                */
                //end of disabled regular.
                /* else if(bird.body.velocity.x == 0) {
                    bird.body.velocity.x = 50;
                } else if (mountain.dialog == null) {
                    mountain.dialog = 1;
                    this.dialogText('Long ago, there was\npeace in the land...', 50, function(){setTimeout(function(){mountain.dialog += 1;}, 2000)});
                } else if (bird.x < 200) {
                    bird.body.velocity.x = 50;
                } else if (bird.y < 600) {
                    bird.body.velocity.x *= 0.99;
                    bird.body.velocity.y = 50;
                } else if (mountain.started == false) {
                    mountain.anims.play('mountainAnimation1').once('animationcomplete', () => {
                        mountain.anims.play('mountainAnimation2');
                    });
                    mountain.started = true;
                }
                if (mountain.dialog == 2) {
                    mountain.dialog += 1;
                    this.dialogText('When suddenly, fell from\nthe sky...', 50, function(){setTimeout(function(){mountain.dialog += 1;}, 1000)});
                    camera.shake(35000, 0.01);
                } else if (mountain.dialog == 4) {
                    mountain.dialog += 1;
                    this.dialogText('The Bad Burrito!!!', 50, function(){setTimeout(function(){mountain.dialog += 1;}, 1000)});
                    burrito.body.velocity.y = 100;
                } else if (burrito.y > 430) {
                    burrito.depth = -1;
                    burrito.body.velocity.y = 0;
                    burrito.y = 430;
                } else if (mountain.dialog == 6) {
                    mountain.dialog += 1;
                    this.dialogText('He and his 3 minions\nterrorized the native \ntacos...', 50, function(){setTimeout(function(){mountain.dialog += 1;}, 2000)});
                } else if (mountain.dialog == 8) {
                    mountain.dialog += 1;
                    this.dialogText('Amidst the chaos only\nyou are left to\ndefeat him.', 50, function(){setTimeout(function(){mountain.dialog += 1;}, 2000)});
                } else if (mountain.dialog == 10) {
                    mountain.dialog += 1;
                    this.dialogText('The first enemy along\nthe path is the\ndespised drilling "Auger".', 50, function(){setTimeout(function(){mountain.dialog += 1;}, 2000)});
                } else if (mountain.dialog == 12) {
                    mountain.dialog += 1;
                    this.dialogText('Many more enemys you\nwill find along the\npath to victory.', 50, function(){setTimeout(function(){mountain.dialog += 1;}, 2000)});
                } else if (mountain.dialog == 14) {
                    mountain.dialog += 1;
                    camera.fadeOut(3000);
                    this.dialogText('', 50, null);
                    camera.once('camerafadeoutcomplete', function (camera) {
                        playButton.visible = true;
                        logo.visible = true;
                        fireballs.visible = false;
                        mountain.anims.play('mountainAnimationStill');
                        camera.shake(1000, 0);
                        textBox.visible = false;
                        playButton.start();
                        burrito.destroy();
                        camera.fadeIn(2000);
                    });
                }*/

                /*
                if (random(1, 50) == 3 && mountain.dialog > 5 && logo.visible == false) {
                    fire = fireballs.create(random(1, 800), -100, 'fire1');
                    fire.body.velocity.y = 150;
                    fire.anims.play('fireAnimation');
                    fire.angle = 90;
                    fire.scale = 0.1;
                }
                */
                if (random(1, 100) == 3) {
                    if (random(1, 2) == 1) {
                        cloudX = -150;
                        cloudV = random(50, 100);
                    } else {
                        cloudX = 1050;
                        cloudV = -1*random(50, 100);
                    }
                    if (random(1, 2) == 1) {
                        cloudT = 'cloud1';
                    } else {
                        cloudT = 'cloud2';
                    }
                    
                    var cloud = clouds.create(cloudX, random(20, 590), cloudT).setScale(random(30, 45)/10).refreshBody();
                    cloud.body.velocity.x = cloudV;
                    cloud.depth = -5;
                }
            }

            //we add the games different scenes
            game.scene.add('title', titleScene);
            game.scene.add('game', gameScene);
            game.scene.add('ui', UIScene);

            game.scene.start('title');
            game.scene.start('ui');
            
            function fullscreen() {
                if (this.scale.isFullscreen)
                {

                    this.scale.stopFullscreen();
                }
                else
                {

                    this.scale.startFullscreen();
                }
            }
        </script>
        <!--

        <h5>
            press m for creative mode. press b to select block. press e to delete block after it is selected<br>
            entities - 1<br>
            4:coin, 5:burrito, 6:burritoBoss, 7:treeTop, 8:stlagmite, 9:gumballForStlagmite, 10:burritoBarrier, 11:iceBottle, 12:lava, 13:rightPlatform, 14:lime <br>
            15:flag, 16:leftPlatform, 17:upPlatform, 18:downPlatform, 19: sourCreamForGrass.<br>
            blocks - 2<br>
            0:grass, 1:spikes, 2:dirt, 3:stone, 4:backgroundStone, 5:leftStump, 6:middleStump, 7:rightStump.<br>
            <br>
            press S to save. Copy both of the numbers and email them to owen4.greenhalgh@gmail.com to be loaded into the game.
            <br><br>
            WASD movement now available.<br>
            <br>
            Notes to level designers:<br>
            Keep in mind, if your mom or dad couldn't pass the level within ten minutes of trying, it is way too hard.<br>
            trees should be placed a block above the ground and block types 5, 6, and 7, should go underneath.<br>
            use plenty of burrito barriers as they can often by broken out of by burritos.<br>
            All entities are deleted from the top left corner, and aren't always perfectly accurate.

        </h5>
        -->
    </body>
    </html>
